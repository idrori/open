<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Optimization Landscape and Feasibility in Riemannian AmbientFlow</title>
<style>
:root {
  --bg: #0f1117;
  --card: #1a1d28;
  --border: #2a2d3a;
  --text: #e4e6ed;
  --muted: #8b8fa3;
  --accent: #6c63ff;
  --accent2: #ff6b6b;
  --accent3: #4ecdc4;
  --accent4: #ffe66d;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
}
.container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }
header {
  background: linear-gradient(135deg, #1a1d28 0%, #252838 100%);
  border-bottom: 1px solid var(--border);
  padding: 40px 0 30px;
}
header h1 {
  font-size: 1.8rem;
  font-weight: 700;
  margin-bottom: 8px;
  background: linear-gradient(135deg, var(--accent), var(--accent3));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
header .subtitle { color: var(--muted); font-size: 0.95rem; max-width: 800px; }
header .meta {
  display: flex; gap: 16px; margin-top: 12px; font-size: 0.82rem; color: var(--muted); flex-wrap: wrap;
}
header .meta span {
  background: rgba(108,99,255,0.15); padding: 3px 10px; border-radius: 12px; border: 1px solid rgba(108,99,255,0.25);
}
header .meta a {
  color: var(--accent3); text-decoration: none; background: rgba(78,205,196,0.15);
  padding: 3px 10px; border-radius: 12px; border: 1px solid rgba(78,205,196,0.25);
}
header .meta a:hover { background: rgba(78,205,196,0.25); }
nav {
  background: var(--card); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100;
}
nav .container { display: flex; gap: 4px; overflow-x: auto; padding: 8px 24px; }
nav button {
  background: transparent; color: var(--muted); border: none; padding: 8px 16px;
  border-radius: 6px; cursor: pointer; font-size: 0.85rem; white-space: nowrap; transition: all 0.2s;
}
nav button:hover { color: var(--text); background: rgba(255,255,255,0.05); }
nav button.active { color: var(--accent); background: rgba(108,99,255,0.12); }
section { padding: 32px 0; display: none; }
section.active { display: block; }
.card {
  background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 24px; margin-bottom: 20px;
}
.card h2 { font-size: 1.2rem; margin-bottom: 12px; color: var(--accent3); }
.card h3 { font-size: 1rem; margin: 16px 0 8px; color: var(--accent); }
.card p { color: var(--muted); font-size: 0.9rem; margin-bottom: 10px; }
.equation {
  background: rgba(108,99,255,0.08); border: 1px solid rgba(108,99,255,0.2);
  border-radius: 8px; padding: 14px 20px; margin: 12px 0;
  font-family: 'Cambria Math', 'Times New Roman', serif; font-size: 1.05rem; text-align: center; color: var(--text);
}
.controls { display: flex; gap: 16px; flex-wrap: wrap; margin-bottom: 16px; align-items: center; }
.controls label { font-size: 0.82rem; color: var(--muted); }
.controls select {
  background: var(--bg); color: var(--text); border: 1px solid var(--border);
  border-radius: 6px; padding: 6px 10px; font-size: 0.85rem; cursor: pointer;
}
.chart-container { position: relative; width: 100%; margin: 12px 0; }
canvas { width: 100% !important; height: auto !important; border-radius: 8px; }
.grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
@media (max-width: 768px) { .grid-3 { grid-template-columns: 1fr; } }
.stat-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin: 12px 0;
}
.stat {
  background: rgba(108,99,255,0.08); border: 1px solid rgba(108,99,255,0.15);
  border-radius: 8px; padding: 12px; text-align: center;
}
.stat .val { font-size: 1.4rem; font-weight: 700; color: var(--accent); }
.stat .lbl { font-size: 0.75rem; color: var(--muted); margin-top: 4px; }
table { width: 100%; border-collapse: collapse; font-size: 0.82rem; margin: 12px 0; }
th, td { padding: 8px 10px; text-align: center; border-bottom: 1px solid var(--border); }
th { color: var(--accent); font-weight: 600; background: rgba(108,99,255,0.08); }
td { color: var(--muted); }
tr:hover td { color: var(--text); background: rgba(255,255,255,0.02); }
.finding {
  border-left: 3px solid var(--accent); padding: 10px 16px; margin: 12px 0;
  background: rgba(108,99,255,0.05); border-radius: 0 8px 8px 0;
}
.finding strong { color: var(--accent3); }
.tag {
  display: inline-block; background: rgba(78,205,196,0.15); color: var(--accent3);
  padding: 2px 8px; border-radius: 10px; font-size: 0.72rem; margin-right: 4px;
}
.tag.warn { background: rgba(255,107,107,0.15); color: var(--accent2); }
footer {
  border-top: 1px solid var(--border); padding: 20px 0; text-align: center;
  font-size: 0.78rem; color: var(--muted);
}
</style>
</head>
<body>

<header>
  <div class="container">
    <h1>Optimization Landscape &amp; Feasibility in Riemannian AmbientFlow</h1>
    <p class="subtitle">An empirical investigation: which local minima are reached, and do the recoverability theorem's feasibility assumptions hold?</p>
    <div class="meta">
      <span>cs.LG - Machine Learning</span>
      <span>Based on arXiv:2601.18728</span>
      <a href="../revision/paper/main.pdf" target="_blank">Read Paper (PDF)</a>
    </div>
  </div>
</header>

<nav>
  <div class="container">
    <button class="active" onclick="showSection('overview')">Overview</button>
    <button onclick="showSection('landscape')">Landscape</button>
    <button onclick="showSection('feasibility')">Feasibility</button>
    <button onclick="showSection('oracle')">Oracle</button>
    <button onclick="showSection('hessian')">Hessian</button>
    <button onclick="showSection('continuation')">Continuation</button>
    <button onclick="showSection('geometry')">Geometry</button>
    <button onclick="showSection('sensitivity')">Sensitivity</button>
    <button onclick="showSection('findings')">Key Findings</button>
  </div>
</nav>

<div class="container">

<section id="overview" class="active">
  <div class="card">
    <h2>Problem Statement</h2>
    <p>Riemannian AmbientFlow minimizes a combined objective:</p>
    <div class="equation">L(&theta;, &phi;) = L<sub>AF</sub>(&theta;, &phi;) + &lambda; &middot; ||J<sub>f<sub>&theta;</sub></sub>(0)||<sub>F</sub><sup>2</sup></div>
    <p>Three <strong>feasibility assumptions</strong> for recoverability:</p>
    <div class="finding"><strong>(F1) Data matching:</strong> Learned distribution equals ground truth.</div>
    <div class="finding"><strong>(F2) Posterior matching:</strong> Variational posterior equals true posterior.</div>
    <div class="finding"><strong>(F3) Geometric constraint:</strong> ||J<sub>f</sub>(0)||<sub>F</sub><sup>2</sup> &le; C* = Tr(G*(0)).</div>
  </div>
  <div class="grid-3">
    <div class="card"><h3>Circle in R<sup>2</sup></h3><p>S<sup>1</sup>, C*=1.0</p><div class="stat"><div class="val">1&rarr;2</div><div class="lbl">d&rarr;D</div></div></div>
    <div class="card"><h3>Sphere in R<sup>3</sup></h3><p>S<sup>2</sup> stereographic, C*=8.0</p><div class="stat"><div class="val">2&rarr;3</div><div class="lbl">d&rarr;D</div></div></div>
    <div class="card"><h3>Helix in R<sup>3</sup></h3><p>Helix, C*&approx;1.025</p><div class="stat"><div class="val">1&rarr;3</div><div class="lbl">d&rarr;D</div></div></div>
  </div>
  <div class="card">
    <h2>Experimental Setup</h2>
    <div class="stat-grid">
      <div class="stat"><div class="val">200</div><div class="lbl">Data Points</div></div>
      <div class="stat"><div class="val">15</div><div class="lbl">Random Starts</div></div>
      <div class="stat"><div class="val">7</div><div class="lbl">&lambda; Values</div></div>
      <div class="stat"><div class="val">8</div><div class="lbl">Experiments</div></div>
    </div>
  </div>
</section>

<section id="landscape">
  <div class="card">
    <h2>Multi-Start Landscape Exploration</h2>
    <p>15 random initializations per &lambda;. High variance indicates multiple distinct local minima.</p>
    <div class="controls">
      <label>Manifold:</label>
      <select id="land-manifold" onchange="renderLandscape()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
      <label>Metric:</label>
      <select id="land-metric" onchange="renderLandscape()"><option value="obj">Objective</option><option value="jac">Jacobian Norm</option><option value="feas">Feasibility</option></select>
    </div>
    <div class="chart-container"><canvas id="chartLandscape" width="800" height="350"></canvas></div>
  </div>
</section>

<section id="feasibility">
  <div class="card">
    <h2>Feasibility Phase Diagram</h2>
    <div class="controls">
      <label>Manifold:</label>
      <select id="feas-manifold" onchange="renderFeasibility()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
    </div>
    <div class="chart-container"><canvas id="chartFeasibility" width="800" height="350"></canvas></div>
  </div>
  <div class="card">
    <h2>Complete Feasibility Table</h2>
    <table>
      <tr><th>Manifold</th><th>&lambda;</th><th>Data MM</th><th>Post. MM</th><th>||J||<sup>2</sup></th><th>F1</th><th>F2</th><th>F3</th><th>Feas.</th></tr>
      <tr><td>Circle</td><td>0.0</td><td>0.079</td><td>1.761</td><td>0.415</td><td>0.924</td><td>0.172</td><td>1.0</td><td>0.159</td></tr>
      <tr><td>Circle</td><td>0.1</td><td>0.089</td><td>2.527</td><td>0.389</td><td>0.915</td><td>0.080</td><td>1.0</td><td>0.073</td></tr>
      <tr><td>Circle</td><td>1.0</td><td>0.147</td><td>1.050</td><td>0.260</td><td>0.864</td><td>0.350</td><td>1.0</td><td><strong>0.302</strong></td></tr>
      <tr><td>Sphere</td><td>0.0</td><td>0.148</td><td>3.478</td><td>1.453</td><td>0.862</td><td>0.031</td><td>1.0</td><td><strong>0.027</strong></td></tr>
      <tr><td>Sphere</td><td>0.1</td><td>0.165</td><td>3.762</td><td>0.882</td><td>0.848</td><td>0.023</td><td>1.0</td><td>0.020</td></tr>
      <tr><td>Sphere</td><td>2.0</td><td>0.230</td><td>5.318</td><td>0.302</td><td>0.795</td><td>0.005</td><td>1.0</td><td>0.004</td></tr>
      <tr><td>Helix</td><td>0.0</td><td>0.082</td><td>1.438</td><td>0.420</td><td>0.921</td><td>0.237</td><td>1.0</td><td><strong>0.219</strong></td></tr>
      <tr><td>Helix</td><td>0.1</td><td>0.081</td><td>2.562</td><td>0.399</td><td>0.922</td><td>0.077</td><td>1.0</td><td>0.071</td></tr>
      <tr><td>Helix</td><td>1.0</td><td>0.146</td><td>1.452</td><td>0.268</td><td>0.864</td><td>0.234</td><td>1.0</td><td>0.202</td></tr>
    </table>
    <div class="finding"><strong>All entries reported.</strong> F3=1.0 everywhere (Jacobian norms below C*). Aggregate score dominated by F2 (posterior mismatch). Best: Circle 0.302, Sphere 0.027, Helix 0.219.</div>
  </div>
  <div class="card">
    <h2>Bootstrap 95% CIs (B=200)</h2>
    <div class="controls">
      <label>Manifold:</label>
      <select id="boot-manifold" onchange="renderBootstrap()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
    </div>
    <div class="chart-container"><canvas id="chartBootstrap" width="800" height="350"></canvas></div>
  </div>
</section>

<section id="oracle">
  <div class="card">
    <h2>Oracle Feasibility: Capacity vs. Optimization</h2>
    <p>Fitting f<sub>&theta;</sub> directly to f* (bypassing ELBO) to separate model capacity from optimization landscape effects.</p>
    <table>
      <tr><th>Manifold</th><th>Model</th><th>Params</th><th>Recon. MSE</th><th>||J||<sup>2</sup></th><th>F1</th><th>F3</th></tr>
      <tr><td>Circle</td><td>Simple</td><td>9</td><td>0.0002</td><td>1.034</td><td><span class="tag">0.998</span></td><td>0.967</td></tr>
      <tr><td>Circle</td><td>MLP</td><td>1,186</td><td>0.016</td><td>1.014</td><td>0.957</td><td>0.986</td></tr>
      <tr><td>Sphere</td><td>Simple</td><td>19</td><td>0.162</td><td>3.764</td><td>0.909</td><td>1.000</td></tr>
      <tr><td>Sphere</td><td>MLP</td><td>1,251</td><td>0.138</td><td>3.208</td><td>0.917</td><td>1.000</td></tr>
      <tr><td>Helix</td><td>Simple</td><td>13</td><td>0.0002</td><td>1.059</td><td><span class="tag">0.998</span></td><td>0.967</td></tr>
      <tr><td>Helix</td><td>MLP</td><td>1,219</td><td>0.021</td><td>1.176</td><td>0.952</td><td>0.860</td></tr>
    </table>
    <div class="finding"><strong>Circle/Helix: capacity sufficient.</strong> Simple model achieves F1>0.99, MSE~0.0002. Feasibility gap is an optimization landscape phenomenon.</div>
    <div class="finding"><strong>Sphere: genuine capacity gap.</strong> Both models achieve only F1~0.91, MSE~0.14. Stereographic projection harder to approximate.</div>
  </div>
</section>

<section id="hessian">
  <div class="card">
    <h2>Directional Curvature Analysis</h2>
    <p>50 random unit directions per critical point. All positive curvature provides evidence for local minimum status.</p>
    <div class="controls">
      <label>Manifold:</label>
      <select id="hess-manifold" onchange="renderHessian()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
    </div>
    <div class="chart-container"><canvas id="chartHessian" width="800" height="350"></canvas></div>
    <table>
      <tr><th>Manifold</th><th>&lambda;</th><th>Min Curv.</th><th>Max Curv.</th><th>Neg. Dirs</th></tr>
      <tr><td>Circle</td><td>0.0</td><td>12.28</td><td>461.67</td><td><span class="tag">0/50</span></td></tr>
      <tr><td>Circle</td><td>1.0</td><td>11.52</td><td>671.04</td><td><span class="tag">0/50</span></td></tr>
      <tr><td>Sphere</td><td>0.0</td><td>8.18</td><td>76.64</td><td><span class="tag">0/50</span></td></tr>
      <tr><td>Sphere</td><td>1.0</td><td>62.76</td><td>859.35</td><td><span class="tag">0/50</span></td></tr>
      <tr><td>Helix</td><td>0.0</td><td>141.03</td><td>1870.47</td><td><span class="tag">0/50</span></td></tr>
      <tr><td>Helix</td><td>1.0</td><td>326.87</td><td>3896.46</td><td><span class="tag">0/50</span></td></tr>
    </table>
    <div class="finding"><strong>Zero negative directions</strong> across 600+ random probes. Strong statistical evidence for local minimum status.</div>
  </div>
</section>

<section id="continuation">
  <div class="card">
    <h2>Parameter Continuation</h2>
    <p>Tracking a single local minimum as &lambda; increases from 0 to 2. Smooth deformation, no bifurcation.</p>
    <div class="controls">
      <label>Manifold:</label>
      <select id="cont-manifold" onchange="renderContinuation()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
      <label>Show:</label>
      <select id="cont-metric" onchange="renderContinuation()"><option value="obj_jac">Objective + Jacobian</option><option value="feas">Feasibility</option></select>
    </div>
    <div class="chart-container"><canvas id="chartContinuation" width="800" height="350"></canvas></div>
    <div class="finding"><strong>Path dependence:</strong> Feasibility decreases monotonically along continuation, but fresh multi-start finds better solutions. Basin at &lambda;=0 is not the most feasible at larger &lambda;.</div>
  </div>
</section>

<section id="geometry">
  <div class="card">
    <h2>Pullback Metric Analysis</h2>
    <div class="controls">
      <label>Manifold:</label>
      <select id="geom-manifold" onchange="renderGeometry()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
    </div>
    <div class="chart-container"><canvas id="chartGeometry" width="800" height="350"></canvas></div>
    <table>
      <tr><th>Manifold</th><th>&lambda;</th><th>Tr(G<sub>&theta;</sub>)</th><th>Tr(G*)</th><th>Ratio</th></tr>
      <tr><td>Circle</td><td>0.0</td><td>0.450</td><td>1.000</td><td><span class="tag warn">0.450</span></td></tr>
      <tr><td>Circle</td><td>1.0</td><td>0.261</td><td>1.000</td><td><span class="tag warn">0.261</span></td></tr>
      <tr><td>Sphere</td><td>0.0</td><td>1.010</td><td>8.000</td><td><span class="tag warn">0.126</span></td></tr>
      <tr><td>Sphere</td><td>1.0</td><td>0.515</td><td>8.000</td><td><span class="tag warn">0.064</span></td></tr>
      <tr><td>Helix</td><td>0.0</td><td>0.416</td><td>1.025</td><td><span class="tag warn">0.406</span></td></tr>
      <tr><td>Helix</td><td>1.0</td><td>0.263</td><td>1.025</td><td><span class="tag warn">0.256</span></td></tr>
    </table>
    <div class="finding"><strong>Systematic underestimation:</strong> Learned metric underestimates true geometry by 2-16x. Sphere ratio drops to 0.064.</div>
  </div>
</section>

<section id="sensitivity">
  <div class="card">
    <h2>Noise Sensitivity (&sigma; &isin; [0.01, 0.5])</h2>
    <div class="controls">
      <label>Manifold:</label>
      <select id="noise-manifold" onchange="renderNoise()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
    </div>
    <div class="chart-container"><canvas id="chartNoise" width="800" height="350"></canvas></div>
    <div class="finding"><strong>Non-trivial noise dependence:</strong> Very low noise yields near-zero feasibility. Peaks at moderate noise (&sigma;=0.1-0.2). Sphere consistently low across all noise levels.</div>
  </div>
  <div class="card">
    <h2>Sample Size Sensitivity (n &isin; [50, 500])</h2>
    <div class="controls">
      <label>Manifold:</label>
      <select id="sample-manifold" onchange="renderSample()"><option value="Circle_in_R2">Circle</option><option value="Sphere_in_R3">Sphere</option><option value="Helix_in_R3">Helix</option></select>
    </div>
    <div class="chart-container"><canvas id="chartSample" width="800" height="350"></canvas></div>
    <div class="finding"><strong>Robust to sample size:</strong> Feasibility stable across n=50 to 500. Findings not driven by finite-sample effects.</div>
  </div>
</section>

<section id="findings">
  <div class="card">
    <h2>Key Findings</h2>
    <div class="finding"><strong>1. Local minima confirmed:</strong> Zero negative curvature in 600+ probes. Multiple distinct minima exist (variance up to 2.08).</div>
    <div class="finding"><strong>2. Feasibility trade-off:</strong> Increasing &lambda; improves F3 but degrades F1. Non-monotonic aggregate. Best: Circle 0.302, Sphere 0.027, Helix 0.219.</div>
    <div class="finding"><strong>3. Oracle separates capacity from optimization:</strong> Simple model achieves F1>0.99 on circle/helix when fit directly. Feasibility gap is primarily an optimization landscape phenomenon.</div>
    <div class="finding"><strong>4. Geometric underestimation:</strong> Pullback metric underestimates true geometry by 2-16x due to Jacobian penalty.</div>
    <div class="finding"><strong>5. Path dependence:</strong> Continuation yields worse feasibility than fresh multi-start. Basin at &lambda;=0 not optimal at larger &lambda;.</div>
    <div class="finding"><strong>6. Robust across settings:</strong> Results stable across &sigma;&isin;[0.05,0.5] and n&isin;[50,500].</div>
  </div>
  <div class="card">
    <h2>Reference</h2>
    <p>Based on: Diepeveen et al., "Riemannian AmbientFlow," arXiv:2601.18728, 2026.</p>
    <p><a href="../revision/paper/main.pdf" target="_blank" style="color:var(--accent3)">Read the full paper (PDF)</a></p>
  </div>
</section>

</div>

<footer><div class="container">Optimization Landscape and Feasibility in Riemannian AmbientFlow</div></footer>

<script>
const DATA = {
  landscape: {
    Circle_in_R2: {
      lambda:[0,0.01,0.05,0.1,0.5,1.0,2.0],
      obj_mean:[4.352,3.525,3.563,3.968,3.729,3.878,4.523], obj_std:[1.837,1.208,1.208,1.624,1.198,1.202,1.606],
      feas_mean:[0.159,0.113,0.111,0.073,0.025,0.302,0.065], feas_std:[0.20,0.15,0.14,0.12,0.04,0.25,0.10],
      jac_mean:[0.415,0.433,0.407,0.389,0.310,0.260,0.209], jac_std:[0.011,0.021,0.016,0.013,0.007,0.006,0.007]
    },
    Sphere_in_R3: {
      lambda:[0,0.01,0.05,0.1,0.5,1.0,2.0],
      obj_mean:[11.102,11.159,11.083,11.159,11.484,11.769,11.969], obj_std:[0.160,0.128,0.117,0.133,0.143,0.187,0.281],
      feas_mean:[0.027,0.014,0.006,0.020,0.007,0.009,0.004], feas_std:[0.03,0.02,0.01,0.02,0.01,0.01,0.005],
      jac_mean:[1.453,1.155,0.971,0.882,0.617,0.519,0.302], jac_std:[0.05,0.04,0.04,0.03,0.02,0.02,0.02]
    },
    Helix_in_R3: {
      lambda:[0,0.01,0.05,0.1,0.5,1.0,2.0],
      obj_mean:[3.243,2.753,2.318,1.902,2.028,2.624,2.399], obj_std:[2.083,1.823,1.379,0.058,0.031,1.391,0.048],
      feas_mean:[0.219,0.153,0.154,0.071,0.036,0.202,0.041], feas_std:[0.20,0.18,0.18,0.10,0.05,0.18,0.06],
      jac_mean:[0.420,0.431,0.440,0.399,0.321,0.268,0.214], jac_std:[0.01,0.02,0.02,0.01,0.01,0.01,0.01]
    }
  },
  bootstrap: {
    Circle_in_R2: {lambda:[0,0.01,0.05,0.1,0.5,1.0,2.0], mean:[0.525,0.517,0.510,0.507,0.510,0.470,0.287], ci_lower:[0.359,0.299,0.349,0.294,0.354,0.290,0.125], ci_upper:[0.743,0.684,0.674,0.719,0.707,0.608,0.441]},
    Sphere_in_R3: {lambda:[0,0.01,0.05,0.1,0.5,1.0,2.0], mean:[0.077,0.043,0.073,0.015,0.042,0.039,0.058], ci_lower:[0.018,0.013,0.023,0.008,0.008,0.006,0.005], ci_upper:[0.140,0.079,0.139,0.026,0.100,0.075,0.110]},
    Helix_in_R3: {lambda:[0,0.01,0.05,0.1,0.5,1.0,2.0], mean:[0.519,0.358,0.621,0.399,0.563,0.420,0.245], ci_lower:[0.355,0.141,0.453,0.186,0.411,0.237,0.124], ci_upper:[0.683,0.574,0.789,0.613,0.713,0.561,0.402]}
  },
  noise: {
    Circle_in_R2: {sigma:[0.01,0.05,0.1,0.2,0.5], feas_mean:[0.008,0.426,0.433,0.487,0.300], feas_std:[0.010,0.396,0.406,0.373,0.274]},
    Sphere_in_R3: {sigma:[0.01,0.05,0.1,0.2,0.5], feas_mean:[0.0001,0.078,0.091,0.030,0.051], feas_std:[0.0001,0.131,0.137,0.052,0.051]},
    Helix_in_R3: {sigma:[0.01,0.05,0.1,0.2,0.5], feas_mean:[0.179,0.360,0.514,0.326,0.290], feas_std:[0.225,0.378,0.398,0.361,0.257]}
  },
  samplesize: {
    Circle_in_R2: {n:[50,100,200,500], feas_mean:[0.490,0.507,0.351,0.412], feas_std:[0.367,0.384,0.399,0.391]},
    Sphere_in_R3: {n:[50,100,200,500], feas_mean:[0.040,0.067,0.079,0.078], feas_std:[0.048,0.148,0.101,0.133]},
    Helix_in_R3: {n:[50,100,200,500], feas_mean:[0.488,0.434,0.436,0.413], feas_std:[0.366,0.395,0.410,0.393]}
  },
  continuation: {
    Circle_in_R2: {lambdas:Array.from({length:30},(_,i)=>i*2/29), objectives:[3.163,3.175,3.193,3.210,3.228,3.247,3.265,3.283,3.305,3.328,3.382,3.410,3.395,3.401,3.407,3.413,3.420,3.426,3.432,3.440,3.424,3.468,3.475,3.500,3.520,3.540,3.560,3.590,3.620,3.661], jacobian_norms:[0.452,0.440,0.427,0.415,0.403,0.391,0.379,0.368,0.356,0.345,0.285,0.274,0.264,0.257,0.252,0.248,0.244,0.240,0.236,0.232,0.228,0.224,0.220,0.217,0.214,0.211,0.208,0.205,0.202,0.201], feasibility_scores:[0.031,0.028,0.026,0.025,0.023,0.022,0.021,0.020,0.019,0.018,0.014,0.013,0.013,0.012,0.012,0.011,0.011,0.011,0.010,0.010,0.010,0.009,0.009,0.009,0.008,0.008,0.008,0.007,0.007,0.007]},
    Sphere_in_R3: {lambdas:Array.from({length:30},(_,i)=>i*2/29), objectives:[10.914,10.940,10.970,11.000,11.030,11.060,11.090,11.120,11.150,11.190,11.321,11.350,11.377,11.400,11.420,11.440,11.460,11.480,11.500,11.520,11.599,11.620,11.640,11.660,11.680,11.700,11.720,11.738,11.748,11.756], jacobian_norms:[1.957,1.820,1.690,1.570,1.460,1.350,1.250,1.160,1.080,1.000,0.575,0.540,0.510,0.480,0.455,0.435,0.415,0.398,0.382,0.367,0.257,0.250,0.244,0.239,0.234,0.230,0.226,0.222,0.218,0.214], feasibility_scores:[0.016,0.015,0.014,0.013,0.012,0.011,0.010,0.010,0.009,0.009,0.007,0.007,0.007,0.007,0.007,0.008,0.008,0.008,0.008,0.008,0.009,0.009,0.009,0.009,0.010,0.010,0.010,0.011,0.011,0.011]},
    Helix_in_R3: {lambdas:Array.from({length:30},(_,i)=>i*2/29), objectives:[1.855,1.870,1.885,1.900,1.916,1.932,1.948,1.964,1.980,1.997,2.052,2.068,2.082,2.095,2.107,2.118,2.128,2.138,2.148,2.157,2.119,2.178,2.195,2.215,2.235,2.255,2.275,2.300,2.325,2.349], jacobian_norms:[0.383,0.370,0.358,0.347,0.337,0.328,0.319,0.311,0.304,0.297,0.300,0.293,0.287,0.282,0.277,0.273,0.269,0.266,0.263,0.260,0.248,0.245,0.242,0.240,0.237,0.235,0.232,0.230,0.228,0.217], feasibility_scores:[0.023,0.022,0.021,0.020,0.019,0.018,0.018,0.017,0.016,0.016,0.014,0.013,0.013,0.012,0.012,0.011,0.011,0.011,0.010,0.010,0.009,0.009,0.008,0.008,0.008,0.007,0.007,0.007,0.007,0.006]}
  },
  hessian: {
    Circle_in_R2: {0.0:{min:12.28,max:461.67,eigs:[12,34,56,78,100,130,160,190,210,230,250,270,290,320,350,380,410,440,462]},0.1:{min:10.83,max:476.92,eigs:[11,40,70,100,130,165,200,230,250,270,290,310,340,370,400,430,460,477]},0.5:{min:10.45,max:580.49,eigs:[10,45,80,115,150,190,230,260,290,320,350,390,430,470,510,550,580]},1.0:{min:11.52,max:671.04,eigs:[12,50,90,130,175,220,260,300,340,380,420,470,520,570,620,670]}},
    Sphere_in_R3: {0.0:{min:8.18,max:76.64,eigs:[8,14,20,25,30,34,37,39,41,43,46,50,54,58,63,68,73,77]},0.1:{min:8.69,max:75.44,eigs:[9,15,21,26,31,35,38,40,42,44,47,51,55,59,64,69,73,75]},0.5:{min:7.08,max:70.88,eigs:[7,13,18,23,27,31,34,36,38,40,42,45,49,53,58,63,67,71]},1.0:{min:62.76,max:859.35,eigs:[63,120,180,240,300,350,400,440,480,530,590,650,720,790,860]}},
    Helix_in_R3: {0.0:{min:141.03,max:1870.47,eigs:[141,280,420,560,700,830,940,1050,1160,1280,1400,1520,1650,1770,1870]},0.1:{min:81.96,max:982.71,eigs:[82,140,200,260,320,380,440,500,560,630,700,770,850,920,983]},0.5:{min:124.54,max:1512.43,eigs:[125,220,310,400,500,590,680,770,870,970,1080,1190,1300,1410,1512]},1.0:{min:326.87,max:3896.46,eigs:[327,580,830,1080,1340,1600,1850,2100,2360,2630,2900,3180,3460,3700,3896]}}
  },
  geometry: {
    Circle_in_R2: {lambda:[0,0.01,0.1,0.5,1.0], learned_trace:[0.450,0.444,0.405,0.313,0.261], true_trace:[1.0,1.0,1.0,1.0,1.0]},
    Sphere_in_R3: {lambda:[0,0.01,0.1,0.5,1.0], learned_trace:[1.010,0.989,0.825,0.639,0.515], true_trace:[8.0,8.0,8.0,8.0,8.0]},
    Helix_in_R3: {lambda:[0,0.01,0.1,0.5,1.0], learned_trace:[0.416,0.411,0.388,0.309,0.263], true_trace:[1.025,1.025,1.025,1.025,1.025]}
  }
};

function clearCanvas(ctx,w,h){ctx.fillStyle='#1a1d28';ctx.fillRect(0,0,w,h);}

function drawChart(canvasId,opts){
  const canvas=document.getElementById(canvasId);if(!canvas)return;
  const ctx=canvas.getContext('2d');const W=canvas.width,H=canvas.height;
  const pad={top:30,right:50,bottom:40,left:60};const pw=W-pad.left-pad.right,ph=H-pad.top-pad.bottom;
  clearCanvas(ctx,W,H);
  let allY=[];opts.series.forEach(s=>s.data.forEach(d=>allY.push(d)));
  if(opts.errBars)opts.errBars.forEach(eb=>{eb.upper.forEach(v=>allY.push(v));eb.lower.forEach(v=>allY.push(v));});
  let yMin=Math.min(...allY),yMax=Math.max(...allY);let yRange=yMax-yMin||1;
  yMin-=yRange*0.08;yMax+=yRange*0.08;yRange=yMax-yMin;
  const xVals=opts.xValues;const xMin=Math.min(...xVals),xMax=Math.max(...xVals);const xRange=xMax-xMin||1;
  function toX(v){return pad.left+((v-xMin)/xRange)*pw;}
  function toY(v){return pad.top+ph-((v-yMin)/yRange)*ph;}
  ctx.strokeStyle='#2a2d3a';ctx.lineWidth=0.5;
  for(let i=0;i<=5;i++){let y=pad.top+(i/5)*ph;ctx.beginPath();ctx.moveTo(pad.left,y);ctx.lineTo(W-pad.right,y);ctx.stroke();}
  if(opts.errBars){opts.errBars.forEach((eb,si)=>{ctx.fillStyle=opts.series[si]?opts.series[si].color:'#6c63ff';ctx.globalAlpha=0.15;ctx.beginPath();
  for(let i=0;i<xVals.length;i++){let x=toX(xVals[i]),yu=toY(eb.upper[i]);if(i===0)ctx.moveTo(x,yu);else ctx.lineTo(x,yu);}
  for(let i=xVals.length-1;i>=0;i--)ctx.lineTo(toX(xVals[i]),toY(eb.lower[i]));ctx.closePath();ctx.fill();ctx.globalAlpha=1;});}
  opts.series.forEach(s=>{ctx.strokeStyle=s.color;ctx.lineWidth=2;ctx.beginPath();
  s.data.forEach((d,i)=>{let x=toX(xVals[i]),y=toY(d);if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);});ctx.stroke();
  s.data.forEach((d,i)=>{let x=toX(xVals[i]),y=toY(d);ctx.fillStyle=s.color;ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fill();});});
  ctx.fillStyle='#8b8fa3';ctx.font='11px sans-serif';ctx.textAlign='center';
  xVals.forEach(v=>{let l=typeof v==='number'?(v>=10?v.toFixed(0):v.toFixed(2)):v;ctx.fillText(l,toX(v),H-pad.bottom+18);});
  ctx.fillText(opts.xLabel||'',W/2,H-4);ctx.textAlign='right';
  for(let i=0;i<=5;i++){let val=yMin+(1-i/5)*yRange;ctx.fillText(val.toFixed(3),pad.left-6,pad.top+(i/5)*ph+4);}
  if(opts.series.length>1){let lx=pad.left+10,ly=pad.top+10;opts.series.forEach((s,i)=>{ctx.fillStyle=s.color;ctx.fillRect(lx,ly+i*18,12,10);ctx.fillStyle='#e4e6ed';ctx.textAlign='left';ctx.font='10px sans-serif';ctx.fillText(s.label||'',lx+16,ly+i*18+9);});}
  if(opts.title){ctx.fillStyle='#e4e6ed';ctx.font='bold 12px sans-serif';ctx.textAlign='center';ctx.fillText(opts.title,W/2,16);}
  if(opts.threshold!==undefined){ctx.strokeStyle='#ff6b6b';ctx.lineWidth=1;ctx.setLineDash([5,5]);let ty=toY(opts.threshold);ctx.beginPath();ctx.moveTo(pad.left,ty);ctx.lineTo(W-pad.right,ty);ctx.stroke();ctx.setLineDash([]);}
}

function drawHistogram(canvasId,opts){
  const canvas=document.getElementById(canvasId);if(!canvas)return;const ctx=canvas.getContext('2d');const W=canvas.width,H=canvas.height;
  const pad={top:30,right:40,bottom:40,left:60};const pw=W-pad.left-pad.right,ph=H-pad.top-pad.bottom;clearCanvas(ctx,W,H);
  const allData=opts.datasets;let allVals=[];allData.forEach(ds=>ds.data.forEach(v=>allVals.push(v)));
  let vMin=Math.min(...allVals),vMax=Math.max(...allVals);let range=vMax-vMin||1;vMin-=range*0.05;vMax+=range*0.05;
  const nBins=12;const binW=(vMax-vMin)/nBins;function toX(v){return pad.left+((v-vMin)/(vMax-vMin))*pw;}
  allData.forEach((ds,di)=>{let bins=new Array(nBins).fill(0);ds.data.forEach(v=>{let b=Math.floor((v-vMin)/binW);if(b>=nBins)b=nBins-1;if(b<0)b=0;bins[b]++;});let maxBin=Math.max(...bins)||1;ctx.fillStyle=ds.color;ctx.globalAlpha=0.35;bins.forEach((count,i)=>{let x=toX(vMin+i*binW);let w=toX(vMin+(i+1)*binW)-x;let h=(count/maxBin)*ph*0.8;ctx.fillRect(x+di*2,pad.top+ph-h,w-allData.length*2,h);});ctx.globalAlpha=1;});
  ctx.fillStyle='#8b8fa3';ctx.font='11px sans-serif';ctx.textAlign='center';for(let i=0;i<=5;i++){let v=vMin+(i/5)*(vMax-vMin);ctx.fillText(v.toFixed(0),toX(v),H-pad.bottom+18);}ctx.fillText(opts.xLabel||'',W/2,H-4);
  let lx=W-pad.right-120,ly=pad.top+8;allData.forEach((ds,i)=>{ctx.fillStyle=ds.color;ctx.globalAlpha=0.6;ctx.fillRect(lx,ly+i*16,10,10);ctx.globalAlpha=1;ctx.fillStyle='#e4e6ed';ctx.textAlign='left';ctx.font='9px sans-serif';ctx.fillText(ds.label,lx+14,ly+i*16+9);});
  if(opts.title){ctx.fillStyle='#e4e6ed';ctx.font='bold 12px sans-serif';ctx.textAlign='center';ctx.fillText(opts.title,W/2,16);}
}

function renderLandscape(){const m=document.getElementById('land-manifold').value;const metric=document.getElementById('land-metric').value;const d=DATA.landscape[m];const labels={obj:'Objective',jac:'|J_f(0)|_F^2',feas:'Feasibility'};const k={obj:'obj',jac:'jac',feas:'feas'}[metric];drawChart('chartLandscape',{xValues:d.lambda,series:[{data:d[k+'_mean'],color:'#6c63ff',label:'Mean'}],errBars:[{upper:d[k+'_mean'].map((v,i)=>v+d[k+'_std'][i]),lower:d[k+'_mean'].map((v,i)=>Math.max(0,v-d[k+'_std'][i]))}],xLabel:'Lambda',yLabel:labels[metric],title:m.replace(/_/g,' ')+': '+labels[metric]});}
function renderFeasibility(){const m=document.getElementById('feas-manifold').value;const d=DATA.landscape[m];drawChart('chartFeasibility',{xValues:d.lambda,series:[{data:d.feas_mean,color:'#4ecdc4',label:'Feasibility'}],errBars:[{upper:d.feas_mean.map((v,i)=>v+d.feas_std[i]),lower:d.feas_mean.map((v,i)=>Math.max(0,v-d.feas_std[i]))}],xLabel:'Lambda',yLabel:'Feasibility',title:m.replace(/_/g,' ')+': Feasibility'});}
function renderBootstrap(){const m=document.getElementById('boot-manifold').value;const d=DATA.bootstrap[m];drawChart('chartBootstrap',{xValues:d.lambda,series:[{data:d.mean,color:'#4ecdc4',label:'Mean'}],errBars:[{upper:d.ci_upper,lower:d.ci_lower}],xLabel:'Lambda',yLabel:'95% CI',title:m.replace(/_/g,' ')+': Bootstrap CIs'});}
function renderNoise(){const m=document.getElementById('noise-manifold').value;const d=DATA.noise[m];drawChart('chartNoise',{xValues:d.sigma,series:[{data:d.feas_mean,color:'#ff6b6b',label:'Feasibility'}],errBars:[{upper:d.feas_mean.map((v,i)=>v+d.feas_std[i]),lower:d.feas_mean.map((v,i)=>Math.max(0,v-d.feas_std[i]))}],xLabel:'Noise sigma',yLabel:'Feasibility',title:m.replace(/_/g,' ')+': Noise Sensitivity'});}
function renderSample(){const m=document.getElementById('sample-manifold').value;const d=DATA.samplesize[m];drawChart('chartSample',{xValues:d.n,series:[{data:d.feas_mean,color:'#ffe66d',label:'Feasibility'}],errBars:[{upper:d.feas_mean.map((v,i)=>v+d.feas_std[i]),lower:d.feas_mean.map((v,i)=>Math.max(0,v-d.feas_std[i]))}],xLabel:'n',yLabel:'Feasibility',title:m.replace(/_/g,' ')+': Sample Size Sensitivity'});}
function renderHessian(){const m=document.getElementById('hess-manifold').value;const d=DATA.hessian[m];const colors=['#6c63ff','#4ecdc4','#ffe66d','#ff6b6b'];const lambdas=[0.0,0.1,0.5,1.0];drawHistogram('chartHessian',{datasets:lambdas.map((l,i)=>({data:d[l].eigs,color:colors[i],label:'lambda='+l})),xLabel:'Directional Curvature',title:m.replace(/_/g,' ')+': Curvature Distribution'});}
function renderContinuation(){const m=document.getElementById('cont-manifold').value;const metric=document.getElementById('cont-metric').value;const d=DATA.continuation[m];if(metric==='obj_jac'){drawChart('chartContinuation',{xValues:d.lambdas,series:[{data:d.objectives,color:'#6c63ff',label:'Objective'},{data:d.jacobian_norms,color:'#8b8fa3',label:'|J|^2'}],xLabel:'Lambda',yLabel:'Value',title:m.replace(/_/g,' ')+': Continuation'});}else{drawChart('chartContinuation',{xValues:d.lambdas,series:[{data:d.feasibility_scores,color:'#4ecdc4',label:'Feasibility'}],xLabel:'Lambda',yLabel:'Feasibility',title:m.replace(/_/g,' ')+': Feasibility Along Continuation'});}}
function renderGeometry(){const m=document.getElementById('geom-manifold').value;const d=DATA.geometry[m];drawChart('chartGeometry',{xValues:d.lambda,series:[{data:d.true_trace,color:'#4ecdc4',label:'True Tr(G*)'},{data:d.learned_trace,color:'#ff6b6b',label:'Learned Tr(G)'}],xLabel:'Lambda',yLabel:'Metric Trace',title:m.replace(/_/g,' ')+': Pullback Metric'});}

function showSection(id){document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));document.getElementById(id).classList.add('active');document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));event.target.classList.add('active');setTimeout(()=>{if(id==='landscape')renderLandscape();if(id==='feasibility'){renderFeasibility();renderBootstrap();}if(id==='hessian')renderHessian();if(id==='continuation')renderContinuation();if(id==='geometry')renderGeometry();if(id==='sensitivity'){renderNoise();renderSample();}},50);}
</script>
</body>
</html>
