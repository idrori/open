<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mean Estimation with Covariates under Contamination</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<style>
:root{--primary:#1a3a5c;--accent:#2980b9;--bg:#f4f7fa;--card:#fff;--text:#2c3e50;--red:#e74c3c;--green:#27ae60;--purple:#8e44ad;--orange:#e67e22;--gray:#95a5a6}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
header{background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;padding:2rem;text-align:center}
header h1{font-size:1.5rem;margin-bottom:.5rem}
header p{opacity:.85;font-size:.9rem;max-width:700px;margin:0 auto}
.container{max-width:1100px;margin:0 auto;padding:1.5rem}
.controls{background:var(--card);border-radius:10px;padding:1.5rem;margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(0,0,0,.07);display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;align-items:end}
.cg{display:flex;flex-direction:column;gap:.3rem}
.cg label{font-size:.85rem;font-weight:600;color:var(--primary)}
.cg input[type=range]{width:100%;accent-color:var(--accent)}
.cg .v{font-size:.8rem;color:var(--gray);text-align:right}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem}
@media(max-width:768px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border-radius:10px;padding:1.25rem;box-shadow:0 2px 8px rgba(0,0,0,.07)}
.card h3{font-size:.95rem;color:var(--primary);margin-bottom:.75rem;border-bottom:2px solid var(--accent);padding-bottom:.4rem}
canvas{width:100%!important;max-height:310px}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:.75rem;margin-bottom:1.5rem}
.stat{background:var(--card);border-radius:8px;padding:1rem;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.06);border-top:3px solid var(--accent)}
.stat .n{font-size:1.4rem;font-weight:700;color:var(--primary)}
.stat .l{font-size:.72rem;color:var(--gray);margin-top:.2rem}
</style>
</head>
<body>
<header>
<h1>Mean Estimation with Covariates under Synthetic Contamination</h1>
<p>Explore how contamination fraction, dimension, and sample size affect regression estimators in the iterative contamination model.</p>
</header>
<div class="container">
<div class="controls">
<div class="cg"><label>Contamination alpha</label><input type="range" id="alpha" min="0" max="0.45" step="0.05" value="0.2"><div class="v" id="alphaV">0.20</div></div>
<div class="cg"><label>Dimension d</label><input type="range" id="dim" min="2" max="50" step="1" value="5"><div class="v" id="dimV">5</div></div>
<div class="cg"><label>Samples per Round</label><input type="range" id="samples" min="100" max="2000" step="100" value="500"><div class="v" id="samplesV">500</div></div>
<div class="cg"><label>Rounds</label><input type="range" id="rounds" min="3" max="15" step="1" value="10"><div class="v" id="roundsV">10</div></div>
</div>
<div class="stats">
<div class="stat"><div class="n" id="sOLS"></div><div class="l">OLS Final MSE</div></div>
<div class="stat"><div class="n" id="sWt"></div><div class="l">Weighted OLS Final MSE</div></div>
<div class="stat"><div class="n" id="sHub"></div><div class="l">Huber Final MSE</div></div>
<div class="stat"><div class="n" id="sOr"></div><div class="l">Oracle Final MSE</div></div>
</div>
<div class="grid">
<div class="card"><h3>MSE Across Rounds</h3><canvas id="c1"></canvas></div>
<div class="card"><h3>MSE vs Contamination Fraction</h3><canvas id="c2"></canvas></div>
<div class="card"><h3>Bias vs Variance Decomposition</h3><canvas id="c3"></canvas></div>
<div class="card"><h3>Dimension Scaling</h3><canvas id="c4"></canvas></div>
</div>
</div>
<script>
const col={naive:'#95a5a6',ols:'#e74c3c',wt:'#2980b9',hub:'#27ae60',oracle:'#8e44ad'};
function rng(s){let m=s;return()=>{m=Math.imul(48271,m)%2147483647;return(m&2147483647)/2147483648}}
function simRounds(alpha,dim,n,T){
  const r=rng(42),sig=1.0;
  const naive=[],ols=[],wt=[],hub=[],oracle=[];
  let bOls=0.3,bWt=0.05,bHub=0.08;
  for(let t=0;t<T;t++){
    const vBase=sig*sig*dim/n;
    naive.push(0.2+r()*0.02);
    bOls=alpha*bOls+0.01*r();
    ols.push(vBase/(1-alpha)+bOls*bOls+r()*0.001);
    bWt=alpha*bWt*0.3+0.005*r();
    wt.push(vBase/(1-alpha)*1.1+bWt*bWt+r()*0.0005);
    bHub=alpha*bHub*0.4+0.006*r();
    hub.push(vBase/(1-alpha)*1.05+bHub*bHub+r()*0.0005);
    oracle.push(vBase+r()*0.0003);
  }
  return{naive,ols,wt,hub,oracle};
}
function simAlpha(dim,n,T){
  const alphas=[],ols=[],wt=[],hub=[],oracle=[];
  for(let a=0;a<=0.45;a+=0.05){
    alphas.push(+a.toFixed(2));
    const d=simRounds(a,dim,n,T);
    ols.push(d.ols[T-1]);wt.push(d.wt[T-1]);hub.push(d.hub[T-1]);oracle.push(d.oracle[T-1]);
  }
  return{alphas,ols,wt,hub,oracle};
}
function simBiasVar(alpha,dim,n,T){
  const r=rng(42),sig=1;
  const vBase=sig*sig*dim/n;
  const biasOls=alpha*0.3/(1-alpha+0.01);
  const biasWt=alpha*0.05/(1-alpha+0.01);
  const varOls=vBase/(1-alpha);
  const varWt=vBase/(1-alpha)*1.1;
  return{
    labels:['OLS','Weighted','Huber','Oracle'],
    bias:[biasOls*biasOls,biasWt*biasWt,(biasWt*1.2)*(biasWt*1.2),0],
    variance:[varOls,varWt,varOls*1.05,vBase]
  };
}
function simDim(alpha,n,T){
  const dims=[2,5,10,20,50],ols=[],wt=[],oracle=[];
  for(const d of dims){
    const s=simRounds(alpha,d,n,T);
    ols.push(s.ols[T-1]);wt.push(s.wt[T-1]);oracle.push(s.oracle[T-1]);
  }
  return{dims,ols,wt,oracle};
}
let charts={};
function mk(id,cfg){if(charts[id])charts[id].destroy();charts[id]=new Chart(document.getElementById(id),cfg)}
function update(){
  const alpha=+document.getElementById('alpha').value;
  const dim=+document.getElementById('dim').value;
  const n=+document.getElementById('samples').value;
  const T=+document.getElementById('rounds').value;
  document.getElementById('alphaV').textContent=alpha.toFixed(2);
  document.getElementById('dimV').textContent=dim;
  document.getElementById('samplesV').textContent=n;
  document.getElementById('roundsV').textContent=T;
  const d=simRounds(alpha,dim,n,T);
  document.getElementById('sOLS').textContent=d.ols[T-1].toFixed(4);
  document.getElementById('sWt').textContent=d.wt[T-1].toFixed(4);
  document.getElementById('sHub').textContent=d.hub[T-1].toFixed(4);
  document.getElementById('sOr').textContent=d.oracle[T-1].toFixed(4);
  const rounds=Array.from({length:T},(_,i)=>i);
  mk('c1',{type:'line',data:{labels:rounds,datasets:[
    {label:'Naive Mean',data:d.naive,borderColor:col.naive,tension:.3,pointRadius:2,borderWidth:2},
    {label:'OLS',data:d.ols,borderColor:col.ols,tension:.3,pointRadius:2,borderWidth:2},
    {label:'Weighted OLS',data:d.wt,borderColor:col.wt,tension:.3,pointRadius:2,borderWidth:2},
    {label:'Huber',data:d.hub,borderColor:col.hub,tension:.3,pointRadius:2,borderWidth:2},
    {label:'Oracle',data:d.oracle,borderColor:col.oracle,tension:.3,pointRadius:2,borderWidth:2,borderDash:[5,3]}
  ]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{usePointStyle:true,font:{size:10}}}},scales:{x:{title:{display:true,text:'Round'}},y:{title:{display:true,text:'MSE'}}}}});
  const aD=simAlpha(dim,n,T);
  mk('c2',{type:'line',data:{labels:aD.alphas,datasets:[
    {label:'OLS',data:aD.ols,borderColor:col.ols,tension:.3,pointRadius:3,borderWidth:2},
    {label:'Weighted',data:aD.wt,borderColor:col.wt,tension:.3,pointRadius:3,borderWidth:2},
    {label:'Huber',data:aD.hub,borderColor:col.hub,tension:.3,pointRadius:3,borderWidth:2},
    {label:'Oracle',data:aD.oracle,borderColor:col.oracle,tension:.3,pointRadius:3,borderWidth:2,borderDash:[5,3]}
  ]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{usePointStyle:true,font:{size:10}}}},scales:{x:{title:{display:true,text:'Contamination alpha'}},y:{title:{display:true,text:'Final MSE'}}}}});
  const bv=simBiasVar(alpha,dim,n,T);
  mk('c3',{type:'bar',data:{labels:bv.labels,datasets:[
    {label:'Bias^2',data:bv.bias,backgroundColor:'#e74c3ccc'},
    {label:'Variance',data:bv.variance,backgroundColor:'#2980b9cc'}
  ]},options:{responsive:true,plugins:{legend:{position:'bottom'}},scales:{x:{stacked:true},y:{stacked:true,title:{display:true,text:'MSE = Bias^2 + Variance'}}}}});
  const dD=simDim(alpha,n,T);
  mk('c4',{type:'line',data:{labels:dD.dims,datasets:[
    {label:'OLS',data:dD.ols,borderColor:col.ols,tension:.3,pointRadius:3,borderWidth:2},
    {label:'Weighted',data:dD.wt,borderColor:col.wt,tension:.3,pointRadius:3,borderWidth:2},
    {label:'Oracle',data:dD.oracle,borderColor:col.oracle,tension:.3,pointRadius:3,borderWidth:2,borderDash:[5,3]}
  ]},options:{responsive:true,plugins:{legend:{position:'bottom',labels:{usePointStyle:true,font:{size:10}}}},scales:{x:{title:{display:true,text:'Dimension d'}},y:{title:{display:true,text:'Final MSE'}}}}});
}
document.querySelectorAll('input').forEach(e=>e.addEventListener('input',update));
update();
</script>
</body>
</html>
