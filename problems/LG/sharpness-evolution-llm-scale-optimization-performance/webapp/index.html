<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sharpness Evolution at LLM Scale</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    line-height: 1.6;
  }
  .header {
    background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    padding: 2rem;
    text-align: center;
    border-bottom: 2px solid #3b82f6;
  }
  .header h1 {
    font-size: 1.6rem;
    color: #f1f5f9;
    margin-bottom: 0.5rem;
  }
  .header p {
    color: #94a3b8;
    font-size: 0.95rem;
    max-width: 800px;
    margin: 0 auto;
  }
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 1.5rem;
  }
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }
  .stat-card {
    background: #1e293b;
    border-radius: 12px;
    padding: 1.2rem;
    border: 1px solid #334155;
    text-align: center;
  }
  .stat-value {
    font-size: 1.8rem;
    font-weight: 700;
    color: #3b82f6;
  }
  .stat-label {
    font-size: 0.85rem;
    color: #94a3b8;
    margin-top: 0.3rem;
  }
  .chart-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(520px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }
  .chart-card {
    background: #1e293b;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #334155;
  }
  .chart-card h3 {
    font-size: 1rem;
    color: #f1f5f9;
    margin-bottom: 1rem;
  }
  .chart-container {
    position: relative;
    height: 340px;
  }
  .table-card {
    background: #1e293b;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #334155;
    margin-bottom: 1.5rem;
    overflow-x: auto;
  }
  .table-card h3 {
    font-size: 1rem;
    color: #f1f5f9;
    margin-bottom: 1rem;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  th, td {
    padding: 0.6rem 0.8rem;
    text-align: center;
    border-bottom: 1px solid #334155;
  }
  th {
    color: #94a3b8;
    font-weight: 600;
    background: #0f172a;
  }
  td { color: #e2e8f0; }
  .highlight { color: #3b82f6; font-weight: 600; }
  .negative { color: #f87171; }
  .positive { color: #4ade80; }
  .findings {
    background: #1e293b;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #334155;
    margin-bottom: 1.5rem;
  }
  .findings h3 {
    color: #f1f5f9;
    margin-bottom: 1rem;
  }
  .findings ul {
    list-style: none;
    padding: 0;
  }
  .findings li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #1e293b;
    padding-left: 1.5rem;
    position: relative;
  }
  .findings li::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #3b82f6;
  }
  .controls {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }
  .btn {
    padding: 0.5rem 1rem;
    border: 1px solid #3b82f6;
    background: transparent;
    color: #3b82f6;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
  }
  .btn:hover, .btn.active {
    background: #3b82f6;
    color: #fff;
  }
  .pdf-link {
    display: inline-block;
    margin-top: 0.8rem;
    padding: 0.5rem 1.2rem;
    background: #3b82f6;
    color: #fff;
    text-decoration: none;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: background 0.2s;
  }
  .pdf-link:hover { background: #2563eb; }
  .footer {
    text-align: center;
    padding: 1.5rem;
    color: #64748b;
    font-size: 0.8rem;
    border-top: 1px solid #334155;
  }
</style>
</head>
<body>

<div class="header">
  <h1>Sharpness Evolution and Its Relationship to Optimization and Performance at LLM Scale</h1>
  <p>Simulation study of how loss landscape sharpness evolves during training across model scales (10M to 7B parameters), and its relationship to optimization behavior and downstream task performance.</p>
  <a class="pdf-link" href="../revision/paper/main.pdf">View Paper (PDF)</a>
</div>

<div class="container">

  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-value">-0.1055</div>
      <div class="stat-label">Scaling Law Slope (sharpness per decade)</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">0.9983</div>
      <div class="stat-label">Scaling Law R-squared</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">0.9945</div>
      <div class="stat-label">Sharpness-Loss Correlation</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">-0.9992</div>
      <div class="stat-label">Sharpness-Performance Correlation</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">-0.9991</div>
      <div class="stat-label">Scale-Sharpness Correlation</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">5.13</div>
      <div class="stat-label">Mean EoS Damping Rate</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">-61.86</div>
      <div class="stat-label">Log-Linear AIC (Best Fit)</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">0.9999</div>
      <div class="stat-label">Early Prediction R² (10% data)</div>
    </div>
  </div>

  <div class="chart-grid">
    <div class="chart-card">
      <h3>Sharpness Evolution During Training</h3>
      <div class="controls" id="modelToggles"></div>
      <div class="chart-container">
        <canvas id="evolutionChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Sharpness Scaling Law</h3>
      <div class="chart-container">
        <canvas id="scalingChart"></canvas>
      </div>
    </div>
  </div>

  <div class="chart-grid">
    <div class="chart-card">
      <h3>Training Loss Trajectories</h3>
      <div class="chart-container">
        <canvas id="lossChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Sharpness vs. Downstream Performance</h3>
      <div class="chart-container">
        <canvas id="performanceChart"></canvas>
      </div>
    </div>
  </div>

  <div class="chart-grid">
    <div class="chart-card">
      <h3>Sharpness-Gradient Correlation by Scale</h3>
      <div class="chart-container">
        <canvas id="gradientCorrChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Downstream Task Performance by Scale</h3>
      <div class="chart-container">
        <canvas id="taskChart"></canvas>
      </div>
    </div>
  </div>

  <div class="chart-grid">
    <div class="chart-card">
      <h3>Edge-of-Stability Dynamics</h3>
      <div class="chart-container">
        <canvas id="eosChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Power-Law vs Log-Linear Scaling</h3>
      <div class="chart-container">
        <canvas id="powerLawChart"></canvas>
      </div>
    </div>
  </div>

  <div class="chart-grid">
    <div class="chart-card">
      <h3>Early Prediction Accuracy</h3>
      <div class="chart-container">
        <canvas id="earlyPredChart"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Model Information Criteria Comparison</h3>
      <div class="chart-container">
        <canvas id="aicChart"></canvas>
      </div>
    </div>
  </div>

  <div class="table-card">
    <h3>Edge-of-Stability Dynamics</h3>
    <table>
      <thead>
        <tr>
          <th>Model</th>
          <th>Damping Rate</th>
          <th>Peak/Plateau Ratio</th>
          <th>Oscillations</th>
          <th>Osc. Amplitude</th>
          <th>Damping R²</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>10M</td><td>4.716</td><td>1.615</td><td>25</td><td>0.0225</td><td>0.922</td></tr>
        <tr><td>125M</td><td>4.960</td><td>2.085</td><td>23</td><td>0.0283</td><td>0.938</td></tr>
        <tr><td>350M</td><td>5.131</td><td>2.297</td><td>24</td><td>0.0276</td><td>0.946</td></tr>
        <tr><td>1.3B</td><td>5.229</td><td>2.614</td><td>28</td><td>0.0320</td><td>0.931</td></tr>
        <tr><td>3B</td><td>5.333</td><td>2.823</td><td>22</td><td>0.0356</td><td>0.937</td></tr>
        <tr><td class="highlight">7B</td><td class="highlight">5.388</td><td class="highlight">3.092</td><td>19</td><td class="highlight">0.0362</td><td class="highlight">0.946</td></tr>
      </tbody>
    </table>
  </div>

  <div class="table-card">
    <h3>Functional Form Comparison</h3>
    <table>
      <thead>
        <tr>
          <th>Model</th>
          <th>R²</th>
          <th>AIC</th>
          <th>BIC</th>
          <th>Parameters</th>
        </tr>
      </thead>
      <tbody>
        <tr><td class="highlight">Log-Linear</td><td class="highlight">0.9983</td><td class="highlight">-61.86</td><td class="highlight">-62.28</td><td>2</td></tr>
        <tr><td>Power-Law</td><td>0.9945</td><td>-54.92</td><td>-55.33</td><td>2</td></tr>
        <tr><td>Exponential Decay</td><td>0.9983</td><td>-59.85</td><td>-60.48</td><td>3</td></tr>
      </tbody>
    </table>
  </div>

  <div class="table-card">
    <h3>Scale Summary</h3>
    <table>
      <thead>
        <tr>
          <th>Model</th>
          <th>Peak Sharpness</th>
          <th>Final Sharpness</th>
          <th>Final Loss</th>
          <th>Mean Accuracy</th>
          <th>Sharp.-Loss r</th>
          <th>Sharp.-Grad r</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>10M</td><td>2.0644</td><td>1.2785</td><td>5.009</td><td>0.3616</td><td>0.4445</td><td>0.9218</td></tr>
        <tr><td>125M</td><td>2.4108</td><td>1.1669</td><td>4.1508</td><td>0.4532</td><td>0.4794</td><td>0.9638</td></tr>
        <tr><td>350M</td><td>2.5996</td><td>1.1217</td><td>3.8431</td><td>0.4843</td><td>0.4884</td><td>0.9705</td></tr>
        <tr><td>1.3B</td><td>2.7585</td><td>1.0646</td><td>3.4863</td><td>0.5344</td><td>0.5181</td><td>0.9795</td></tr>
        <tr><td>3B</td><td>2.8945</td><td>1.0135</td><td>3.2753</td><td>0.5674</td><td>0.5227</td><td>0.982</td></tr>
        <tr><td>7B</td><td class="highlight">2.9976</td><td class="highlight">0.9804</td><td class="highlight">3.077</td><td class="highlight">0.603</td><td>0.5335</td><td class="highlight">0.9849</td></tr>
      </tbody>
    </table>
  </div>

  <div class="table-card">
    <h3>Downstream Task Accuracy</h3>
    <table>
      <thead>
        <tr>
          <th>Model</th>
          <th>HellaSwag</th>
          <th>ARC-Easy</th>
          <th>PIQA</th>
          <th>WinoGrande</th>
          <th>LAMBADA</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>10M</td><td>0.3658</td><td>0.387</td><td>0.4318</td><td>0.3266</td><td>0.2966</td></tr>
        <tr><td>125M</td><td>0.4474</td><td>0.477</td><td>0.5057</td><td>0.441</td><td>0.3951</td></tr>
        <tr><td>350M</td><td>0.4743</td><td>0.5041</td><td>0.5521</td><td>0.4598</td><td>0.4312</td></tr>
        <tr><td>1.3B</td><td>0.548</td><td>0.5612</td><td>0.5921</td><td>0.5121</td><td>0.4586</td></tr>
        <tr><td>3B</td><td>0.558</td><td>0.6098</td><td>0.631</td><td>0.5317</td><td>0.5064</td></tr>
        <tr><td>7B</td><td class="highlight">0.6144</td><td class="highlight">0.6286</td><td class="highlight">0.6508</td><td class="highlight">0.578</td><td class="highlight">0.5432</td></tr>
      </tbody>
    </table>
  </div>

  <div class="findings">
    <h3>Key Findings</h3>
    <ul>
      <li>Final sharpness obeys a log-linear scaling law: S = -0.1055 * log10(N) + 2.0196 with R-squared = 0.9983</li>
      <li>Larger models converge to flatter minima: final sharpness decreases from 1.2785 (10M) to 0.9804 (7B)</li>
      <li>Strong negative correlation between final sharpness and downstream performance (r = -0.9992)</li>
      <li>Strong positive correlation between final sharpness and training loss (r = 0.9945)</li>
      <li>Sharpness-gradient coupling strengthens with scale: r increases from 0.9218 (10M) to 0.9849 (7B)</li>
      <li>All models exhibit a three-phase sharpness pattern: initial rise, exponential decay, and plateau stabilization</li>
      <li>Peak sharpness increases with scale: from 2.0644 (10M) to 2.9976 (7B)</li>
      <li>Edge-of-stability damping rate increases with scale: 4.72 (10M) to 5.39 (7B), peak-to-plateau ratio 1.61 to 3.09</li>
      <li>Log-linear scaling law wins AIC/BIC comparison: AIC = -61.86 vs power-law -54.92, despite equal parameter count</li>
      <li>Early prediction from 10% training data achieves R² = 0.9999 via regression combining early sharpness features with model scale</li>
    </ul>
  </div>

</div>

<div class="footer">
  <p>Sharpness Evolution Study | Simulation with seed 42 | Based on Kalra et al. (2026) arXiv:2601.16979</p>
</div>

<script>
const COLORS = ['#3b82f6','#f97316','#22c55e','#ef4444','#a855f7','#ec4899'];
const MODELS = ['10M','125M','350M','1.3B','3B','7B'];
const LOG_PARAMS = [7.0, 8.0969, 8.5441, 9.1139, 9.4771, 9.8451];

// Sharpness trajectories (sampled every 10 steps for chart performance)
const trajectoryData = {
  "10M":{"sharpness":[1.2061, 1.3436, 1.5115, 1.5706, 1.6979, 1.8512, 2.0644, 1.9907, 1.9, 1.8142, 1.778, 1.7465, 1.6995, 1.6944, 1.5932, 1.5987, 1.5868, 1.5783, 1.5491, 1.4612, 1.4516, 1.4488, 1.4615, 1.4255, 1.3828, 1.3826, 1.3601, 1.3512, 1.374, 1.3356, 1.317, 1.3462, 1.2954, 1.2975, 1.2897, 1.2871, 1.2992, 1.3061, 1.3141, 1.2559],"loss":[10.0, 9.41, 8.89, 8.43, 8.01, 7.65, 7.32, 7.05, 6.8, 6.58, 6.4, 6.24, 6.08, 5.96, 5.83, 5.73, 5.64, 5.56, 5.49, 5.43, 5.39, 5.32, 5.29, 5.24, 5.22, 5.19, 5.17, 5.13, 5.1, 5.09, 5.09, 5.07, 5.06, 5.06, 5.04, 5.04, 5.02, 5.01, 5.0, 5.0]},
  "125M":{"sharpness":[1.081, 1.3189, 1.5147, 1.7094, 1.9392, 2.269, 2.3884, 2.2199, 2.1261, 2.111, 2.037, 1.9121, 1.8053, 1.7907, 1.7559, 1.7377, 1.6387, 1.5826, 1.5226, 1.5593, 1.4819, 1.4463, 1.3722, 1.388, 1.4211, 1.3673, 1.3156, 1.3122, 1.3126, 1.2856, 1.2818, 1.2538, 1.1766, 1.2639, 1.2182, 1.1859, 1.1757, 1.1554, 1.1736, 1.1432],"loss":[9.9, 9.2, 8.61, 8.07, 7.6, 7.19, 6.82, 6.52, 6.22, 5.97, 5.75, 5.54, 5.39, 5.23, 5.08, 4.98, 4.88, 4.78, 4.71, 4.63, 4.58, 4.51, 4.47, 4.42, 4.4, 4.35, 4.32, 4.3, 4.27, 4.24, 4.24, 4.23, 4.2, 4.19, 4.17, 4.17, 4.17, 4.16, 4.15, 4.14]},
  "350M":{"sharpness":[1.0366, 1.3001, 1.5662, 1.7934, 2.0545, 2.3751, 2.5613, 2.3599, 2.2596, 2.1657, 2.1387, 1.9909, 1.9205, 1.8352, 1.835, 1.7391, 1.6433, 1.6091, 1.5774, 1.4803, 1.4421, 1.4627, 1.3882, 1.4213, 1.3067, 1.3477, 1.2656, 1.3447, 1.2605, 1.236, 1.1917, 1.2141, 1.1638, 1.181, 1.1752, 1.1461, 1.1329, 1.1804, 1.1382, 1.1181],"loss":[9.84, 9.12, 8.5, 7.94, 7.45, 7.02, 6.63, 6.31, 6.0, 5.74, 5.52, 5.31, 5.13, 4.97, 4.84, 4.7, 4.6, 4.5, 4.42, 4.35, 4.28, 4.23, 4.16, 4.14, 4.09, 4.05, 4.02, 3.99, 3.96, 3.95, 3.93, 3.91, 3.9, 3.88, 3.88, 3.86, 3.85, 3.85, 3.84, 3.84]},
  "1.3B":{"sharpness":[0.9342, 1.2687, 1.6161, 1.8854, 2.2311, 2.5924, 2.6322, 2.4719, 2.3635, 2.3326, 2.1934, 2.0603, 1.9065, 1.9373, 1.8432, 1.7464, 1.6377, 1.6203, 1.5541, 1.475, 1.3603, 1.4038, 1.3736, 1.2927, 1.3335, 1.2548, 1.2288, 1.2285, 1.1597, 1.19, 1.1965, 1.1424, 1.1341, 1.1171, 1.1093, 1.1034, 1.0736, 1.049, 1.0982, 1.0203],"loss":[9.79, 9.04, 8.36, 7.8, 7.28, 6.83, 6.41, 6.08, 5.76, 5.47, 5.24, 5.02, 4.83, 4.68, 4.53, 4.4, 4.29, 4.18, 4.09, 4.02, 3.94, 3.89, 3.83, 3.79, 3.74, 3.71, 3.67, 3.64, 3.62, 3.59, 3.59, 3.56, 3.55, 3.54, 3.52, 3.51, 3.49, 3.49, 3.48, 3.48]},
  "3B":{"sharpness":[0.8517, 1.3501, 1.5778, 1.8989, 2.3401, 2.8169, 2.7629, 2.5776, 2.4436, 2.3656, 2.2087, 2.0736, 2.0622, 1.9507, 1.8522, 1.7806, 1.6997, 1.6734, 1.5379, 1.4565, 1.4479, 1.4509, 1.392, 1.328, 1.3045, 1.2662, 1.1781, 1.1675, 1.1868, 1.1457, 1.1906, 1.1036, 1.0692, 1.1222, 1.0379, 1.0113, 1.0248, 1.016, 0.9676, 0.974],"loss":[9.75, 8.98, 8.3, 7.71, 7.18, 6.7, 6.28, 5.93, 5.6, 5.33, 5.09, 4.86, 4.68, 4.5, 4.33, 4.22, 4.1, 3.99, 3.9, 3.82, 3.75, 3.68, 3.62, 3.58, 3.53, 3.51, 3.47, 3.43, 3.41, 3.39, 3.38, 3.37, 3.35, 3.32, 3.32, 3.3, 3.29, 3.28, 3.27, 3.27]},
  "7B":{"sharpness":[0.859, 1.3116, 1.6562, 2.026, 2.4432, 2.914, 2.8337, 2.7007, 2.5742, 2.469, 2.2243, 2.1071, 2.0898, 2.0019, 1.7866, 1.7123, 1.7151, 1.637, 1.542, 1.488, 1.4798, 1.4128, 1.2821, 1.2907, 1.2978, 1.2353, 1.15, 1.1678, 1.1715, 1.1416, 1.0245, 1.0526, 1.0335, 0.9895, 1.0384, 1.0023, 0.9989, 0.975, 0.9764, 1.0153],"loss":[9.71, 8.92, 8.23, 7.62, 7.07, 6.6, 6.17, 5.8, 5.47, 5.19, 4.92, 4.72, 4.51, 4.32, 4.18, 4.04, 3.92, 3.81, 3.72, 3.62, 3.56, 3.5, 3.44, 3.39, 3.35, 3.31, 3.26, 3.24, 3.21, 3.19, 3.17, 3.16, 3.14, 3.12, 3.12, 3.1, 3.08, 3.07, 3.08, 3.07]}
};

const tFrac = Array.from({length:40}, (_,i) => (i*5/200).toFixed(3));

// --- Chart 1: Sharpness Evolution ---
const evolCtx = document.getElementById('evolutionChart').getContext('2d');
const evolChart = new Chart(evolCtx, {
  type: 'line',
  data: {
    labels: tFrac,
    datasets: MODELS.map((m, i) => ({
      label: m,
      data: trajectoryData[m].sharpness,
      borderColor: COLORS[i],
      backgroundColor: COLORS[i] + '20',
      borderWidth: 2,
      pointRadius: 0,
      tension: 0.3
    }))
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'Training Fraction', color: '#94a3b8' }, ticks: { color: '#64748b', maxTicksLimit: 10 }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'Critical Sharpness', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// Model toggles
const toggleContainer = document.getElementById('modelToggles');
MODELS.forEach((m, i) => {
  const btn = document.createElement('button');
  btn.className = 'btn active';
  btn.textContent = m;
  btn.style.borderColor = COLORS[i];
  btn.style.background = COLORS[i];
  btn.style.color = '#fff';
  btn.onclick = () => {
    const ds = evolChart.data.datasets[i];
    ds.hidden = !ds.hidden;
    btn.style.background = ds.hidden ? 'transparent' : COLORS[i];
    btn.style.color = ds.hidden ? COLORS[i] : '#fff';
    evolChart.update();
  };
  toggleContainer.appendChild(btn);
});

// --- Chart 2: Scaling Law ---
const scalCtx = document.getElementById('scalingChart').getContext('2d');
const finalSharpness = [1.2785, 1.1669, 1.1217, 1.0646, 1.0135, 0.9804];
const fitX = Array.from({length:50}, (_,i) => 6.8 + i * 0.07);
const fitY = fitX.map(x => -0.1055 * x + 2.0196);

new Chart(scalCtx, {
  type: 'scatter',
  data: {
    datasets: [
      {
        label: 'Measured',
        data: LOG_PARAMS.map((x, i) => ({x, y: finalSharpness[i]})),
        backgroundColor: '#ef4444',
        pointRadius: 7,
        pointBorderColor: '#fff',
        pointBorderWidth: 2
      },
      {
        label: 'Fit: S = -0.1055 log10(N) + 2.0196',
        data: fitX.map((x, i) => ({x, y: fitY[i]})),
        type: 'line',
        borderColor: '#94a3b8',
        borderDash: [6, 4],
        borderWidth: 2,
        pointRadius: 0,
        fill: false
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'log10(Parameters)', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'Final Sharpness', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// --- Chart 3: Loss Trajectories ---
const lossCtx = document.getElementById('lossChart').getContext('2d');
new Chart(lossCtx, {
  type: 'line',
  data: {
    labels: tFrac,
    datasets: MODELS.map((m, i) => ({
      label: m,
      data: trajectoryData[m].loss,
      borderColor: COLORS[i],
      borderWidth: 2,
      pointRadius: 0,
      tension: 0.3
    }))
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'Training Fraction', color: '#94a3b8' }, ticks: { color: '#64748b', maxTicksLimit: 10 }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'Training Loss', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// --- Chart 4: Sharpness vs Performance ---
const perfCtx = document.getElementById('performanceChart').getContext('2d');
const meanAcc = [0.3616, 0.4532, 0.4843, 0.5344, 0.5674, 0.603];
new Chart(perfCtx, {
  type: 'scatter',
  data: {
    datasets: [{
      label: 'Model Scale',
      data: finalSharpness.map((s, i) => ({x: s, y: meanAcc[i]})),
      backgroundColor: COLORS.map(c => c + 'cc'),
      pointRadius: 9,
      pointBorderColor: '#fff',
      pointBorderWidth: 2
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'Final Sharpness', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' }, reverse: true },
      y: { title: { display: true, text: 'Mean Downstream Accuracy', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } }
    },
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: (ctx) => MODELS[ctx.dataIndex] + ': sharpness=' + ctx.parsed.x + ', acc=' + ctx.parsed.y
        }
      }
    }
  }
});

// --- Chart 5: Gradient-Sharpness Correlation ---
const gradCorrCtx = document.getElementById('gradientCorrChart').getContext('2d');
const gradCorrs = [0.9218, 0.9638, 0.9705, 0.9795, 0.982, 0.9849];
new Chart(gradCorrCtx, {
  type: 'line',
  data: {
    labels: MODELS,
    datasets: [{
      label: 'Sharpness-Gradient Correlation',
      data: gradCorrs,
      borderColor: '#a855f7',
      backgroundColor: '#a855f720',
      borderWidth: 2.5,
      pointRadius: 6,
      pointBackgroundColor: '#a855f7',
      pointBorderColor: '#fff',
      pointBorderWidth: 2,
      fill: true,
      tension: 0.3
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'Model Scale', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'Correlation (r)', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' }, min: 0.9, max: 1.0 }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// --- Chart 6: Task Performance ---
const taskCtx = document.getElementById('taskChart').getContext('2d');
const tasks = ['HellaSwag','ARC-Easy','PIQA','WinoGrande','LAMBADA'];
const taskData = {
  "10M": [0.3658, 0.387, 0.4318, 0.3266, 0.2966],
  "125M": [0.4474, 0.477, 0.5057, 0.441, 0.3951],
  "350M": [0.4743, 0.5041, 0.5521, 0.4598, 0.4312],
  "1.3B": [0.548, 0.5612, 0.5921, 0.5121, 0.4586],
  "3B": [0.558, 0.6098, 0.631, 0.5317, 0.5064],
  "7B": [0.6144, 0.6286, 0.6508, 0.578, 0.5432]
};

new Chart(taskCtx, {
  type: 'bar',
  data: {
    labels: tasks,
    datasets: MODELS.map((m, i) => ({
      label: m,
      data: taskData[m],
      backgroundColor: COLORS[i] + 'cc',
      borderColor: COLORS[i],
      borderWidth: 1
    }))
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { ticks: { color: '#64748b' }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'Accuracy', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' }, min: 0.2, max: 0.75 }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// --- Chart 7: EoS Dynamics ---
const eosCtx = document.getElementById('eosChart').getContext('2d');
const dampingRates = [4.716, 4.960, 5.131, 5.229, 5.333, 5.388];
const peakPlateauRatios = [1.615, 2.085, 2.297, 2.614, 2.823, 3.092];
new Chart(eosCtx, {
  type: 'line',
  data: {
    labels: MODELS,
    datasets: [
      {
        label: 'Damping Rate',
        data: dampingRates,
        borderColor: '#3b82f6',
        backgroundColor: '#3b82f620',
        borderWidth: 2.5,
        pointRadius: 6,
        pointBackgroundColor: '#3b82f6',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        fill: true,
        tension: 0.3,
        yAxisID: 'y'
      },
      {
        label: 'Peak/Plateau Ratio',
        data: peakPlateauRatios,
        borderColor: '#f97316',
        backgroundColor: '#f9731620',
        borderWidth: 2.5,
        pointRadius: 6,
        pointBackgroundColor: '#f97316',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        fill: true,
        tension: 0.3,
        yAxisID: 'y1'
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'Model Scale', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'Damping Rate', color: '#3b82f6' }, ticks: { color: '#3b82f6' }, grid: { color: '#1e293b' }, position: 'left' },
      y1: { title: { display: true, text: 'Peak/Plateau Ratio', color: '#f97316' }, ticks: { color: '#f97316' }, grid: { drawOnChartArea: false }, position: 'right' }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// --- Chart 8: Power-Law vs Log-Linear ---
const plCtx = document.getElementById('powerLawChart').getContext('2d');
const plFitX = Array.from({length:60}, (_,i) => 6.5 + i * 0.07);
const logLinearFitY = plFitX.map(x => -0.1055 * x + 2.0196);
const powerLawFitY = plFitX.map(x => 2.484 * Math.pow(10, -0.04077 * x));
new Chart(plCtx, {
  type: 'scatter',
  data: {
    datasets: [
      {
        label: 'Measured',
        data: LOG_PARAMS.map((x, i) => ({x, y: finalSharpness[i]})),
        backgroundColor: '#ef4444',
        pointRadius: 7,
        pointBorderColor: '#fff',
        pointBorderWidth: 2
      },
      {
        label: 'Log-Linear (R²=0.9983)',
        data: plFitX.map((x, i) => ({x, y: logLinearFitY[i]})),
        type: 'line',
        borderColor: '#3b82f6',
        borderWidth: 2,
        pointRadius: 0,
        fill: false
      },
      {
        label: 'Power-Law (R²=0.9945)',
        data: plFitX.map((x, i) => ({x, y: powerLawFitY[i]})),
        type: 'line',
        borderColor: '#f97316',
        borderDash: [6, 4],
        borderWidth: 2,
        pointRadius: 0,
        fill: false
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'log10(Parameters)', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'Final Sharpness', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// --- Chart 9: Early Prediction ---
const epCtx = document.getElementById('earlyPredChart').getContext('2d');
const fractions = [0.1, 0.2, 0.3, 0.5];
const regR2 = [0.9999, 0.9999, 1.0, 0.9999];
const regMAE = [0.0006, 0.0009, 0.0006, 0.0005];
new Chart(epCtx, {
  type: 'line',
  data: {
    labels: fractions.map(f => (f*100) + '%'),
    datasets: [
      {
        label: 'Regression R²',
        data: regR2,
        borderColor: '#22c55e',
        backgroundColor: '#22c55e20',
        borderWidth: 2.5,
        pointRadius: 7,
        pointBackgroundColor: '#22c55e',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        fill: true,
        tension: 0.3,
        yAxisID: 'y'
      },
      {
        label: 'Regression MAE',
        data: regMAE,
        borderColor: '#a855f7',
        backgroundColor: '#a855f720',
        borderWidth: 2.5,
        pointRadius: 7,
        pointBackgroundColor: '#a855f7',
        pointBorderColor: '#fff',
        pointBorderWidth: 2,
        fill: true,
        tension: 0.3,
        yAxisID: 'y1'
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      x: { title: { display: true, text: 'Training Fraction Used', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } },
      y: { title: { display: true, text: 'R²', color: '#22c55e' }, ticks: { color: '#22c55e' }, grid: { color: '#1e293b' }, position: 'left', min: 0.999, max: 1.001 },
      y1: { title: { display: true, text: 'MAE', color: '#a855f7' }, ticks: { color: '#a855f7' }, grid: { drawOnChartArea: false }, position: 'right' }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});

// --- Chart 10: AIC/BIC Comparison ---
const aicCtx = document.getElementById('aicChart').getContext('2d');
new Chart(aicCtx, {
  type: 'bar',
  data: {
    labels: ['Log-Linear', 'Power-Law', 'Exp. Decay'],
    datasets: [
      {
        label: 'AIC',
        data: [-61.86, -54.92, -59.85],
        backgroundColor: '#3b82f6cc',
        borderColor: '#3b82f6',
        borderWidth: 1
      },
      {
        label: 'BIC',
        data: [-62.28, -55.33, -60.48],
        backgroundColor: '#22c55ecc',
        borderColor: '#22c55e',
        borderWidth: 1
      }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    indexAxis: 'y',
    scales: {
      x: { title: { display: true, text: 'Information Criterion (lower = better)', color: '#94a3b8' }, ticks: { color: '#64748b' }, grid: { color: '#1e293b' } },
      y: { ticks: { color: '#64748b' }, grid: { color: '#1e293b' } }
    },
    plugins: { legend: { labels: { color: '#e2e8f0' } } }
  }
});
</script>
</body>
</html>
