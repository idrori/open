<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Productionizing Activation Capping &amp; Preventative Steering</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7"></script>
<style>
:root {
  --primary: #1a3a5c;
  --accent: #2980b9;
  --bg: #f8f9fa;
  --card-bg: #ffffff;
  --text: #2c3e50;
  --border: #dee2e6;
  --success: #27ae60;
  --danger: #e74c3c;
  --warn: #f39c12;
  --purple: #8e44ad;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
}
header {
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color: #fff;
  padding: 2rem 1rem;
  text-align: center;
}
header h1 { font-size: 1.5rem; margin-bottom: 0.5rem; }
header p { opacity: 0.9; font-size: 0.95rem; max-width: 700px; margin: 0 auto; }
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 1.5rem 1rem;
}
.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1rem;
  margin-bottom: 2rem;
}
.summary-card {
  background: var(--card-bg);
  border-radius: 8px;
  padding: 1.2rem;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  border-left: 4px solid var(--accent);
}
.summary-card .value {
  font-size: 1.7rem;
  font-weight: 700;
  color: var(--primary);
}
.summary-card .label {
  font-size: 0.82rem;
  color: #666;
  margin-top: 0.3rem;
}
.chart-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}
.chart-card {
  background: var(--card-bg);
  border-radius: 8px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.chart-card h3 {
  color: var(--primary);
  margin-bottom: 1rem;
  font-size: 1rem;
  border-bottom: 2px solid var(--accent);
  padding-bottom: 0.5rem;
}
.chart-container {
  position: relative;
  width: 100%;
  max-height: 350px;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}
table th {
  background: var(--primary);
  color: #fff;
  padding: 0.5rem;
  text-align: left;
}
table td {
  padding: 0.4rem 0.5rem;
  border-bottom: 1px solid var(--border);
}
table tr:nth-child(even) { background: #f0f4f8; }
.best { color: var(--success); font-weight: 600; }
.section-title {
  color: var(--primary);
  font-size: 1.2rem;
  margin: 2rem 0 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid var(--accent);
}
footer {
  text-align: center;
  padding: 1.5rem;
  color: #888;
  font-size: 0.8rem;
  border-top: 1px solid var(--border);
  margin-top: 2rem;
}
@media (max-width: 600px) {
  .chart-grid { grid-template-columns: 1fr; }
  header h1 { font-size: 1.2rem; }
  .summary-card .value { font-size: 1.3rem; }
}
</style>
</head>
<body>
<header>
  <h1>Productionizing Activation Capping &amp; Preventative Training-Time Steering</h1>
  <p>Practical methods to stabilize language model personas via inference-time activation capping along the Assistant Axis and training-time preventative steering approaches.</p>
</header>

<div class="container">
  <div class="summary-grid">
    <div class="summary-card">
      <div class="value">0.985</div>
      <div class="label">Optimal F1 Score (threshold=0.4)</div>
    </div>
    <div class="summary-card">
      <div class="value">100%</div>
      <div class="label">Harm Reduction at Optimal</div>
    </div>
    <div class="summary-card">
      <div class="value">96.97%</div>
      <div class="label">Capability Preserved</div>
    </div>
    <div class="summary-card">
      <div class="value">0.709</div>
      <div class="label">Best Drift (Combined Aux+Reg)</div>
    </div>
    <div class="summary-card">
      <div class="value">0.0007%</div>
      <div class="label">Overhead at 175B Scale</div>
    </div>
  </div>

  <h2 class="section-title">Experiment 1: Axis Estimation Methods</h2>
  <div class="chart-grid">
    <div class="chart-card">
      <h3>Axis Alignment vs. Noise Level</h3>
      <div class="chart-container">
        <canvas id="axisNoise"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Axis Alignment vs. Sample Size</h3>
      <div class="chart-container">
        <canvas id="axisSample"></canvas>
      </div>
    </div>
  </div>

  <h2 class="section-title">Experiment 2: Capping Threshold Optimization</h2>
  <div class="chart-grid">
    <div class="chart-card">
      <h3>Harm Reduction &amp; Capability vs. Threshold</h3>
      <div class="chart-container">
        <canvas id="cappingThreshold"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Calibration Sensitivity</h3>
      <div class="chart-container">
        <canvas id="calibration"></canvas>
      </div>
    </div>
  </div>

  <h2 class="section-title">Experiment 3: Training-Time Steering</h2>
  <div class="chart-grid">
    <div class="chart-card">
      <h3>Persona Drift During Training (200 Epochs)</h3>
      <div class="chart-container">
        <canvas id="driftCurves"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Steering Method Comparison</h3>
      <table>
        <thead>
          <tr><th>Method</th><th>Final Drift</th><th>Defense Score</th><th>ASR</th></tr>
        </thead>
        <tbody>
          <tr><td>No Steering</td><td>0.952</td><td>0.8</td><td>0.2</td></tr>
          <tr><td>Auxiliary Loss</td><td>0.727</td><td class="best">1.0</td><td class="best">0.0</td></tr>
          <tr><td>Activation Reg.</td><td>0.945</td><td>0.8</td><td>0.2</td></tr>
          <tr><td>Contrastive Grad.</td><td>0.953</td><td>0.8</td><td>0.2</td></tr>
          <tr><td class="best">Combined (Aux+Reg)</td><td class="best">0.709</td><td class="best">1.0</td><td class="best">0.0</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <h2 class="section-title">Experiment 4: Scalability Analysis</h2>
  <div class="chart-grid">
    <div class="chart-card">
      <h3>Capping Overhead vs. Model Size</h3>
      <div class="chart-container">
        <canvas id="scalability"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Scalability Details</h3>
      <table>
        <thead>
          <tr><th>Model Size</th><th>Overhead %</th><th>Cap. Latency</th><th>Memory (KB)</th></tr>
        </thead>
        <tbody>
          <tr><td>125M</td><td>0.0074</td><td>0.13 us</td><td>36</td></tr>
          <tr><td>350M</td><td>0.0070</td><td>0.34 us</td><td>96</td></tr>
          <tr><td>1.3B</td><td>0.0038</td><td>0.67 us</td><td>192</td></tr>
          <tr><td>6.7B</td><td>0.0020</td><td>1.79 us</td><td>512</td></tr>
          <tr><td>13B</td><td>0.0016</td><td>2.80 us</td><td>800</td></tr>
          <tr><td>70B</td><td>0.0009</td><td>8.95 us</td><td>2,560</td></tr>
          <tr><td>175B</td><td>0.0007</td><td>16.11 us</td><td>4,608</td></tr>
        </tbody>
      </table>
      <p style="margin-top:0.8rem; font-size:0.85rem; color:#666;">
        Log-linear scaling: slope = -0.349, R-squared = 0.990, p &lt; 10^-5
      </p>
    </div>
  </div>

  <h2 class="section-title">Experiment 5: Hyperparameter Sensitivity</h2>
  <div class="chart-grid">
    <div class="chart-card">
      <h3>Auxiliary Loss Steering Strength Sensitivity</h3>
      <div class="chart-container">
        <canvas id="hpSensitivity"></canvas>
      </div>
    </div>
    <div class="chart-card">
      <h3>Combined Strategy Performance</h3>
      <div class="chart-container">
        <canvas id="combinedStrategy"></canvas>
      </div>
    </div>
  </div>
</div>

<footer>
  Based on the Assistant Axis framework (Lu et al., 2026). Synthetic activation experiments across 5 experiment suites. Model sizes: 125M--175B parameters.
</footer>

<script>
const PRIMARY = '#1a3a5c';
const ACCENT = '#2980b9';
const SUCCESS = '#27ae60';
const DANGER = '#e74c3c';
const WARN = '#f39c12';
const PURPLE = '#8e44ad';
const TEAL = '#1abc9c';
const COLORS = [PRIMARY, ACCENT, DANGER, SUCCESS, WARN, PURPLE, TEAL];

// --- Axis Estimation: Noise ---
const noiseData = {
  'PCA (Mean Diff.)': { x: [0.05,0.1,0.2,0.5,1.0,2.0], y: [0.9965,0.9965,0.9962,0.9956,0.9849,0.9553] },
  'Contrastive': { x: [0.05,0.1,0.2,0.5,1.0,2.0], y: [0.9968,0.9966,0.9966,0.9918,0.9852,0.9619] },
  'Supervised': { x: [0.05,0.1,0.2,0.5,1.0,2.0], y: [0.9964,0.9960,0.9955,0.9938,0.9808,0.9523] }
};
new Chart(document.getElementById('axisNoise'), {
  type: 'line',
  data: {
    labels: ['0.05','0.1','0.2','0.5','1.0','2.0'],
    datasets: Object.entries(noiseData).map(([name, d], i) => ({
      label: name,
      data: d.y,
      borderColor: COLORS[i],
      backgroundColor: 'transparent',
      tension: 0.3,
      pointRadius: 4,
      borderWidth: 2
    }))
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { min: 0.94, max: 1.0, title: { display: true, text: 'Alignment' } },
      x: { title: { display: true, text: 'Noise Std Dev' } }
    }
  }
});

// --- Axis Estimation: Sample Size ---
const sampleData = {
  'PCA (Mean Diff.)': { x: [50,100,200,500,1000], y: [0.9657,0.9874,0.9916,0.9969,0.9989] },
  'Contrastive': { x: [50,100,200,500,1000], y: [0.9646,0.9882,0.9926,0.9968,0.9989] },
  'Supervised': { x: [50,100,200,500,1000], y: [0.9666,0.9864,0.9905,0.9962,0.9986] }
};
new Chart(document.getElementById('axisSample'), {
  type: 'line',
  data: {
    labels: ['50','100','200','500','1000'],
    datasets: Object.entries(sampleData).map(([name, d], i) => ({
      label: name,
      data: d.y,
      borderColor: COLORS[i],
      backgroundColor: 'transparent',
      tension: 0.3,
      pointRadius: 4,
      borderWidth: 2
    }))
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { min: 0.96, max: 1.0, title: { display: true, text: 'Alignment' } },
      x: { title: { display: true, text: 'Calibration Samples' } }
    }
  }
});

// --- Capping Threshold ---
const thresholds = [0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1.0];
const harmRed = [1.0,1.0,1.0,1.0,0.408,0.0,0.0,0.0,0.0,0.0];
const capability = [0.9517,0.9583,0.9643,0.9697,0.9746,0.9788,0.9826,0.9858,0.9886,0.9909];
const f1Scores = [0.9752,0.9787,0.9818,0.9846,0.5752,0.0,0.0,0.0,0.0,0.0];

new Chart(document.getElementById('cappingThreshold'), {
  type: 'line',
  data: {
    labels: thresholds.map(String),
    datasets: [
      { label: 'Harm Reduction', data: harmRed, borderColor: DANGER, backgroundColor: 'transparent', borderWidth: 2, pointRadius: 4 },
      { label: 'Capability', data: capability, borderColor: SUCCESS, backgroundColor: 'transparent', borderWidth: 2, pointRadius: 4 },
      { label: 'F1 Score', data: f1Scores, borderColor: WARN, backgroundColor: 'transparent', borderWidth: 2, borderDash: [5,5], pointRadius: 4 }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      annotation: {
        annotations: {
          line1: { type: 'line', xMin: 3, xMax: 3, borderColor: 'gray', borderDash: [5,5] }
        }
      }
    },
    scales: {
      y: { min: 0, max: 1.05, title: { display: true, text: 'Score' } },
      x: { title: { display: true, text: 'Capping Threshold' } }
    }
  }
});

// --- Calibration Sensitivity ---
const calSizes = [50, 100, 200, 500, 1000];
const calF1 = [0.9864, 0.9857, 0.9851, 0.9848, 0.9847];
const calAlign = [0.9503, 0.9685, 0.9867, 0.9944, 0.9975];

new Chart(document.getElementById('calibration'), {
  type: 'line',
  data: {
    labels: calSizes.map(String),
    datasets: [
      { label: 'F1 Score', data: calF1, borderColor: PRIMARY, backgroundColor: 'transparent', borderWidth: 2, pointRadius: 5, yAxisID: 'y' },
      { label: 'Axis Alignment', data: calAlign, borderColor: DANGER, backgroundColor: 'transparent', borderWidth: 2, borderDash: [5,5], pointRadius: 5, yAxisID: 'y1' }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { position: 'left', min: 0.98, max: 0.99, title: { display: true, text: 'F1 Score' } },
      y1: { position: 'right', min: 0.94, max: 1.0, title: { display: true, text: 'Alignment' }, grid: { drawOnChartArea: false } },
      x: { title: { display: true, text: 'Calibration Set Size' } }
    }
  }
});

// --- Drift Curves ---
const driftNoSteer = [0.951,0.9512,0.9511,0.9509,0.951,0.9506,0.9505,0.9507,0.9509,0.9509,0.9506,0.9505,0.9508,0.9507,0.9505,0.9504,0.9502,0.9505,0.9504,0.9503];
const driftAux = [0.9532,0.9564,0.9594,0.9627,0.9656,0.9685,0.9715,0.9745,0.9776,0.9811,0.9837,0.9869,0.9904,0.9932,0.9964,0.9996,0.9973,0.9946,0.9919,0.9892];
const driftActReg = [0.9516,0.9515,0.9512,0.9512,0.9512,0.9511,0.9511,0.9512,0.9511,0.9511,0.9514,0.9513,0.9514,0.9513,0.9514,0.9512,0.9512,0.9514,0.9513,0.9514];
const driftCGP = [0.9513,0.9513,0.9512,0.9514,0.9513,0.9513,0.9519,0.952,0.9519,0.9521,0.9519,0.9518,0.9517,0.9515,0.9519,0.9518,0.9519,0.9518,0.9521,0.9522];
const driftCombined = [0.9529,0.9556,0.9584,0.9612,0.9643,0.9677,0.9704,0.9736,0.9771,0.9802,0.9833,0.9865,0.9901,0.9933,0.9965,0.9997,0.9971,0.9937,0.9904,0.9872];

// Subsample every 10 epochs for full curves
const fullNoSteer = [0.951,0.9503,0.9502,0.95,0.9499,0.9506,0.9502,0.9501,0.9508,0.951,0.951,0.9508,0.951,0.9515,0.9514,0.9513,0.9512,0.9513,0.9513,0.9515];
const fullAux = [0.9532,0.9594,0.9656,0.9715,0.9776,0.9837,0.9904,0.9964,0.9973,0.9892,0.9831,0.9772,0.9715,0.9657,0.956,0.9475,0.9397,0.9309,0.9225,0.9152];
const fullAux2 = [0.9073,0.8993,0.8907,0.883,0.8756,0.8674,0.8589,0.8505,0.8418,0.8338,0.8255,0.8171,0.8089,0.8005,0.7923,0.7839,0.7755,0.7672,0.759,0.7512];
const fullCombined = [0.9529,0.9584,0.9643,0.9704,0.9771,0.9833,0.9901,0.9965,0.9971,0.9855,0.9804,0.9741,0.9675,0.9611,0.9547,0.9469,0.9389,0.9307,0.922,0.9137];
const fullCombined2 = [0.9052,0.899,0.8912,0.883,0.8757,0.867,0.8587,0.8503,0.8415,0.8338,0.8251,0.8159,0.807,0.7983,0.7903,0.7813,0.7724,0.7639,0.7551,0.7459];

const epochLabels = Array.from({length: 20}, (_, i) => (i * 10).toString());

new Chart(document.getElementById('driftCurves'), {
  type: 'line',
  data: {
    labels: epochLabels,
    datasets: [
      { label: 'No Steering', data: fullNoSteer, borderColor: PRIMARY, borderWidth: 2, pointRadius: 2, tension: 0.3, backgroundColor: 'transparent' },
      { label: 'Auxiliary Loss', data: fullAux, borderColor: ACCENT, borderWidth: 2, pointRadius: 2, tension: 0.3, backgroundColor: 'transparent' },
      { label: 'Activation Reg.', data: [0.9516,0.9512,0.9512,0.9511,0.9511,0.9513,0.9514,0.9512,0.9514,0.9519,0.9516,0.9519,0.952,0.9521,0.9518,0.9507,0.9506,0.9495,0.9496,0.9495], borderColor: DANGER, borderWidth: 2, pointRadius: 2, tension: 0.3, backgroundColor: 'transparent' },
      { label: 'Contrastive Grad.', data: [0.9513,0.9514,0.9519,0.9519,0.9519,0.9522,0.9525,0.9526,0.9524,0.9526,0.9529,0.953,0.9529,0.9527,0.952,0.9526,0.9531,0.9531,0.9537,0.954], borderColor: SUCCESS, borderWidth: 2, pointRadius: 2, tension: 0.3, backgroundColor: 'transparent' },
      { label: 'Combined (Aux+Reg)', data: fullCombined, borderColor: WARN, borderWidth: 2, pointRadius: 2, tension: 0.3, backgroundColor: 'transparent' }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { legend: { position: 'bottom', labels: { font: { size: 10 } } } },
    scales: {
      y: { min: 0.7, max: 1.02, title: { display: true, text: 'Persona Drift Score' } },
      x: { title: { display: true, text: 'Training Epoch' } }
    }
  }
});

// --- Scalability ---
const modelSizes = ['125M','350M','1.3B','6.7B','13B','70B','175B'];
const overhead = [0.0074,0.007,0.0038,0.002,0.0016,0.0009,0.0007];

new Chart(document.getElementById('scalability'), {
  type: 'bar',
  data: {
    labels: modelSizes,
    datasets: [{
      label: 'Overhead (%)',
      data: overhead,
      backgroundColor: overhead.map(v => v > 0.005 ? WARN : v > 0.002 ? ACCENT : SUCCESS),
      borderColor: PRIMARY,
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: { label: ctx => `Overhead: ${ctx.raw}%` }
      }
    },
    scales: {
      y: { title: { display: true, text: 'Capping Overhead (%)' } },
      x: { title: { display: true, text: 'Model Size' } }
    }
  }
});

// --- HP Sensitivity ---
const lambdas = [0.01, 0.03, 0.05, 0.1, 0.2, 0.5, 1.0];
const hpDrift = [0.9662, 0.9966, 0.9723, 0.8925, 0.7289, 0.3225, 0.07];
const hpDefense = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];

new Chart(document.getElementById('hpSensitivity'), {
  type: 'line',
  data: {
    labels: lambdas.map(String),
    datasets: [
      { label: 'Final Drift', data: hpDrift, borderColor: DANGER, backgroundColor: 'rgba(231,76,60,0.1)', fill: true, tension: 0.3, pointRadius: 5, borderWidth: 2 },
      { label: 'Defense Score', data: hpDefense, borderColor: SUCCESS, backgroundColor: 'transparent', tension: 0.3, pointRadius: 5, borderWidth: 2, borderDash: [5,5] }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    scales: {
      y: { min: 0, max: 1.05, title: { display: true, text: 'Score' } },
      x: { title: { display: true, text: 'Steering Strength (lambda)' } }
    }
  }
});

// --- Combined Strategy ---
const strategies = ['No Defense','Capping\nOnly','Aux Loss\nOnly','Act. Reg\nOnly','Cap+Aux','Cap+Reg','Cap+Combined'];
const capPres = [1.0, 0.9978, 1.0, 1.0, 0.9978, 0.9978, 0.998];
const personaDrift = [0.9478, 0.7388, 0.9638, 0.8603, 0.7562, 0.793, 0.9789];

new Chart(document.getElementById('combinedStrategy'), {
  type: 'bar',
  data: {
    labels: strategies,
    datasets: [
      { label: 'Capability Preserved', data: capPres, backgroundColor: ACCENT, borderWidth: 1 },
      { label: 'Persona Drift', data: personaDrift, backgroundColor: WARN, borderWidth: 1 }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { legend: { position: 'bottom' } },
    scales: {
      y: { min: 0, max: 1.05, title: { display: true, text: 'Score' } },
      x: { ticks: { font: { size: 9 } } }
    }
  }
});
</script>
</body>
</html>
