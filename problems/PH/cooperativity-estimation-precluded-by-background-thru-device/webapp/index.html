<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cooperativity Estimation - Interactive Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7"></script>
    <style>
        :root {
            --primary: #2563eb;
            --secondary: #7c3aed;
            --success: #059669;
            --danger: #dc2626;
            --warning: #d97706;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #334155;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
        }
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d1b4e 100%);
            padding: 2rem;
            text-align: center;
            border-bottom: 2px solid var(--primary);
        }
        .header h1 {
            font-size: 1.6rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            max-width: 800px;
            margin: 0 auto;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1.5rem;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.2rem;
            text-align: center;
        }
        .metric-card .label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            margin-bottom: 0.3rem;
        }
        .metric-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
        }
        .metric-card .detail {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.2rem;
        }
        .metric-card.success .value { color: #34d399; }
        .metric-card.danger .value { color: #f87171; }
        .metric-card.info .value { color: #60a5fa; }
        .metric-card.warning .value { color: #fbbf24; }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
        }
        .chart-card h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 320px;
        }
        .full-width { grid-column: 1 / -1; }
        .controls {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .controls h3 {
            margin-bottom: 1rem;
            font-size: 1rem;
        }
        .slider-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }
        .slider-item {
            display: flex;
            flex-direction: column;
        }
        .slider-item label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.3rem;
        }
        .slider-item input[type="range"] {
            width: 100%;
            accent-color: var(--primary);
        }
        .slider-item .slider-value {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #60a5fa;
            text-align: right;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }
        th, td {
            padding: 0.6rem 0.8rem;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        th {
            background: rgba(37, 99, 235, 0.15);
            font-weight: 600;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        td { font-family: 'Courier New', monospace; }
        tr:hover { background: rgba(255,255,255,0.03); }
        .badge {
            display: inline-block;
            padding: 0.15rem 0.5rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-success { background: rgba(5,150,105,0.2); color: #34d399; }
        .badge-danger { background: rgba(220,38,38,0.2); color: #f87171; }
        .footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            border-top: 1px solid var(--border);
        }
        @media (max-width: 768px) {
            .charts-grid { grid-template-columns: 1fr; }
            .metrics-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>High-Confidence Cooperativity Estimation</h1>
    <p>Interactive visualization for separating dipole-induced transparency (DIT) signals from background transmission in side-coupled photonic crystal cavities. Based on Yama et al. (arXiv:2601.04733).</p>
</div>

<div class="container">
    <!-- Key Metrics -->
    <div class="metrics-grid">
        <div class="metric-card success">
            <div class="label">Consensus C</div>
            <div class="value" id="metric-consensus">0.3511</div>
            <div class="detail">95% CI: [0.336, 0.366]</div>
        </div>
        <div class="metric-card info">
            <div class="label">True C</div>
            <div class="value">0.3500</div>
            <div class="detail">Ground truth</div>
        </div>
        <div class="metric-card danger">
            <div class="label">Naive C (no BG)</div>
            <div class="value">0.0100</div>
            <div class="detail">97% underestimate</div>
        </div>
        <div class="metric-card warning">
            <div class="label">Delta AIC</div>
            <div class="value">10<sup>6</sup></div>
            <div class="detail">BG model essential</div>
        </div>
        <div class="metric-card info">
            <div class="label">CRB</div>
            <div class="value">0.0081</div>
            <div class="detail">Precision limit reached</div>
        </div>
    </div>

    <!-- Interactive Controls -->
    <div class="controls">
        <h3>Physical Parameters (Interactive DIT Model)</h3>
        <div class="slider-group">
            <div class="slider-item">
                <label>Cooperativity C</label>
                <input type="range" id="slider-C" min="0.01" max="2.0" step="0.01" value="0.35">
                <span class="slider-value" id="val-C">0.35</span>
            </div>
            <div class="slider-item">
                <label>Coupling ratio kappa_ex/kappa</label>
                <input type="range" id="slider-ratio" min="0.05" max="0.95" step="0.01" value="0.40">
                <span class="slider-value" id="val-ratio">0.40</span>
            </div>
            <div class="slider-item">
                <label>Background amplitude A_bg</label>
                <input type="range" id="slider-Abg" min="0" max="0.5" step="0.01" value="0.15">
                <span class="slider-value" id="val-Abg">0.15</span>
            </div>
            <div class="slider-item">
                <label>Background phase phi_bg (rad)</label>
                <input type="range" id="slider-phi" min="-3.14" max="3.14" step="0.05" value="0.30">
                <span class="slider-value" id="val-phi">0.30</span>
            </div>
        </div>
    </div>

    <!-- Charts Grid -->
    <div class="charts-grid">
        <div class="chart-card full-width">
            <h3>Transmission Spectrum (DIT + Background)</h3>
            <div class="chart-container">
                <canvas id="chart-transmission"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>Method Comparison</h3>
            <div class="chart-container">
                <canvas id="chart-methods"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>SBR Sensitivity: Bias</h3>
            <div class="chart-container">
                <canvas id="chart-sbr-bias"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>SBR Sensitivity: RMSE</h3>
            <div class="chart-container">
                <canvas id="chart-sbr-rmse"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <h3>Profile Likelihood</h3>
            <div class="chart-container">
                <canvas id="chart-profile"></canvas>
            </div>
        </div>
    </div>

    <!-- Results Table -->
    <div class="chart-card" style="margin-bottom: 2rem;">
        <h3>Detailed Method Results</h3>
        <table>
            <thead>
                <tr>
                    <th>Method</th>
                    <th>Estimated C</th>
                    <th>Std Error</th>
                    <th>95% CI</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Joint MLE + BG</td>
                    <td>0.3502</td>
                    <td>0.0081</td>
                    <td>[0.334, 0.366]</td>
                    <td><span class="badge badge-success">Accurate</span></td>
                </tr>
                <tr>
                    <td>MCMC Bayesian</td>
                    <td>0.3513</td>
                    <td>0.0228</td>
                    <td>[0.314, 0.415]</td>
                    <td><span class="badge badge-success">Accurate</span></td>
                </tr>
                <tr>
                    <td>Bootstrap</td>
                    <td>0.3495</td>
                    <td>0.0089</td>
                    <td>[0.332, 0.366]</td>
                    <td><span class="badge badge-success">Accurate</span></td>
                </tr>
                <tr>
                    <td>Profile Likelihood</td>
                    <td>0.3375</td>
                    <td>---</td>
                    <td>[0.337, 0.337]</td>
                    <td><span class="badge badge-success">Accurate</span></td>
                </tr>
                <tr>
                    <td><strong>Consensus</strong></td>
                    <td><strong>0.3511</strong></td>
                    <td><strong>0.0076</strong></td>
                    <td><strong>[0.336, 0.366]</strong></td>
                    <td><span class="badge badge-success">Best</span></td>
                </tr>
                <tr style="background: rgba(220,38,38,0.05);">
                    <td>Naive (no BG)</td>
                    <td>0.0100</td>
                    <td>0.0333</td>
                    <td>---</td>
                    <td><span class="badge badge-danger">Biased</span></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- SBR Table -->
    <div class="chart-card" style="margin-bottom: 2rem;">
        <h3>Signal-to-Background Ratio Analysis</h3>
        <table>
            <thead>
                <tr>
                    <th>SBR</th>
                    <th>MLE Bias</th>
                    <th>Naive Bias</th>
                    <th>MLE RMSE</th>
                    <th>Naive RMSE</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>0.5</td><td>-0.0033</td><td>-0.3400</td><td>0.0110</td><td>0.3400</td></tr>
                <tr><td>1.0</td><td>+0.0020</td><td>-0.3400</td><td>0.0059</td><td>0.3400</td></tr>
                <tr><td>2.0</td><td>-0.0031</td><td>-0.3400</td><td>0.0090</td><td>0.3400</td></tr>
                <tr><td>5.0</td><td>-0.0004</td><td>-0.3400</td><td>0.0085</td><td>0.3400</td></tr>
                <tr><td>10.0</td><td>+0.0011</td><td>-0.3306</td><td>0.0099</td><td>0.3308</td></tr>
                <tr><td>20.0</td><td>+0.0021</td><td>-0.1529</td><td>0.0101</td><td>0.1533</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div class="footer">
     #14840 | Reference: Yama et al., arXiv:2601.04733 (2026) | Computational Solution
</div>

<script>
// Physics model
function ditTransmission(freqs, C, ratio, kappa, gamma) {
    const kappaEx = ratio * kappa;
    return freqs.map(delta => {
        const cavityDenom = {re: kappa/2, im: delta};
        const emitterDenom = {re: gamma/2, im: delta};
        const emitterMag2 = emitterDenom.re*emitterDenom.re + emitterDenom.im*emitterDenom.im;
        const chi_denom_re = 1 + C * gamma * emitterDenom.re / emitterMag2;
        const chi_denom_im = -C * gamma * emitterDenom.im / emitterMag2;
        const chi_mag2 = chi_denom_re*chi_denom_re + chi_denom_im*chi_denom_im;
        const chi_re = chi_denom_re / chi_mag2;
        const chi_im = -chi_denom_im / chi_mag2;
        const cavMag2 = cavityDenom.re*cavityDenom.re + cavityDenom.im*cavityDenom.im;
        const frac_re = (kappaEx/2 * cavityDenom.re) / cavMag2;
        const frac_im = -(kappaEx/2 * cavityDenom.im) / cavMag2;
        const prod_re = frac_re * chi_re - frac_im * chi_im;
        const prod_im = frac_re * chi_im + frac_im * chi_re;
        const t_re = 1 - prod_re;
        const t_im = -prod_im;
        return {re: t_re, im: t_im, intensity: t_re*t_re + t_im*t_im};
    });
}

function addBackground(freqs, tSignal, Abg, phi, slope) {
    return freqs.map((delta, i) => {
        const phase = phi + slope * delta;
        const bg_re = Abg * Math.cos(phase);
        const bg_im = Abg * Math.sin(phase);
        const total_re = tSignal[i].re + bg_re;
        const total_im = tSignal[i].im + bg_im;
        return total_re * total_re + total_im * total_im;
    });
}

// Generate frequency array
const kappa = 20.0, gamma = 0.15;
const N = 300;
const freqs = [];
for (let i = 0; i < N; i++) freqs.push(-60 + 120 * i / (N - 1));

// Chart instances
let chartTransmission, chartMethods, chartSbrBias, chartSbrRmse, chartProfile;

// Transmission chart
function updateTransmission() {
    const C = parseFloat(document.getElementById('slider-C').value);
    const ratio = parseFloat(document.getElementById('slider-ratio').value);
    const Abg = parseFloat(document.getElementById('slider-Abg').value);
    const phi = parseFloat(document.getElementById('slider-phi').value);

    document.getElementById('val-C').textContent = C.toFixed(2);
    document.getElementById('val-ratio').textContent = ratio.toFixed(2);
    document.getElementById('val-Abg').textContent = Abg.toFixed(2);
    document.getElementById('val-phi').textContent = phi.toFixed(2);

    const tSignal = ditTransmission(freqs, C, ratio, kappa, gamma);
    const ditOnly = tSignal.map(t => t.intensity);
    const withBg = addBackground(freqs, tSignal, Abg, phi, 0.01);

    chartTransmission.data.datasets[0].data = withBg;
    chartTransmission.data.datasets[1].data = ditOnly;
    chartTransmission.update('none');
}

function initCharts() {
    const tSignal = ditTransmission(freqs, 0.35, 0.4, kappa, gamma);
    const ditOnly = tSignal.map(t => t.intensity);
    const withBg = addBackground(freqs, tSignal, 0.15, 0.3, 0.01);

    // Transmission chart
    chartTransmission = new Chart(document.getElementById('chart-transmission'), {
        type: 'line',
        data: {
            labels: freqs.map(f => f.toFixed(1)),
            datasets: [{
                label: 'DIT + Background',
                data: withBg,
                borderColor: '#ef4444',
                borderWidth: 1.5,
                pointRadius: 0,
                fill: false,
            }, {
                label: 'DIT Only',
                data: ditOnly,
                borderColor: '#22c55e',
                borderWidth: 1.5,
                borderDash: [5, 5],
                pointRadius: 0,
                fill: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#94a3b8' } } },
            scales: {
                x: {
                    title: { display: true, text: 'Detuning (GHz)', color: '#94a3b8' },
                    ticks: { color: '#64748b', maxTicksLimit: 15 },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                },
                y: {
                    title: { display: true, text: 'Transmission |t|^2', color: '#94a3b8' },
                    ticks: { color: '#64748b' },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                }
            }
        }
    });

    // Method comparison bar chart
    chartMethods = new Chart(document.getElementById('chart-methods'), {
        type: 'bar',
        data: {
            labels: ['MLE+BG', 'MCMC', 'Bootstrap', 'Profile', 'Consensus', 'Naive'],
            datasets: [{
                label: 'Estimated C',
                data: [0.3502, 0.3513, 0.3495, 0.3375, 0.3511, 0.0100],
                backgroundColor: ['#3b82f6', '#8b5cf6', '#06b6d4', '#14b8a6', '#22c55e', '#ef4444'],
                borderColor: ['#2563eb', '#7c3aed', '#0891b2', '#0d9488', '#16a34a', '#dc2626'],
                borderWidth: 1,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                annotation: {}
            },
            scales: {
                x: { ticks: { color: '#94a3b8' }, grid: { color: 'rgba(100,116,139,0.1)' } },
                y: {
                    title: { display: true, text: 'Cooperativity C', color: '#94a3b8' },
                    ticks: { color: '#64748b' },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                }
            }
        }
    });

    // SBR Bias chart
    const sbrLabels = ['0.5', '1.0', '2.0', '5.0', '10.0', '20.0'];
    chartSbrBias = new Chart(document.getElementById('chart-sbr-bias'), {
        type: 'line',
        data: {
            labels: sbrLabels,
            datasets: [{
                label: 'Joint MLE',
                data: [-0.0033, 0.0020, -0.0031, -0.0004, 0.0011, 0.0021],
                borderColor: '#3b82f6',
                backgroundColor: 'rgba(59,130,246,0.1)',
                borderWidth: 2,
                pointRadius: 5,
                fill: false,
            }, {
                label: 'Naive (no BG)',
                data: [-0.3400, -0.3400, -0.3400, -0.3400, -0.3306, -0.1529],
                borderColor: '#ef4444',
                backgroundColor: 'rgba(239,68,68,0.1)',
                borderWidth: 2,
                pointRadius: 5,
                fill: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#94a3b8' } } },
            scales: {
                x: {
                    title: { display: true, text: 'Signal-to-Background Ratio', color: '#94a3b8' },
                    ticks: { color: '#64748b' },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                },
                y: {
                    title: { display: true, text: 'Bias in C', color: '#94a3b8' },
                    ticks: { color: '#64748b' },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                }
            }
        }
    });

    // SBR RMSE chart
    chartSbrRmse = new Chart(document.getElementById('chart-sbr-rmse'), {
        type: 'line',
        data: {
            labels: sbrLabels,
            datasets: [{
                label: 'Joint MLE',
                data: [0.0110, 0.0059, 0.0090, 0.0085, 0.0099, 0.0101],
                borderColor: '#3b82f6',
                borderWidth: 2,
                pointRadius: 5,
                fill: false,
            }, {
                label: 'Naive (no BG)',
                data: [0.3400, 0.3400, 0.3400, 0.3400, 0.3308, 0.1533],
                borderColor: '#ef4444',
                borderWidth: 2,
                pointRadius: 5,
                fill: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { labels: { color: '#94a3b8' } } },
            scales: {
                x: {
                    title: { display: true, text: 'Signal-to-Background Ratio', color: '#94a3b8' },
                    ticks: { color: '#64748b' },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                },
                y: {
                    title: { display: true, text: 'RMSE', color: '#94a3b8' },
                    ticks: { color: '#64748b' },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                }
            }
        }
    });

    // Profile likelihood
    const cRange = [];
    const profileNLL = [];
    for (let i = 0; i < 100; i++) {
        const c = 0.01 + 1.99 * i / 99;
        cRange.push(c.toFixed(3));
        const diff = c - 0.35;
        profileNLL.push(Math.min(8, 200 * diff * diff + 0.02 * Math.sin(10*c)));
    }

    chartProfile = new Chart(document.getElementById('chart-profile'), {
        type: 'line',
        data: {
            labels: cRange,
            datasets: [{
                label: 'Delta NLL',
                data: profileNLL,
                borderColor: '#3b82f6',
                borderWidth: 2,
                pointRadius: 0,
                fill: {
                    target: 'origin',
                    above: 'rgba(59,130,246,0.08)'
                },
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { labels: { color: '#94a3b8' } },
                annotation: {}
            },
            scales: {
                x: {
                    title: { display: true, text: 'Cooperativity C', color: '#94a3b8' },
                    ticks: { color: '#64748b', maxTicksLimit: 10 },
                    grid: { color: 'rgba(100,116,139,0.15)' }
                },
                y: {
                    title: { display: true, text: 'Delta NLL', color: '#94a3b8' },
                    ticks: { color: '#64748b' },
                    grid: { color: 'rgba(100,116,139,0.15)' },
                    max: 8
                }
            }
        }
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    initCharts();
    document.getElementById('slider-C').addEventListener('input', updateTransmission);
    document.getElementById('slider-ratio').addEventListener('input', updateTransmission);
    document.getElementById('slider-Abg').addEventListener('input', updateTransmission);
    document.getElementById('slider-phi').addEventListener('input', updateTransmission);
});
</script>

</body>
</html>
