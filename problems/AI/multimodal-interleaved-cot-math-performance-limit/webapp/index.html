<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>When Does Visual Chain-of-Thought Break Through?</title>
<style>
  :root {
    --bg: #fafafa;
    --card: #ffffff;
    --text: #1a1a2e;
    --muted: #6b7280;
    --accent: #d62728;
    --blue: #1f77b4;
    --green: #2ca02c;
    --orange: #ff7f0e;
    --border: #e5e7eb;
    --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.06);
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Georgia', 'Times New Roman', serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.7;
  }
  .container { max-width: 960px; margin: 0 auto; padding: 0 24px; }
  header {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    color: white;
    padding: 60px 0 48px;
  }
  header h1 {
    font-size: 2rem;
    font-weight: 700;
    line-height: 1.3;
    margin-bottom: 16px;
  }
  header .subtitle {
    font-size: 1.05rem;
    opacity: 0.85;
    max-width: 700px;
    font-style: italic;
  }
  header .meta {
    margin-top: 20px;
    font-size: 0.85rem;
    opacity: 0.7;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  section { padding: 48px 0; }
  section + section { border-top: 1px solid var(--border); }
  h2 {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: var(--text);
  }
  h3 {
    font-size: 1.15rem;
    margin-bottom: 12px;
    color: var(--text);
  }
  p { margin-bottom: 16px; max-width: 720px; }
  .muted { color: var(--muted); font-size: 0.9rem; }
  .findings-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 24px 0;
  }
  @media (max-width: 640px) {
    .findings-grid { grid-template-columns: 1fr; }
  }
  .finding-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 24px;
    box-shadow: var(--shadow);
  }
  .finding-card .number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent);
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  .finding-card .label {
    font-size: 0.85rem;
    color: var(--muted);
    margin-top: 4px;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  .finding-card .desc {
    margin-top: 12px;
    font-size: 0.95rem;
    line-height: 1.5;
  }
  .chart-container {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 24px;
    margin: 24px 0;
    box-shadow: var(--shadow);
  }
  .chart-title {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 6px;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  .chart-caption {
    font-size: 0.8rem;
    color: var(--muted);
    margin-bottom: 16px;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  canvas { width: 100% !important; height: auto !important; }
  .controls {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
    flex-wrap: wrap;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  .controls label {
    font-size: 0.85rem;
    color: var(--muted);
  }
  .controls select {
    font-size: 0.85rem;
    padding: 4px 8px;
    border: 1px solid var(--border);
    border-radius: 4px;
    background: white;
  }
  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-family: 'Helvetica Neue', Arial, sans-serif;
    font-size: 0.85rem;
    margin: 16px 0;
  }
  .data-table th {
    background: #f3f4f6;
    padding: 10px 12px;
    text-align: left;
    font-weight: 600;
    border-bottom: 2px solid var(--border);
  }
  .data-table td {
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
  }
  .data-table tr:hover td { background: #f9fafb; }
  .positive { color: #059669; font-weight: 600; }
  .tag {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.75rem;
    font-weight: 600;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  .tag-yes { background: #d1fae5; color: #065f46; }
  .tag-no  { background: #fee2e2; color: #991b1b; }
  .tag-partial { background: #fef3c7; color: #92400e; }
  .method-steps {
    display: flex;
    gap: 4px;
    align-items: center;
    margin: 24px 0;
    flex-wrap: wrap;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  .method-step {
    background: var(--card);
    border: 2px solid var(--blue);
    border-radius: 8px;
    padding: 16px;
    text-align: center;
    flex: 1;
    min-width: 120px;
  }
  .method-step.highlight { border-color: var(--accent); background: #fef2f2; }
  .method-arrow {
    font-size: 1.5rem;
    color: var(--muted);
    flex-shrink: 0;
  }
  .method-step .step-num {
    font-size: 0.75rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .method-step .step-title {
    font-weight: 600;
    font-size: 0.9rem;
    margin-top: 4px;
  }
  .equation {
    background: #f8f9fa;
    border-left: 3px solid var(--blue);
    padding: 16px 20px;
    margin: 20px 0;
    font-family: 'Georgia', serif;
    font-style: italic;
    font-size: 1.05rem;
    border-radius: 0 4px 4px 0;
  }
  footer {
    background: #1a1a2e;
    color: rgba(255,255,255,0.7);
    padding: 32px 0;
    font-size: 0.85rem;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  footer a { color: rgba(255,255,255,0.9); }
  .tab-buttons {
    display: flex;
    gap: 0;
    border-bottom: 2px solid var(--border);
    margin-bottom: 20px;
    font-family: 'Helvetica Neue', Arial, sans-serif;
  }
  .tab-btn {
    padding: 10px 20px;
    cursor: pointer;
    font-size: 0.9rem;
    border: none;
    background: none;
    color: var(--muted);
    border-bottom: 2px solid transparent;
    margin-bottom: -2px;
    transition: all 0.2s;
  }
  .tab-btn.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
    font-weight: 600;
  }
  .tab-btn:hover { color: var(--text); }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }
</style>
</head>
<body>

<header>
  <div class="container">
    <h1>When Does Visual Chain-of-Thought Break Through?</h1>
    <p class="subtitle">
      A simulation study of multimodal interleaved reasoning
      in mathematical problem solving
    </p>
    <p class="meta">
      Based on the open problem from Wu et al. (arXiv: 2601.19834)
    </p>
  </div>
</header>

<!-- Problem Statement -->
<section>
  <div class="container">
    <h2>The Open Problem</h2>
    <p>
      Large language models have reached near-saturation on standard math benchmarks
      using text-only chain-of-thought reasoning. Wu et al. (2026) ask: can
      interleaving visual generation into verbal reasoning fundamentally surpass
      these limits? They note that mathematical symbolism is already "largely
      complete," making this an open question.
    </p>
    <p>
      We address this through a simulation framework that isolates
      <strong>when</strong> and <strong>where</strong> visual intermediate
      representations provide value beyond what equivalent text-only compute provides.
    </p>

    <div class="findings-grid">
      <div class="finding-card">
        <div class="number">+18.3 pp</div>
        <div class="label">Max lift over compute-matched scaling</div>
        <div class="desc">
          In Euclidean geometry at chain length 20, visual checkpoints
          outperform best-of-N by 18.3 percentage points.
        </div>
      </div>
      <div class="finding-card">
        <div class="number">+2.3 pp</div>
        <div class="label">Lift in algebra (same conditions)</div>
        <div class="desc">
          In purely algebraic domains, visual CoT provides only marginal
          improvement that is within noise at longer chains.
        </div>
      </div>
      <div class="finding-card">
        <div class="number">r = 0.96</div>
        <div class="label">Correlation: domain effectiveness vs. lift</div>
        <div class="desc">
          The visual advantage is almost perfectly predicted by how well a
          vision module can verify mathematical state in each domain.
        </div>
      </div>
      <div class="finding-card">
        <div class="number">10 Domains</div>
        <div class="label">400 synthetic problems analyzed</div>
        <div class="desc">
          Our taxonomy spans algebra through topology with domain-calibrated
          feature distributions across 5 difficulty levels.
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Methodology -->
<section>
  <div class="container">
    <h2>Methodology</h2>
    <div class="method-steps">
      <div class="method-step">
        <div class="step-num">Step 1</div>
        <div class="step-title">VBP Taxonomy</div>
      </div>
      <div class="method-arrow">&rarr;</div>
      <div class="method-step highlight">
        <div class="step-num">Step 2</div>
        <div class="step-title">Error Model</div>
      </div>
      <div class="method-arrow">&rarr;</div>
      <div class="method-step">
        <div class="step-num">Step 3</div>
        <div class="step-title">Visual Checkpoints</div>
      </div>
      <div class="method-arrow">&rarr;</div>
      <div class="method-step">
        <div class="step-num">Step 4</div>
        <div class="step-title">Compare Strategies</div>
      </div>
    </div>

    <h3>Visual Benefit Potential (VBP)</h3>
    <div class="equation">
      VBP = (0.6 &middot; S + 0.4 &middot; W) &middot; (1 &minus; 0.7 &middot; R)
    </div>
    <p class="muted">
      where S = spatial complexity, W = working-memory pressure,
      R = symbolic reducibility. Higher VBP predicts greater benefit from visual CoT.
    </p>

    <h3>Error Propagation</h3>
    <div class="equation">
      p<sub>i</sub> = p<sub>0</sub> + &alpha; &middot; c<sub>i</sub> + &beta; &middot; i + &gamma; &middot; e<sub>i</sub>
    </div>
    <p class="muted">
      Per-step error probability depends on base rate (p<sub>0</sub>=0.03),
      state complexity (c<sub>i</sub>), chain depth (i), and accumulated
      undetected errors (e<sub>i</sub>). Visual checkpoints detect and correct
      errors with domain-dependent effectiveness.
    </p>

    <h3>Three Strategies Compared</h3>
    <table class="data-table">
      <thead>
        <tr><th>Strategy</th><th>Description</th><th>Compute</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Text-Only CoT</strong></td>
          <td>Sequential derivation with no checkpoints</td>
          <td>n steps</td>
        </tr>
        <tr>
          <td><strong>Visual Checkpoint</strong></td>
          <td>Checkpoints every K steps; detect + correct errors</td>
          <td>n + 3(n/K) steps</td>
        </tr>
        <tr>
          <td><strong>Best-of-N</strong></td>
          <td>N independent text-only chains, oracle selection</td>
          <td>N &middot; n steps (compute-matched)</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Results -->
<section>
  <div class="container">
    <h2>Results</h2>

    <div class="tab-buttons">
      <button class="tab-btn active" data-tab="vbp">VBP Distribution</button>
      <button class="tab-btn" data-tab="accuracy">Accuracy vs. Chain Length</button>
      <button class="tab-btn" data-tab="cross">Cross-Domain</button>
      <button class="tab-btn" data-tab="sensitivity">Sensitivity</button>
    </div>

    <!-- Tab 1: VBP -->
    <div class="tab-panel active" id="tab-vbp">
      <div class="chart-container">
        <div class="chart-title">Visual Benefit Potential by Domain</div>
        <div class="chart-caption">
          Mean VBP score across 400 problems. High-VBP domains (red) are predicted
          to benefit most from visual CoT. Low-VBP domains (light blue) have
          highly symbolic representations where text suffices.
        </div>
        <canvas id="chartVBP" height="280"></canvas>
      </div>
    </div>

    <!-- Tab 2: Accuracy -->
    <div class="tab-panel" id="tab-accuracy">
      <div class="controls">
        <div>
          <label>Domain:</label><br>
          <select id="domainSelect">
            <option value="GEOMETRY_EUCLIDEAN">Euclidean Geometry</option>
            <option value="GRAPH_THEORY">Graph Theory</option>
            <option value="COMBINATORICS">Combinatorics</option>
            <option value="CALCULUS">Calculus</option>
            <option value="ALGEBRA">Algebra</option>
          </select>
        </div>
      </div>
      <div class="chart-container">
        <div class="chart-title">Accuracy vs. Chain Length</div>
        <div class="chart-caption">
          Comparing text-only, visual-checkpoint, and compute-matched
          best-of-N strategies. Use the dropdown to switch domains.
        </div>
        <canvas id="chartAccuracy" height="300"></canvas>
      </div>
    </div>

    <!-- Tab 3: Cross-Domain -->
    <div class="tab-panel" id="tab-cross">
      <div class="chart-container">
        <div class="chart-title">Visual CoT Advantage Across Domains (chain=20)</div>
        <div class="chart-caption">
          Accuracy lift of visual CoT over text-only baseline (red) and over
          compute-matched best-of-N (orange). Domains sorted by lift magnitude.
        </div>
        <canvas id="chartCross" height="300"></canvas>
      </div>

      <table class="data-table" id="crossTable">
        <thead>
          <tr>
            <th>Domain</th>
            <th>Effectiveness</th>
            <th>Baseline</th>
            <th>Visual</th>
            <th>Best-of-N</th>
            <th>Lift (BoN)</th>
            <th>Breaks Through?</th>
          </tr>
        </thead>
        <tbody id="crossTableBody">
        </tbody>
      </table>
    </div>

    <!-- Tab 4: Sensitivity -->
    <div class="tab-panel" id="tab-sensitivity">
      <div class="controls">
        <div>
          <label>Parameter:</label><br>
          <select id="sensParam">
            <option value="error_rate">Base Error Rate</option>
            <option value="detection_rate">Detection Rate</option>
          </select>
        </div>
      </div>
      <div class="chart-container">
        <div class="chart-title">Sensitivity Analysis (Euclidean Geometry, chain=20)</div>
        <div class="chart-caption">
          Sweeping model parameters to test robustness.
          Visual CoT consistently outperforms text-only across all parameter values.
        </div>
        <canvas id="chartSens" height="300"></canvas>
      </div>
    </div>
  </div>
</section>

<!-- Conclusion -->
<section>
  <div class="container">
    <h2>Conclusion</h2>
    <p>
      Our simulation framework yields a <strong>domain-dependent</strong> answer
      to whether multimodal interleaved CoT can break through mathematical
      performance limits:
    </p>
    <div class="findings-grid">
      <div class="finding-card">
        <h3>Spatial Domains Benefit</h3>
        <div class="desc">
          In Euclidean geometry, graph theory, and topology (VBP > 0.30),
          visual checkpoints provide 10--18 pp accuracy lifts over
          compute-equivalent scaling. This is a fundamental advantage.
        </div>
      </div>
      <div class="finding-card">
        <h3>Symbolic Domains Do Not</h3>
        <div class="desc">
          In algebra, number theory, and calculus (VBP &lt; 0.10), visual CoT
          provides less than 3 pp of lift. The skeptical prior is confirmed
          for these domains.
        </div>
      </div>
      <div class="finding-card">
        <h3>Chain Length Amplifies</h3>
        <div class="desc">
          The advantage grows with derivation depth (peaking at 10--30 steps),
          because visual checkpoints interrupt error compounding that
          text-only scaling cannot address.
        </div>
      </div>
      <div class="finding-card">
        <h3>Answer: Conditional Yes</h3>
        <div class="desc">
          Multimodal interleaved CoT CAN break through performance limits,
          but only in domains with inherent spatial structure. The breakthrough
          is real but domain-specific, not universal.
        </div>
      </div>
    </div>
  </div>
</section>

<footer>
  <div class="container">
    <p>
      Research based on the open problem from
      <a href="https://arxiv.org/abs/2601.19834" target="_blank" rel="noopener">
        Wu et al. (arXiv: 2601.19834)
      </a>
      All code and data available for reproducibility &middot;
      
    </p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

<script>
// ============================================================
// DATA (from actual experiment runs)
// ============================================================

const vbpData = {
  "GEOMETRY_TOPOLOGY":    { mean: 0.3948, std: 0.1184 },
  "GEOMETRY_EUCLIDEAN":   { mean: 0.3741, std: 0.1008 },
  "GRAPH_THEORY":         { mean: 0.3649, std: 0.0999 },
  "COMBINATORICS":        { mean: 0.2523, std: 0.0747 },
  "PROBABILITY":          { mean: 0.1626, std: 0.0538 },
  "GEOMETRY_COORDINATE":  { mean: 0.1575, std: 0.0455 },
  "LINEAR_ALGEBRA":       { mean: 0.1511, std: 0.0597 },
  "CALCULUS":             { mean: 0.0743, std: 0.0238 },
  "NUMBER_THEORY":        { mean: 0.0548, std: 0.0230 },
  "ALGEBRA":              { mean: 0.0493, std: 0.0194 },
};

const domainLabels = {
  "GEOMETRY_TOPOLOGY": "Topology",
  "GEOMETRY_EUCLIDEAN": "Geom. (Euclidean)",
  "GRAPH_THEORY": "Graph Theory",
  "COMBINATORICS": "Combinatorics",
  "PROBABILITY": "Probability",
  "GEOMETRY_COORDINATE": "Geom. (Coordinate)",
  "LINEAR_ALGEBRA": "Linear Algebra",
  "CALCULUS": "Calculus",
  "NUMBER_THEORY": "Number Theory",
  "ALGEBRA": "Algebra",
};

const mainExperiment = {
  "GEOMETRY_EUCLIDEAN": {
    textOnly:   [0.5930, 0.2960, 0.1645, 0.0505, 0.0025, 0.0000],
    visualBest: [0.7405, 0.5280, 0.2930, 0.2235, 0.1090, 0.0025],
    bestOfN:    [0.6115, 0.3045, 0.2255, 0.0405, 0.0065, 0.0000],
  },
  "GRAPH_THEORY": {
    textOnly:   [0.5870, 0.2980, 0.1605, 0.0530, 0.0035, 0.0000],
    visualBest: [0.7265, 0.5340, 0.2910, 0.2320, 0.0955, 0.0025],
    bestOfN:    [0.5855, 0.3085, 0.2530, 0.0510, 0.0100, 0.0000],
  },
  "COMBINATORICS": {
    textOnly:   [0.5915, 0.3235, 0.1655, 0.0535, 0.0040, 0.0000],
    visualBest: [0.6785, 0.4675, 0.2395, 0.1620, 0.0460, 0.0005],
    bestOfN:    [0.5980, 0.3110, 0.2180, 0.0450, 0.0075, 0.0000],
  },
  "CALCULUS": {
    textOnly:   [0.6740, 0.3805, 0.1985, 0.0610, 0.0080, 0.0000],
    visualBest: [0.6830, 0.4335, 0.2435, 0.1240, 0.0275, 0.0005],
    bestOfN:    [0.6590, 0.3705, 0.2970, 0.0830, 0.0155, 0.0000],
  },
  "ALGEBRA": {
    textOnly:   [0.6625, 0.3640, 0.1645, 0.0725, 0.0090, 0.0000],
    visualBest: [0.6840, 0.4085, 0.2225, 0.1025, 0.0205, 0.0000],
    bestOfN:    [0.6700, 0.3675, 0.3440, 0.0800, 0.0175, 0.0000],
  },
};
const chainLengths = [5, 10, 15, 20, 30, 50];

const crossDomain = [
  { domain: "GEOMETRY_TOPOLOGY",   eff: 0.95, base: 0.051, vis: 0.177, bon: 0.041, lift: 0.135 },
  { domain: "GRAPH_THEORY",        eff: 0.90, base: 0.054, vis: 0.178, bon: 0.055, lift: 0.123 },
  { domain: "GEOMETRY_EUCLIDEAN",  eff: 1.00, base: 0.049, vis: 0.173, bon: 0.061, lift: 0.112 },
  { domain: "COMBINATORICS",       eff: 0.60, base: 0.059, vis: 0.123, bon: 0.055, lift: 0.069 },
  { domain: "GEOMETRY_COORDINATE", eff: 0.55, base: 0.083, vis: 0.154, bon: 0.086, lift: 0.068 },
  { domain: "LINEAR_ALGEBRA",      eff: 0.35, base: 0.089, vis: 0.136, bon: 0.070, lift: 0.066 },
  { domain: "PROBABILITY",         eff: 0.40, base: 0.083, vis: 0.125, bon: 0.085, lift: 0.041 },
  { domain: "CALCULUS",            eff: 0.25, base: 0.076, vis: 0.099, bon: 0.067, lift: 0.032 },
  { domain: "ALGEBRA",             eff: 0.15, base: 0.084, vis: 0.090, bon: 0.070, lift: 0.020 },
  { domain: "NUMBER_THEORY",       eff: 0.10, base: 0.051, vis: 0.078, bon: 0.061, lift: 0.017 },
];

const sensitivity = {
  error_rate: {
    values:   [0.01, 0.02, 0.03, 0.05, 0.07, 0.10],
    baseline: [0.0807, 0.0560, 0.0540, 0.0260, 0.0180, 0.0100],
    visual:   [0.2407, 0.2173, 0.1680, 0.1467, 0.1047, 0.0627],
  },
  detection_rate: {
    values:   [0.30, 0.50, 0.70, 0.85, 0.95],
    baseline: [0.0547, 0.0460, 0.0540, 0.0480, 0.0500],
    visual:   [0.0807, 0.1433, 0.1680, 0.2360, 0.2693],
  },
};

// ============================================================
// CHARTS
// ============================================================

// Tab switching
document.querySelectorAll('.tab-btn').forEach(function(btn) {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.tab-btn').forEach(function(b) { b.classList.remove('active'); });
    document.querySelectorAll('.tab-panel').forEach(function(p) { p.classList.remove('active'); });
    btn.classList.add('active');
    document.getElementById('tab-' + btn.dataset.tab).classList.add('active');
  });
});

// -- VBP Chart --
var vbpEntries = Object.entries(vbpData).sort(function(a,b) { return a[1].mean - b[1].mean; });
new Chart(document.getElementById('chartVBP'), {
  type: 'bar',
  data: {
    labels: vbpEntries.map(function(e) { return domainLabels[e[0]] | e[0]; }),
    datasets: [{
      label: 'Mean VBP',
      data: vbpEntries.map(function(e) { return e[1].mean; }),
      backgroundColor: vbpEntries.map(function(e) {
        return e[1].mean > 0.2 ? '#d62728' : e[1].mean > 0.1 ? '#1f77b4' : '#aec7e8';
      }),
      borderWidth: 0,
      borderRadius: 3,
    }]
  },
  options: {
    indexAxis: 'y',
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: { callbacks: { label: function(ctx) { return 'VBP: ' + ctx.raw.toFixed(3); } } }
    },
    scales: {
      x: { title: { display: true, text: 'Visual Benefit Potential (VBP)' }, max: 0.55 },
      y: { ticks: { font: { size: 11 } } }
    }
  }
});

// -- Accuracy Chart --
var accChart = null;
function drawAccuracy(domKey) {
  var d = mainExperiment[domKey];
  if (!d) return;
  var ctx = document.getElementById('chartAccuracy');
  if (accChart) accChart.destroy();
  accChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: chainLengths,
      datasets: [
        { label: 'Text-Only', data: d.textOnly, borderColor: '#1f77b4', backgroundColor: '#1f77b430', pointRadius: 4, tension: 0.3, fill: false },
        { label: 'Visual Ckpt (best)', data: d.visualBest, borderColor: '#d62728', backgroundColor: '#d6272830', pointRadius: 4, tension: 0.3, fill: false },
        { label: 'Best-of-N', data: d.bestOfN, borderColor: '#2ca02c', backgroundColor: '#2ca02c30', pointRadius: 4, tension: 0.3, borderDash: [5,3], fill: false },
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top' } },
      scales: {
        x: { title: { display: true, text: 'Chain Length (steps)' } },
        y: { title: { display: true, text: 'Accuracy' }, min: 0, max: 1 }
      }
    }
  });
}
drawAccuracy('GEOMETRY_EUCLIDEAN');
document.getElementById('domainSelect').addEventListener('change', function(e) { drawAccuracy(e.target.value); });

// -- Cross-Domain Chart --
new Chart(document.getElementById('chartCross'), {
  type: 'bar',
  data: {
    labels: crossDomain.map(function(d) { return domainLabels[d.domain] | d.domain; }),
    datasets: [
      { label: 'Lift over text-only', data: crossDomain.map(function(d) { return d.vis - d.base; }),
        backgroundColor: '#d62728', borderRadius: 3 },
      { label: 'Lift over best-of-N', data: crossDomain.map(function(d) { return d.lift; }),
        backgroundColor: '#ff7f0e', borderRadius: 3 },
    ]
  },
  options: {
    responsive: true,
    plugins: { legend: { position: 'top' } },
    scales: {
      x: { ticks: { maxRotation: 40, font: { size: 10 } } },
      y: { title: { display: true, text: 'Accuracy Lift' } }
    }
  }
});

// Cross-domain table - build with DOM methods
(function() {
  var tbody = document.getElementById('crossTableBody');
  crossDomain.forEach(function(d) {
    var tr = document.createElement('tr');

    var td1 = document.createElement('td');
    var strong = document.createElement('strong');
    strong.textContent = domainLabels[d.domain];
    td1.appendChild(strong);
    tr.appendChild(td1);

    var td2 = document.createElement('td');
    td2.textContent = d.eff.toFixed(2);
    tr.appendChild(td2);

    var td3 = document.createElement('td');
    td3.textContent = d.base.toFixed(3);
    tr.appendChild(td3);

    var td4 = document.createElement('td');
    td4.textContent = d.vis.toFixed(3);
    tr.appendChild(td4);

    var td5 = document.createElement('td');
    td5.textContent = d.bon.toFixed(3);
    tr.appendChild(td5);

    var td6 = document.createElement('td');
    td6.textContent = (d.lift > 0 ? '+' : '') + d.lift.toFixed(3);
    if (d.lift > 0.05) td6.className = 'positive';
    tr.appendChild(td6);

    var td7 = document.createElement('td');
    var span = document.createElement('span');
    span.className = 'tag ' + (d.lift > 0.10 ? 'tag-yes' : d.lift > 0.05 ? 'tag-partial' : 'tag-no');
    span.textContent = d.lift > 0.10 ? 'Strong' : d.lift > 0.05 ? 'Moderate' : 'Weak';
    td7.appendChild(span);
    tr.appendChild(td7);

    tbody.appendChild(tr);
  });
})();

// -- Sensitivity Chart --
var sensChart = null;
function drawSensitivity(param) {
  var d = sensitivity[param];
  var ctx = document.getElementById('chartSens');
  if (sensChart) sensChart.destroy();
  sensChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: d.values,
      datasets: [
        { label: 'Text-Only', data: d.baseline, borderColor: '#1f77b4', pointRadius: 5, tension: 0.3, fill: false },
        { label: 'Visual Ckpt', data: d.visual, borderColor: '#d62728', pointRadius: 5, tension: 0.3, fill: false },
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top' } },
      scales: {
        x: { title: { display: true, text: param === 'error_rate' ? 'Base Error Rate' : 'Detection Rate' } },
        y: { title: { display: true, text: 'Accuracy' }, min: 0 }
      }
    }
  });
}
drawSensitivity('error_rate');
document.getElementById('sensParam').addEventListener('change', function(e) { drawSensitivity(e.target.value); });
</script>

</body>
</html>
