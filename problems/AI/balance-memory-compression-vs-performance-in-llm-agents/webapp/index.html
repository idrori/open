<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ITAMC: Information-Theoretic Adaptive Memory Compression for LLM-Based Agents</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7"></script>
<style>
:root {
  --primary: #1a1a2e;
  --secondary: #16213e;
  --accent: #0f3460;
  --highlight: #e94560;
  --text: #eaeaea;
  --text-dim: #a0a0b8;
  --bg: #0a0a1a;
  --card: #12122a;
  --border: #2a2a4a;
  --extractive: #4fc3f7;
  --abstractive: #ab47bc;
  --latent: #66bb6a;
  --adaptive: #7c4dff;
  --uniform: #78909c;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.7;
}
a { color: var(--extractive); text-decoration: none; }
a:hover { text-decoration: underline; }

/* Sticky Nav */
nav {
  position: sticky; top: 0; z-index: 1000;
  background: rgba(10,10,26,0.92);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  padding: 0;
}
nav .nav-inner {
  max-width: 1200px; margin: 0 auto;
  display: flex; align-items: center; gap: 0;
  overflow-x: auto;
}
nav a {
  color: var(--text-dim); padding: 14px 18px;
  font-size: 0.85rem; font-weight: 500;
  white-space: nowrap; transition: color 0.2s, border-bottom 0.2s;
  border-bottom: 2px solid transparent;
}
nav a:hover, nav a.active {
  color: var(--text); text-decoration: none;
  border-bottom: 2px solid var(--highlight);
}

/* Hero */
.hero {
  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 40%, var(--accent) 100%);
  padding: 80px 24px 64px;
  text-align: center;
  border-bottom: 2px solid var(--highlight);
}
.hero .venue {
  display: inline-block;
  background: var(--highlight);
  color: #fff;
  padding: 4px 16px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  margin-bottom: 20px;
}
.hero h1 {
  font-size: clamp(1.6rem, 4vw, 2.6rem);
  font-weight: 800;
  max-width: 900px;
  margin: 0 auto 16px;
  line-height: 1.25;
}
.hero .subtitle {
  font-size: clamp(0.95rem, 2vw, 1.15rem);
  color: var(--text-dim);
  max-width: 780px;
  margin: 0 auto 32px;
}
.hero-stats {
  display: flex; justify-content: center; gap: 40px; flex-wrap: wrap;
}
.hero-stat {
  text-align: center;
}
.hero-stat .num {
  font-size: 2rem; font-weight: 800; color: var(--extractive);
  display: block;
}
.hero-stat .label {
  font-size: 0.8rem; color: var(--text-dim); text-transform: uppercase;
  letter-spacing: 1px;
}

/* Sections */
section {
  max-width: 1200px;
  margin: 0 auto;
  padding: 56px 24px;
}
section h2 {
  font-size: 1.7rem; font-weight: 700;
  margin-bottom: 8px;
  padding-bottom: 8px;
  border-bottom: 2px solid var(--highlight);
  display: inline-block;
}
section h3 {
  font-size: 1.15rem; font-weight: 600;
  margin: 28px 0 12px;
  color: var(--extractive);
}
.section-desc {
  color: var(--text-dim); margin-bottom: 32px;
  max-width: 800px; font-size: 0.97rem;
}

/* Cards */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 24px;
}
.card-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}
.card-sm {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 22px;
}
.card-sm h4 {
  font-size: 0.9rem; color: var(--text-dim);
  text-transform: uppercase; letter-spacing: 1px;
  margin-bottom: 6px;
}
.card-sm .val {
  font-size: 1.6rem; font-weight: 700;
}

/* Charts */
.chart-container {
  position: relative;
  width: 100%;
  max-width: 800px;
  margin: 0 auto;
}
.chart-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 24px;
}
@media (max-width: 768px) {
  .chart-row { grid-template-columns: 1fr; }
}

/* Tables */
.table-wrap {
  overflow-x: auto;
  margin: 20px 0;
}
table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}
thead th {
  background: var(--accent);
  color: var(--text);
  padding: 12px 16px;
  text-align: left;
  font-weight: 600;
  white-space: nowrap;
}
tbody td {
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
}
tbody tr:hover { background: rgba(79,195,247,0.05); }
.pos { color: #66bb6a; font-weight: 600; }
.neg { color: #ef5350; }

/* Methods */
.method-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
  margin-top: 20px;
}
.method-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  border-top: 3px solid var(--extractive);
}
.method-card.abstractive { border-top-color: var(--abstractive); }
.method-card.latent { border-top-color: var(--latent); }
.method-card h4 {
  font-size: 1.05rem; margin-bottom: 8px;
}
.method-card p {
  font-size: 0.9rem; color: var(--text-dim);
}
.method-card .formula {
  background: rgba(255,255,255,0.04);
  border-radius: 6px;
  padding: 10px 14px;
  margin-top: 12px;
  font-family: 'Courier New', monospace;
  font-size: 0.85rem;
  color: var(--extractive);
  overflow-x: auto;
}
.method-card.abstractive .formula { color: var(--abstractive); }
.method-card.latent .formula { color: var(--latent); }

/* Equation */
.equation-block {
  background: rgba(255,255,255,0.03);
  border-left: 3px solid var(--highlight);
  border-radius: 0 8px 8px 0;
  padding: 18px 24px;
  margin: 20px 0;
  font-family: 'Courier New', monospace;
  font-size: 0.95rem;
  overflow-x: auto;
}

/* Tabs */
.tab-bar {
  display: flex; gap: 4px; margin-bottom: 20px;
  flex-wrap: wrap;
}
.tab-btn {
  padding: 8px 20px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: transparent;
  color: var(--text-dim);
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  transition: all 0.2s;
}
.tab-btn:hover { border-color: var(--extractive); color: var(--text); }
.tab-btn.active {
  background: var(--accent);
  border-color: var(--extractive);
  color: var(--text);
}

/* Findings */
.finding-list {
  display: grid; gap: 16px;
}
.finding {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 24px;
  display: flex; gap: 20px;
  align-items: flex-start;
}
.finding-num {
  background: var(--highlight);
  color: #fff;
  width: 36px; height: 36px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-weight: 800; font-size: 1rem;
  flex-shrink: 0;
}
.finding h4 { font-size: 1rem; margin-bottom: 6px; }
.finding p { font-size: 0.9rem; color: var(--text-dim); }

/* Footer */
footer {
  text-align: center;
  padding: 40px 24px;
  border-top: 1px solid var(--border);
  color: var(--text-dim);
  font-size: 0.85rem;
}

/* Slider controls */
.slider-group {
  display: flex; align-items: center; gap: 12px;
  margin: 12px 0 20px;
}
.slider-group label {
  font-size: 0.9rem; color: var(--text-dim); min-width: 130px;
}
.slider-group input[type=range] {
  flex: 1; max-width: 300px;
  accent-color: var(--highlight);
}
.slider-group .slider-val {
  font-weight: 700; color: var(--extractive);
  min-width: 50px;
}
</style>
</head>
<body>

<!-- Navigation -->
<nav>
  <div class="nav-inner">
    <a href="#hero">Home</a>
    <a href="#problem">Problem</a>
    <a href="#methods">Methods</a>
    <a href="#pareto">Pareto Frontier</a>
    <a href="#optimal">Optimal Points</a>
    <a href="#adaptive">Adaptive vs Uniform</a>
    <a href="#compounding">Stability</a>
    <a href="#saliency">Saliency</a>
    <a href="#findings">Findings</a>
    <a href="#data">Data</a>
  </div>
</nav>

<!-- Hero -->
<section class="hero" id="hero">
  
  <h1>Information-Theoretic Adaptive Memory Compression for LLM-Based Agents</h1>
  <p class="subtitle">Formalizing the compression-performance trade-off as a rate-distortion problem and characterizing the Pareto frontier for extractive, abstractive, and latent memory compression operators.</p>
  <div class="hero-stats">
    <div class="hero-stat"><span class="num">100</span><span class="label">Memory Episodes</span></div>
    <div class="hero-stat"><span class="num">300</span><span class="label">Ground-Truth Facts</span></div>
    <div class="hero-stat"><span class="num">3</span><span class="label">Compression Operators</span></div>
    <div class="hero-stat"><span class="num">6,233</span><span class="label">Total Tokens</span></div>
  </div>
</section>

<!-- Problem -->
<section id="problem">
  <h2>Problem Statement</h2>
  <p class="section-desc">LLM agents accumulate memory episodes that must be re-injected into finite context windows. Aggressive compression reduces cost but risks discarding task-critical information. How do we optimally balance this trade-off?</p>

  <div class="card">
    <h3>The Core Challenge</h3>
    <p style="color:var(--text-dim);font-size:0.95rem;margin-bottom:16px;">LLM agents process fixed-length context windows. When memory exceeds this limit, the agent must compress. Three dimensions make this hard:</p>
    <div class="card-grid" style="margin-top:16px;">
      <div class="card-sm">
        <h4>Operator Diversity</h4>
        <p style="color:var(--text-dim);font-size:0.9rem;">Extractive, abstractive, and latent compression have distinct information-loss profiles.</p>
      </div>
      <div class="card-sm">
        <h4>Episode Importance</h4>
        <p style="color:var(--text-dim);font-size:0.9rem;">Not all episodes are equal: some hold critical facts, others routine observations.</p>
      </div>
      <div class="card-sm">
        <h4>Budget Variability</h4>
        <p style="color:var(--text-dim);font-size:0.9rem;">Optimal compression depends on token budget, which varies across deployment scenarios.</p>
      </div>
    </div>
  </div>

  <div class="equation-block">
    <strong>Optimization Objective:</strong><br>
    max{r1,...,rT} Sum(wi * rho_i(ri))   s.t.   Sum(|C_ri(mi)|) &lt;= B<br>
    <span style="color:var(--text-dim);font-size:0.82rem;">Maximize weighted information retention subject to a global token budget B</span>
  </div>

  <div class="equation-block">
    <strong>Information Retention:</strong><br>
    rho_i(ri) = |F_i intersection F_hat_i| / |F_i|<br>
    <span style="color:var(--text-dim);font-size:0.82rem;">Fraction of salient facts preserved after compression</span>
  </div>
</section>

<!-- Methods -->
<section id="methods">
  <h2>Compression Operators</h2>
  <p class="section-desc">Three families of operators spanning the spectrum of compression techniques used in LLM agent systems.</p>

  <div class="method-grid">
    <div class="method-card">
      <h4 style="color:var(--extractive);">Extractive Compression</h4>
      <p>Selects a subset of sentences preserving exact wording. Sentences scored by informativeness. Retention is binary per-sentence: a fact is fully retained iff its containing sentence is selected.</p>
      <div class="formula">Selection: top-k by informativeness score<br>Retention: binary (all or nothing per sentence)</div>
    </div>
    <div class="method-card abstractive">
      <h4 style="color:var(--abstractive);">Abstractive Compression</h4>
      <p>Simulates LLM-based summarization. Per-fact retention modeled by a logistic function with steepness k=8 and half-retention threshold at r=0.35.</p>
      <div class="formula">P(retain | r) = sigmoid(k * (r - tau))<br>k=8, tau=0.35</div>
    </div>
    <div class="method-card latent">
      <h4 style="color:var(--latent);">Latent Compression</h4>
      <p>Simulates embedding-based storage with encode-decode. Per-fact retention via Beta distribution with sub-linear exponent modeling efficient distributional semantics capture.</p>
      <div class="formula">P(retain | r) ~ Beta(r^0.6 * kappa, (1-r^0.6) * kappa)<br>kappa=12</div>
    </div>
  </div>

  <div class="card" style="margin-top:28px;">
    <h3>ITAMC: Adaptive Compression Controller</h3>
    <p style="color:var(--text-dim);font-size:0.95rem;margin-bottom:12px;">
      ITAMC solves the budget-constrained allocation by assigning compression ratios proportionally to saliency scores. Two-phase approach:
    </p>
    <div class="card-grid">
      <div class="card-sm">
        <h4>Phase 1: Initial Allocation</h4>
        <p style="color:var(--text-dim);font-size:0.88rem;">Each episode receives token allocation proportional to saliency times original size, normalized to fit the budget.</p>
      </div>
      <div class="card-sm">
        <h4>Phase 2: Iterative Projection</h4>
        <p style="color:var(--text-dim);font-size:0.88rem;">Clipped ratios iteratively rescaled to satisfy budget constraint. Convergence in 5-10 iterations, under 1ms for 100 episodes.</p>
      </div>
    </div>
    <div class="equation-block" style="margin-top:16px;">
      <strong>Saliency Score:</strong><br>
      s_i = 0.6 * lexical_relevance(q, m_i) + 0.4 * exp(-lambda * (T - t_i))<br>
      <span style="color:var(--text-dim);font-size:0.82rem;">Combines content relevance (60%) with temporal recency (40%), decay rate lambda=0.02</span>
    </div>
  </div>
</section>

<!-- Pareto Frontier -->
<section id="pareto">
  <h2>Pareto Frontier</h2>
  <p class="section-desc">Compression ratio vs. information retention trade-off. All operators exhibit concave frontiers: the first 40% of token savings come at modest information cost.</p>

  <div class="card">
    <div class="chart-container" style="max-width:900px;height:420px;">
      <canvas id="paretoChart"></canvas>
    </div>
  </div>

  <h3>Retention at Key Compression Ratios</h3>
  <div class="table-wrap">
    <table>
      <thead>
        <tr><th>Operator</th><th>r=0.2</th><th>r=0.4</th><th>r=0.6</th><th>r=0.8</th><th>r=1.0</th></tr>
      </thead>
      <tbody>
        <tr><td style="color:var(--extractive);font-weight:600;">Extractive</td><td>33.3%</td><td>70.7%</td><td>87.0%</td><td>98.0%</td><td>100.0%</td></tr>
        <tr><td style="color:var(--abstractive);font-weight:600;">Abstractive</td><td>22.0%</td><td>61.7%</td><td>87.3%</td><td>96.3%</td><td>98.0%</td></tr>
        <tr><td style="color:var(--latent);font-weight:600;">Latent</td><td>39.3%</td><td>59.0%</td><td>74.7%</td><td>88.7%</td><td>100.0%</td></tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Optimal Operating Points -->
<section id="optimal">
  <h2>Optimal Operating Points</h2>
  <p class="section-desc">Knee-point analysis identifies where additional compression begins to cause disproportionate retention loss -- the point of maximum curvature on the Pareto frontier.</p>

  <div class="card-grid" style="margin-bottom:24px;">
    <div class="card-sm" style="border-left:3px solid var(--extractive);">
      <h4>Extractive Knee</h4>
      <div class="val" style="color:var(--extractive);">r* = 0.42</div>
      <p style="color:var(--text-dim);font-size:0.88rem;">Retention: 76.0%</p>
    </div>
    <div class="card-sm" style="border-left:3px solid var(--abstractive);">
      <h4>Abstractive Knee</h4>
      <div class="val" style="color:var(--abstractive);">r* = 0.59</div>
      <p style="color:var(--text-dim);font-size:0.88rem;">Retention: 87.0%</p>
    </div>
    <div class="card-sm" style="border-left:3px solid var(--latent);">
      <h4>Latent Knee</h4>
      <div class="val" style="color:var(--latent);">r* = 0.26</div>
      <p style="color:var(--text-dim);font-size:0.88rem;">Retention: 49.0%</p>
    </div>
  </div>

  <div class="chart-row">
    <div class="card">
      <h3 style="margin-top:0;">Pareto Curves with Knee Points</h3>
      <div class="chart-container" style="height:360px;">
        <canvas id="kneeChart"></canvas>
      </div>
    </div>
    <div class="card">
      <h3 style="margin-top:0;">Marginal Retention (Gradient)</h3>
      <div class="chart-container" style="height:360px;">
        <canvas id="marginalChart"></canvas>
      </div>
    </div>
  </div>
</section>

<!-- Adaptive vs Uniform -->
<section id="adaptive">
  <h2>Adaptive vs. Uniform Compression</h2>
  <p class="section-desc">ITAMC's saliency-guided allocation compared against uniform compression across budget levels. Adaptive excels under extreme constraints; uniform wins at moderate budgets.</p>

  <div class="card">
    <div class="tab-bar" id="adaptiveTabs">
      <button class="tab-btn active" data-op="extractive">Extractive</button>
      <button class="tab-btn" data-op="abstractive">Abstractive</button>
      <button class="tab-btn" data-op="latent">Latent</button>
    </div>
    <div class="chart-container" style="max-width:900px;height:400px;">
      <canvas id="adaptiveChart"></canvas>
    </div>
  </div>

  <h3>Retention Delta: Adaptive minus Uniform (pp)</h3>
  <div class="table-wrap">
    <table>
      <thead>
        <tr><th>Budget</th><th>Extractive</th><th>Abstractive</th><th>Latent</th></tr>
      </thead>
      <tbody>
        <tr><td>10%</td><td class="pos">+10.2</td><td class="neg">-0.1</td><td class="neg">-2.5</td></tr>
        <tr><td>20%</td><td class="neg">-1.5</td><td class="pos">+3.9</td><td class="pos">+0.5</td></tr>
        <tr><td>30%</td><td class="neg">-11.9</td><td class="pos">+1.4</td><td class="neg">-1.2</td></tr>
        <tr><td>40%</td><td class="neg">-9.8</td><td class="neg">-5.8</td><td class="neg">-0.7</td></tr>
        <tr><td>50%</td><td class="neg">-8.1</td><td class="neg">-11.0</td><td class="neg">-2.7</td></tr>
        <tr><td>60%</td><td class="neg">-9.3</td><td class="neg">-14.2</td><td class="neg">-3.1</td></tr>
      </tbody>
    </table>
  </div>

  <div class="card" style="margin-top:20px;">
    <h3 style="margin-top:0;">Retention Delta Across Budget Range</h3>
    <div class="chart-container" style="max-width:900px;height:360px;">
      <canvas id="deltaChart"></canvas>
    </div>
  </div>
</section>

<!-- Compounding Error -->
<section id="compounding">
  <h2>Retention Stability Over Episode Horizons</h2>
  <p class="section-desc">Does compression error compound over many episodes? At moderate ratios, retention remains remarkably stable across long agent horizons.</p>

  <div class="card">
    <div class="tab-bar" id="compoundTabs">
      <button class="tab-btn active" data-op="extractive">Extractive</button>
      <button class="tab-btn" data-op="abstractive">Abstractive</button>
      <button class="tab-btn" data-op="latent">Latent</button>
    </div>
    <div class="chart-container" style="max-width:900px;height:400px;">
      <canvas id="compoundingChart"></canvas>
    </div>
  </div>

  <div class="card-grid" style="margin-top:20px;">
    <div class="card-sm">
      <h4>Extractive @ r=0.6</h4>
      <div class="val" style="color:var(--extractive);">-6.3 pp</div>
      <p style="color:var(--text-dim);font-size:0.85rem;">Decline from h=10 (93.3%) to h=100 (87.0%)</p>
    </div>
    <div class="card-sm">
      <h4>Extractive @ r=0.8</h4>
      <div class="val" style="color:var(--latent);">-1.7 pp</div>
      <p style="color:var(--text-dim);font-size:0.85rem;">Decline from h=10 (100%) to h=100 (98.3%)</p>
    </div>
    <div class="card-sm">
      <h4>At r=0.2 (aggressive)</h4>
      <div class="val" style="color:var(--text-dim);">Flat</div>
      <p style="color:var(--text-dim);font-size:0.85rem;">Already low; per-step quality dominates, not accumulation</p>
    </div>
  </div>
</section>

<!-- Saliency Analysis -->
<section id="saliency">
  <h2>Saliency-Stratified Retention</h2>
  <p class="section-desc">At a fixed compression ratio (r=0.4), retention is largely independent of saliency level -- validating that saliency should determine allocation, not predict compressibility.</p>

  <div class="card">
    <div class="tab-bar" id="saliencyTabs">
      <button class="tab-btn active" data-task="avg">Average (All Tasks)</button>
      <button class="tab-btn" data-task="0">Error Diagnostics</button>
      <button class="tab-btn" data-task="1">Capacity Planning</button>
      <button class="tab-btn" data-task="2">Security Audit</button>
    </div>
    <div class="chart-container" style="max-width:700px;height:360px;">
      <canvas id="saliencyChart"></canvas>
    </div>
  </div>
</section>

<!-- Interactive Explorer -->
<section id="explorer" style="padding-top:20px;">
  <h2>Interactive Compression Explorer</h2>
  <p class="section-desc">Select a compression ratio and see the predicted retention for each operator in real time.</p>
  <div class="card">
    <div class="slider-group">
      <label for="ratioSlider">Compression Ratio:</label>
      <input type="range" id="ratioSlider" min="5" max="100" value="50" step="1">
      <span class="slider-val" id="ratioVal">0.50</span>
    </div>
    <div class="card-grid">
      <div class="card-sm" id="expExt" style="border-left:3px solid var(--extractive);">
        <h4>Extractive Retention</h4>
        <div class="val" style="color:var(--extractive);"></div>
      </div>
      <div class="card-sm" id="expAbs" style="border-left:3px solid var(--abstractive);">
        <h4>Abstractive Retention</h4>
        <div class="val" style="color:var(--abstractive);"></div>
      </div>
      <div class="card-sm" id="expLat" style="border-left:3px solid var(--latent);">
        <h4>Latent Retention</h4>
        <div class="val" style="color:var(--latent);"></div>
      </div>
    </div>
    <div class="card-grid" style="margin-top:12px;">
      <div class="card-sm">
        <h4>Token Savings</h4>
        <div class="val" id="tokenSavings" style="color:var(--highlight);"></div>
      </div>
      <div class="card-sm">
        <h4>Tokens Used (of 6,233)</h4>
        <div class="val" id="tokensUsed" style="color:var(--text-dim);"></div>
      </div>
    </div>
  </div>
</section>

<!-- Key Findings -->
<section id="findings">
  <h2>Key Findings</h2>
  <p class="section-desc">Four principal findings from controlled experiments on a synthetic benchmark with exact ground-truth fact retention.</p>
  <div class="finding-list">
    <div class="finding">
      <div class="finding-num">1</div>
      <div>
        <h4>Concave Pareto Frontiers</h4>
        <p>All three operators exhibit concave frontiers: moderate compression (r = 0.4-0.6) achieves 60-87% retention while reducing tokens by 40-60%. The first 40% of savings come at modest information cost.</p>
      </div>
    </div>
    <div class="finding">
      <div class="finding-num">2</div>
      <div>
        <h4>Operator-Dependent Optimal Ratios</h4>
        <p>Knee-point analysis yields r*=0.42 (extractive), r*=0.59 (abstractive), r*=0.26 (latent). System designers should calibrate compression targets to their specific operator.</p>
      </div>
    </div>
    <div class="finding">
      <div class="finding-num">3</div>
      <div>
        <h4>Adaptive Allocation Under Extreme Budgets</h4>
        <p>Saliency-guided adaptive compression provides gains up to +10.2 pp at 10% budget for extractive compression. At moderate budgets (30%+), uniform compression is competitive and simpler.</p>
      </div>
    </div>
    <div class="finding">
      <div class="finding-num">4</div>
      <div>
        <h4>No Catastrophic Compounding</h4>
        <p>Moderate compression does not compound catastrophically over 100 episodes, with retention declining by at most 6.3 pp from h=10 to h=100 at r=0.6. Per-step quality dominates.</p>
      </div>
    </div>
  </div>
</section>

<!-- Data Tables -->
<section id="data">
  <h2>Experimental Data</h2>
  <p class="section-desc">Full numerical results from the experimental evaluation. 100 synthetic episodes, 300 ground-truth facts, 8 downstream task queries, seed 42.</p>

  <h3>Full Pareto Frontier Data</h3>
  <div class="table-wrap">
    <table id="fullParetoTable">
      <thead>
        <tr><th>Target Ratio</th><th>Ext. Retention</th><th>Abs. Retention</th><th>Lat. Retention</th><th>Ext. Tokens</th><th>Abs. Tokens</th><th>Lat. Tokens</th></tr>
      </thead>
      <tbody id="paretoBody"></tbody>
    </table>
  </div>

  <h3>Compounding Error Data</h3>
  <div class="table-wrap">
    <table id="compoundTable">
      <thead>
        <tr><th>Horizon</th><th>Ratio</th><th>Ext. Retention</th><th>Abs. Retention</th><th>Lat. Retention</th></tr>
      </thead>
      <tbody id="compoundBody"></tbody>
    </table>
  </div>

  <h3>Downstream Task Queries</h3>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Task ID</th><th>Query</th></tr></thead>
      <tbody>
        <tr><td>0</td><td>What errors or failures occurred in the system recently?</td></tr>
        <tr><td>1</td><td>Which components need capacity expansion or migration?</td></tr>
        <tr><td>2</td><td>Summarize all security-related events and certificate updates.</td></tr>
        <tr><td>3</td><td>What is the current health status of the database and cache layers?</td></tr>
        <tr><td>4</td><td>List all performance anomalies and latency issues.</td></tr>
        <tr><td>5</td><td>Which components experienced resource exhaustion?</td></tr>
        <tr><td>6</td><td>Describe all deployment and scaling activities.</td></tr>
        <tr><td>7</td><td>What authentication and access-related events occurred?</td></tr>
      </tbody>
    </table>
  </div>
</section>

<footer>
  <p>Information-Theoretic Adaptive Memory Compression for LLM-Based Agents</p>
  <p style="margin-top:6px;">Category: AI | 100 Episodes | 300 Facts | 3 Operators | Seed 42</p>
</footer>

<script>
// ===========================================================================
// EMBEDDED DATA
// ===========================================================================
var PARETO = {
  extractive: [
    {target_ratio:0.05,mean_retention:0.0,total_tokens:0},
    {target_ratio:0.1,mean_retention:0.0,total_tokens:354},
    {target_ratio:0.15,mean_retention:0.327,total_tokens:845},
    {target_ratio:0.2,mean_retention:0.333,total_tokens:864},
    {target_ratio:0.25,mean_retention:0.413,total_tokens:1444},
    {target_ratio:0.3,mean_retention:0.617,total_tokens:1684},
    {target_ratio:0.35,mean_retention:0.630,total_tokens:1792},
    {target_ratio:0.4,mean_retention:0.707,total_tokens:2377},
    {target_ratio:0.45,mean_retention:0.783,total_tokens:2534},
    {target_ratio:0.5,mean_retention:0.790,total_tokens:2702},
    {target_ratio:0.55,mean_retention:0.850,total_tokens:3324},
    {target_ratio:0.6,mean_retention:0.870,total_tokens:3380},
    {target_ratio:0.65,mean_retention:0.877,total_tokens:3864},
    {target_ratio:0.7,mean_retention:0.947,total_tokens:4158},
    {target_ratio:0.75,mean_retention:0.950,total_tokens:4245},
    {target_ratio:0.8,mean_retention:0.980,total_tokens:4868},
    {target_ratio:0.85,mean_retention:0.990,total_tokens:4914},
    {target_ratio:0.9,mean_retention:0.993,total_tokens:5457},
    {target_ratio:0.95,mean_retention:0.997,total_tokens:5607},
    {target_ratio:1.0,mean_retention:1.0,total_tokens:6233}
  ],
  abstractive: [
    {target_ratio:0.05,mean_retention:0.070,total_tokens:613},
    {target_ratio:0.1,mean_retention:0.117,total_tokens:698},
    {target_ratio:0.15,mean_retention:0.160,total_tokens:774},
    {target_ratio:0.2,mean_retention:0.220,total_tokens:883},
    {target_ratio:0.25,mean_retention:0.313,total_tokens:1074},
    {target_ratio:0.3,mean_retention:0.413,total_tokens:1277},
    {target_ratio:0.35,mean_retention:0.520,total_tokens:1528},
    {target_ratio:0.4,mean_retention:0.617,total_tokens:1775},
    {target_ratio:0.45,mean_retention:0.713,total_tokens:2001},
    {target_ratio:0.5,mean_retention:0.767,total_tokens:2123},
    {target_ratio:0.55,mean_retention:0.820,total_tokens:2252},
    {target_ratio:0.6,mean_retention:0.873,total_tokens:2383},
    {target_ratio:0.65,mean_retention:0.900,total_tokens:2451},
    {target_ratio:0.7,mean_retention:0.943,total_tokens:2554},
    {target_ratio:0.75,mean_retention:0.957,total_tokens:2586},
    {target_ratio:0.8,mean_retention:0.963,total_tokens:2602},
    {target_ratio:0.85,mean_retention:0.970,total_tokens:2620},
    {target_ratio:0.9,mean_retention:0.973,total_tokens:2629},
    {target_ratio:0.95,mean_retention:0.977,total_tokens:2636},
    {target_ratio:1.0,mean_retention:0.980,total_tokens:2644}
  ],
  latent: [
    {target_ratio:0.05,mean_retention:0.173,total_tokens:847},
    {target_ratio:0.1,mean_retention:0.283,total_tokens:1085},
    {target_ratio:0.15,mean_retention:0.347,total_tokens:1219},
    {target_ratio:0.2,mean_retention:0.393,total_tokens:1317},
    {target_ratio:0.25,mean_retention:0.467,total_tokens:1492},
    {target_ratio:0.3,mean_retention:0.507,total_tokens:1590},
    {target_ratio:0.35,mean_retention:0.537,total_tokens:1663},
    {target_ratio:0.4,mean_retention:0.590,total_tokens:1792},
    {target_ratio:0.45,mean_retention:0.633,total_tokens:1897},
    {target_ratio:0.5,mean_retention:0.667,total_tokens:1977},
    {target_ratio:0.55,mean_retention:0.717,total_tokens:2097},
    {target_ratio:0.6,mean_retention:0.747,total_tokens:2172},
    {target_ratio:0.65,mean_retention:0.787,total_tokens:2270},
    {target_ratio:0.7,mean_retention:0.823,total_tokens:2363},
    {target_ratio:0.75,mean_retention:0.857,total_tokens:2449},
    {target_ratio:0.8,mean_retention:0.887,total_tokens:2521},
    {target_ratio:0.85,mean_retention:0.920,total_tokens:2601},
    {target_ratio:0.9,mean_retention:0.910,total_tokens:2579},
    {target_ratio:0.95,mean_retention:0.950,total_tokens:2673},
    {target_ratio:1.0,mean_retention:1.0,total_tokens:2796}
  ]
};

var OPTIMAL = {
  extractive: {
    ratios:[0.05,0.069,0.089,0.108,0.128,0.147,0.166,0.186,0.205,0.224,0.244,0.263,0.283,0.302,0.321,0.341,0.360,0.380,0.399,0.418,0.438,0.457,0.477,0.496,0.515,0.535,0.554,0.573,0.593,0.612,0.632,0.651,0.670,0.690,0.709,0.729,0.748,0.767,0.787,0.806,0.826,0.845,0.864,0.884,0.903,0.922,0.942,0.961,0.981,1.0],
    retentions:[0.0,0.0,0.0,0.017,0.223,0.313,0.333,0.333,0.333,0.337,0.367,0.497,0.587,0.62,0.627,0.627,0.633,0.657,0.707,0.76,0.78,0.787,0.79,0.79,0.803,0.827,0.857,0.87,0.87,0.87,0.877,0.883,0.92,0.94,0.95,0.95,0.95,0.95,0.963,0.983,0.99,0.99,0.99,0.99,0.993,0.997,0.997,0.997,0.997,1.0],
    marginal:[0,0,0.43,5.76,7.65,2.84,0.52,0,0.09,0.86,4.13,5.67,3.18,1.03,0.17,0.17,0.77,1.89,2.66,1.89,0.69,0.26,0.09,0.34,0.95,1.38,1.12,0.34,0,0.17,0.34,1.12,1.46,0.77,0.26,0,0,0.34,0.86,0.69,0.17,0,0,0.09,0.17,0.09,0,0,0.09,0.17],
    knee_ratio: 0.418, knee_retention: 0.76
  },
  abstractive: {
    ratios:[0.05,0.069,0.089,0.108,0.128,0.147,0.166,0.186,0.205,0.224,0.244,0.263,0.283,0.302,0.321,0.341,0.360,0.380,0.399,0.418,0.438,0.457,0.477,0.496,0.515,0.535,0.554,0.573,0.593,0.612,0.632,0.651,0.670,0.690,0.709,0.729,0.748,0.767,0.787,0.806,0.826,0.845,0.864,0.884,0.903,0.922,0.942,0.961,0.981,1.0],
    retentions:[0.07,0.093,0.097,0.137,0.147,0.16,0.173,0.193,0.223,0.273,0.3,0.33,0.39,0.42,0.44,0.507,0.533,0.59,0.613,0.657,0.687,0.717,0.747,0.763,0.78,0.813,0.827,0.843,0.87,0.883,0.893,0.9,0.923,0.937,0.95,0.953,0.957,0.96,0.963,0.963,0.97,0.97,0.973,0.973,0.973,0.973,0.977,0.977,0.98,0.98],
    marginal:[1.2,0.69,1.12,1.29,0.6,0.69,0.86,1.29,2.06,1.98,1.46,2.32,2.32,1.29,2.24,2.41,2.15,2.06,1.72,1.89,1.55,1.55,1.2,0.86,1.29,1.2,0.77,1.12,1.03,0.6,0.43,0.77,0.95,0.69,0.43,0.17,0.17,0.17,0.09,0.17,0.17,0.09,0.09,0,0,0.09,0.09,0.09,0.09,0],
    knee_ratio: 0.593, knee_retention: 0.87
  },
  latent: {
    ratios:[0.05,0.069,0.089,0.108,0.128,0.147,0.166,0.186,0.205,0.224,0.244,0.263,0.283,0.302,0.321,0.341,0.360,0.380,0.399,0.418,0.438,0.457,0.477,0.496,0.515,0.535,0.554,0.573,0.593,0.612,0.632,0.651,0.670,0.690,0.709,0.729,0.748,0.767,0.787,0.806,0.826,0.845,0.864,0.884,0.903,0.922,0.942,0.961,0.981,1.0],
    retentions:[0.173,0.21,0.26,0.297,0.317,0.343,0.363,0.377,0.407,0.423,0.45,0.49,0.507,0.507,0.517,0.53,0.55,0.553,0.59,0.613,0.617,0.64,0.657,0.663,0.687,0.703,0.72,0.737,0.747,0.757,0.78,0.787,0.797,0.81,0.83,0.837,0.85,0.863,0.887,0.89,0.913,0.92,0.933,0.9,0.913,0.943,0.957,0.96,0.973,1.0],
    marginal:[1.89,2.24,2.24,1.46,1.2,1.2,0.86,1.12,1.2,1.12,1.72,1.46,0.43,0.26,0.6,0.86,0.6,1.03,1.55,0.69,0.69,1.03,0.6,0.77,1.03,0.86,0.86,0.69,0.52,0.86,0.77,0.43,0.6,0.86,0.69,0.52,0.69,0.95,0.69,0.69,0.77,0.52,-0.52,-0.52,1.12,1.12,0.43,0.43,1.03,1.38],
    knee_ratio: 0.263, knee_retention: 0.49
  }
};

var ADAPTIVE_SUMMARY = {
  budgets: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0],
  extractive: {
    uniform:  [0.0, 0.333, 0.617, 0.707, 0.790, 0.870, 0.877, 0.980, 0.993, 1.0],
    adaptive: [0.102, 0.318, 0.498, 0.622, 0.709, 0.777, 0.835, 0.922, 0.968, 1.0],
    delta:    [0.102,-0.015,-0.119,-0.098,-0.081,-0.093,-0.042,-0.058,-0.025, 0.0]
  },
  abstractive: {
    uniform:  [0.117, 0.220, 0.413, 0.617, 0.767, 0.873, 0.943, 0.963, 0.973, 0.980],
    adaptive: [0.116, 0.259, 0.427, 0.559, 0.657, 0.731, 0.813, 0.896, 0.952, 0.974],
    delta:    [-0.001, 0.039, 0.014,-0.058,-0.110,-0.142,-0.130,-0.067,-0.021,-0.006]
  },
  latent: {
    uniform:  [0.283, 0.393, 0.507, 0.590, 0.667, 0.747, 0.823, 0.887, 0.910, 1.0],
    adaptive: [0.258, 0.398, 0.495, 0.583, 0.640, 0.716, 0.787, 0.862, 0.905, 0.967],
    delta:    [-0.025, 0.005,-0.012,-0.007,-0.027,-0.031,-0.036,-0.025,-0.005,-0.033]
  }
};

var COMPOUNDING = [
  {h:10,r:0.2,ext:0.333,abs:0.167,lat:0.400},
  {h:10,r:0.4,ext:0.700,abs:0.567,lat:0.633},
  {h:10,r:0.6,ext:0.933,abs:0.767,lat:0.733},
  {h:10,r:0.8,ext:1.000,abs:0.900,lat:0.867},
  {h:20,r:0.2,ext:0.350,abs:0.233,lat:0.417},
  {h:20,r:0.4,ext:0.767,abs:0.600,lat:0.617},
  {h:20,r:0.6,ext:0.933,abs:0.850,lat:0.783},
  {h:20,r:0.8,ext:1.000,abs:0.933,lat:0.917},
  {h:30,r:0.2,ext:0.344,abs:0.267,lat:0.389},
  {h:30,r:0.4,ext:0.744,abs:0.611,lat:0.600},
  {h:30,r:0.6,ext:0.889,abs:0.833,lat:0.778},
  {h:30,r:0.8,ext:1.000,abs:0.944,lat:0.933},
  {h:50,r:0.2,ext:0.333,abs:0.227,lat:0.413},
  {h:50,r:0.4,ext:0.720,abs:0.593,lat:0.620},
  {h:50,r:0.6,ext:0.867,abs:0.880,lat:0.747},
  {h:50,r:0.8,ext:0.993,abs:0.960,lat:0.947},
  {h:75,r:0.2,ext:0.329,abs:0.222,lat:0.422},
  {h:75,r:0.4,ext:0.720,abs:0.609,lat:0.622},
  {h:75,r:0.6,ext:0.871,abs:0.893,lat:0.751},
  {h:75,r:0.8,ext:0.991,abs:0.960,lat:0.907},
  {h:100,r:0.2,ext:0.333,abs:0.220,lat:0.393},
  {h:100,r:0.4,ext:0.720,abs:0.617,lat:0.590},
  {h:100,r:0.6,ext:0.870,abs:0.873,lat:0.747},
  {h:100,r:0.8,ext:0.983,abs:0.963,lat:0.887}
];

var SALIENCY = [
  {task:0,op:"extractive",bin:"high",ret:0.712},{task:0,op:"extractive",bin:"medium",ret:0.711},{task:0,op:"extractive",bin:"low",ret:0.759},
  {task:0,op:"abstractive",bin:"high",ret:0.667},{task:0,op:"abstractive",bin:"medium",ret:0.600},{task:0,op:"abstractive",bin:"low",ret:0.611},
  {task:0,op:"latent",bin:"high",ret:0.545},{task:0,op:"latent",bin:"medium",ret:0.583},{task:0,op:"latent",bin:"low",ret:0.667},
  {task:1,op:"extractive",bin:"high",ret:0.606},{task:1,op:"extractive",bin:"medium",ret:0.735},{task:1,op:"extractive",bin:"low",ret:0.733},
  {task:1,op:"abstractive",bin:"high",ret:0.667},{task:1,op:"abstractive",bin:"medium",ret:0.652},{task:1,op:"abstractive",bin:"low",ret:0.570},
  {task:1,op:"latent",bin:"high",ret:0.545},{task:1,op:"latent",bin:"medium",ret:0.583},{task:1,op:"latent",bin:"low",ret:0.607},
  {task:2,op:"extractive",bin:"high",ret:0.714},{task:2,op:"extractive",bin:"medium",ret:0.701},{task:2,op:"extractive",bin:"low",ret:0.748},
  {task:2,op:"abstractive",bin:"high",ret:0.643},{task:2,op:"abstractive",bin:"medium",ret:0.612},{task:2,op:"abstractive",bin:"low",ret:0.613},
  {task:2,op:"latent",bin:"high",ret:0.548},{task:2,op:"latent",bin:"medium",ret:0.592},{task:2,op:"latent",bin:"low",ret:0.604}
];

// ===========================================================================
// CHART DEFAULTS
// ===========================================================================
Chart.defaults.color = '#a0a0b8';
Chart.defaults.borderColor = 'rgba(255,255,255,0.06)';
Chart.defaults.font.family = "'Segoe UI', system-ui, sans-serif";

var COLORS = {
  extractive: '#4fc3f7',
  abstractive: '#ab47bc',
  latent: '#66bb6a',
  adaptive: '#7c4dff',
  uniform: '#78909c'
};

function pct(v) { return (v * 100).toFixed(1) + '%'; }

// ===========================================================================
// 1. PARETO FRONTIER CHART
// ===========================================================================
new Chart(document.getElementById('paretoChart'), {
  type: 'line',
  data: {
    datasets: ['extractive','abstractive','latent'].map(function(op) {
      return {
        label: op.charAt(0).toUpperCase() + op.slice(1),
        data: PARETO[op].map(function(d) { return {x: d.target_ratio, y: d.mean_retention}; }),
        borderColor: COLORS[op],
        backgroundColor: COLORS[op] + '22',
        borderWidth: 2.5,
        pointRadius: 3,
        pointHoverRadius: 6,
        tension: 0.3,
        fill: false
      };
    })
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    plugins: {
      title: { display: true, text: 'Pareto Frontier: Compression Ratio vs. Fact Retention', font: {size:15} },
      tooltip: {
        callbacks: {
          label: function(ctx) { return ctx.dataset.label + ': ' + pct(ctx.parsed.y) + ' retention at r=' + ctx.parsed.x.toFixed(2); }
        }
      }
    },
    scales: {
      x: { type:'linear', title:{display:true,text:'Target Compression Ratio (r)'}, min:0, max:1.05 },
      y: { title:{display:true,text:'Mean Fact Retention'}, min:0, max:1.05,
        ticks: { callback: function(v) { return pct(v); } }
      }
    }
  }
});

// ===========================================================================
// 2. KNEE POINT CHART
// ===========================================================================
(function() {
  var dsets = [];
  ['extractive','abstractive','latent'].forEach(function(op) {
    dsets.push({
      label: op.charAt(0).toUpperCase() + op.slice(1),
      data: OPTIMAL[op].ratios.map(function(r,i) { return {x:r, y:OPTIMAL[op].retentions[i]}; }),
      borderColor: COLORS[op],
      borderWidth: 2,
      pointRadius: 1.5,
      tension: 0.3,
      fill: false
    });
    dsets.push({
      label: op.charAt(0).toUpperCase() + op.slice(1) + ' knee',
      data: [{x: OPTIMAL[op].knee_ratio, y: OPTIMAL[op].knee_retention}],
      borderColor: COLORS[op],
      backgroundColor: COLORS[op],
      pointRadius: 10,
      pointStyle: 'rectRot',
      showLine: false
    });
  });
  new Chart(document.getElementById('kneeChart'), {
    type: 'line',
    data: { datasets: dsets },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        title: { display: true, text: 'Knee-Point Detection', font:{size:14} },
        tooltip: {
          callbacks: {
            label: function(ctx) {
              if (ctx.dataset.label.indexOf('knee') >= 0) return ctx.dataset.label + ': r*=' + ctx.parsed.x.toFixed(2) + ', ret=' + pct(ctx.parsed.y);
              return ctx.dataset.label + ': r=' + ctx.parsed.x.toFixed(2) + ', ret=' + pct(ctx.parsed.y);
            }
          }
        }
      },
      scales: {
        x: { type:'linear', title:{display:true,text:'Compression Ratio'}, min:0, max:1.05 },
        y: { title:{display:true,text:'Retention'}, min:0, max:1.05, ticks:{callback: function(v){return pct(v);}} }
      }
    }
  });
})();

// ===========================================================================
// 3. MARGINAL RETENTION CHART
// ===========================================================================
new Chart(document.getElementById('marginalChart'), {
  type: 'line',
  data: {
    datasets: ['extractive','abstractive','latent'].map(function(op) {
      return {
        label: op.charAt(0).toUpperCase() + op.slice(1),
        data: OPTIMAL[op].ratios.map(function(r,i) { return {x:r, y:OPTIMAL[op].marginal[i]}; }),
        borderColor: COLORS[op],
        borderWidth: 2,
        pointRadius: 1,
        tension: 0.3,
        fill: false
      };
    })
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    plugins: {
      title: { display: true, text: 'Marginal Retention (d_rho/dr)', font:{size:14} }
    },
    scales: {
      x: { type:'linear', title:{display:true,text:'Compression Ratio'}, min:0, max:1.05 },
      y: { title:{display:true,text:'Marginal Retention'}, min:-1, max:8 }
    }
  }
});

// ===========================================================================
// 4. ADAPTIVE VS UNIFORM CHART (with tabs)
// ===========================================================================
var adaptiveChart;
function renderAdaptive(op) {
  var d = ADAPTIVE_SUMMARY;
  if (adaptiveChart) adaptiveChart.destroy();
  adaptiveChart = new Chart(document.getElementById('adaptiveChart'), {
    type: 'line',
    data: {
      labels: d.budgets.map(function(b) { return (b*100)+'%'; }),
      datasets: [
        {
          label: 'Adaptive (ITAMC)',
          data: d[op].adaptive,
          borderColor: COLORS.adaptive,
          backgroundColor: COLORS.adaptive + '22',
          borderWidth: 2.5, pointRadius: 5, tension: 0.3
        },
        {
          label: 'Uniform',
          data: d[op].uniform,
          borderColor: COLORS.uniform,
          backgroundColor: COLORS.uniform + '22',
          borderWidth: 2.5, pointRadius: 5, tension: 0.3,
          borderDash: [6,4]
        }
      ]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        title: { display: true, text: op.charAt(0).toUpperCase()+op.slice(1) + ' Compression: Adaptive vs Uniform', font:{size:14} },
        tooltip: { callbacks: { label: function(ctx) { return ctx.dataset.label + ': ' + pct(ctx.parsed.y); } } }
      },
      scales: {
        x: { title:{display:true,text:'Token Budget (% of raw)'} },
        y: { title:{display:true,text:'Mean Retention'}, min:0, max:1.05, ticks:{callback: function(v){return pct(v);}} }
      }
    }
  });
}
renderAdaptive('extractive');
document.getElementById('adaptiveTabs').addEventListener('click', function(e) {
  if (e.target.classList.contains('tab-btn')) {
    var btns = e.target.parentElement.querySelectorAll('.tab-btn');
    for (var i = 0; i < btns.length; i++) btns[i].classList.remove('active');
    e.target.classList.add('active');
    renderAdaptive(e.target.getAttribute('data-op'));
  }
});

// ===========================================================================
// 5. DELTA RETENTION CHART
// ===========================================================================
new Chart(document.getElementById('deltaChart'), {
  type: 'bar',
  data: {
    labels: ADAPTIVE_SUMMARY.budgets.map(function(b) { return (b*100)+'%'; }),
    datasets: ['extractive','abstractive','latent'].map(function(op) {
      return {
        label: op.charAt(0).toUpperCase() + op.slice(1),
        data: ADAPTIVE_SUMMARY[op].delta.map(function(v) { return v*100; }),
        backgroundColor: COLORS[op] + 'aa',
        borderColor: COLORS[op],
        borderWidth: 1
      };
    })
  },
  options: {
    responsive: true, maintainAspectRatio: false,
    plugins: {
      title: { display: true, text: 'Retention Delta: Adaptive minus Uniform (pp)', font:{size:14} },
      tooltip: { callbacks: { label: function(ctx) { return ctx.dataset.label + ': ' + (ctx.parsed.y>0?'+':'') + ctx.parsed.y.toFixed(1) + ' pp'; } } }
    },
    scales: {
      x: { title:{display:true,text:'Token Budget'} },
      y: { title:{display:true,text:'Delta (pp)'}, suggestedMin:-16, suggestedMax:12 }
    }
  }
});

// ===========================================================================
// 6. COMPOUNDING ERROR CHART (with tabs)
// ===========================================================================
var compChart;
var horizons = [10,20,30,50,75,100];
var ratioColors = {'0.2':'#ef5350', '0.4':'#ffa726', '0.6':'#42a5f5', '0.8':'#66bb6a'};
function renderCompounding(op) {
  if (compChart) compChart.destroy();
  var opKey = op.substring(0,3);
  var datasets = [0.2,0.4,0.6,0.8].map(function(r) {
    return {
      label: 'r = ' + r,
      data: horizons.map(function(h) {
        for (var i = 0; i < COMPOUNDING.length; i++) {
          if (COMPOUNDING[i].h === h && COMPOUNDING[i].r === r) return COMPOUNDING[i][opKey];
        }
        return null;
      }),
      borderColor: ratioColors[String(r)],
      backgroundColor: ratioColors[String(r)] + '22',
      borderWidth: 2.5, pointRadius: 5, tension: 0.3
    };
  });
  compChart = new Chart(document.getElementById('compoundingChart'), {
    type: 'line',
    data: { labels: horizons.map(function(h) { return h+' ep'; }), datasets: datasets },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        title: { display: true, text: op.charAt(0).toUpperCase()+op.slice(1) + ': Retention Over Episode Horizons', font:{size:14} },
        tooltip: { callbacks: { label: function(ctx) { return ctx.dataset.label + ': ' + pct(ctx.parsed.y); } } }
      },
      scales: {
        x: { title:{display:true,text:'Episode Horizon'} },
        y: { title:{display:true,text:'Mean Retention'}, min:0, max:1.05, ticks:{callback: function(v){return pct(v);}} }
      }
    }
  });
}
renderCompounding('extractive');
document.getElementById('compoundTabs').addEventListener('click', function(e) {
  if (e.target.classList.contains('tab-btn')) {
    var btns = e.target.parentElement.querySelectorAll('.tab-btn');
    for (var i = 0; i < btns.length; i++) btns[i].classList.remove('active');
    e.target.classList.add('active');
    renderCompounding(e.target.getAttribute('data-op'));
  }
});

// ===========================================================================
// 7. SALIENCY HEATMAP CHART (with tabs)
// ===========================================================================
var salChart;
function renderSaliency(taskId) {
  if (salChart) salChart.destroy();
  var bins = ['high','medium','low'];
  var ops = ['extractive','abstractive','latent'];
  var data = [];
  if (taskId === 'avg') {
    ops.forEach(function(op) {
      var row = [];
      bins.forEach(function(bin) {
        var items = SALIENCY.filter(function(d) { return d.op===op && d.bin===bin; });
        var sum = 0;
        items.forEach(function(d) { sum += d.ret; });
        row.push(sum / items.length);
      });
      data.push(row);
    });
  } else {
    var t = parseInt(taskId);
    ops.forEach(function(op) {
      var row = [];
      bins.forEach(function(bin) {
        var found = null;
        for (var i = 0; i < SALIENCY.length; i++) {
          if (SALIENCY[i].task===t && SALIENCY[i].op===op && SALIENCY[i].bin===bin) { found = SALIENCY[i]; break; }
        }
        row.push(found ? found.ret : 0);
      });
      data.push(row);
    });
  }
  salChart = new Chart(document.getElementById('saliencyChart'), {
    type: 'bar',
    data: {
      labels: ['High Saliency','Medium Saliency','Low Saliency'],
      datasets: ops.map(function(op,i) {
        return {
          label: op.charAt(0).toUpperCase() + op.slice(1),
          data: data[i],
          backgroundColor: COLORS[op] + 'cc',
          borderColor: COLORS[op],
          borderWidth: 1
        };
      })
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        title: { display: true, text: 'Retention at r=0.4 by Saliency Level', font:{size:14} },
        tooltip: { callbacks: { label: function(ctx) { return ctx.dataset.label + ': ' + pct(ctx.parsed.y); } } }
      },
      scales: {
        y: { title:{display:true,text:'Mean Retention'}, min:0, max:1.0, ticks:{callback: function(v){return pct(v);}} }
      }
    }
  });
}
renderSaliency('avg');
document.getElementById('saliencyTabs').addEventListener('click', function(e) {
  if (e.target.classList.contains('tab-btn')) {
    var btns = e.target.parentElement.querySelectorAll('.tab-btn');
    for (var i = 0; i < btns.length; i++) btns[i].classList.remove('active');
    e.target.classList.add('active');
    renderSaliency(e.target.getAttribute('data-task'));
  }
});

// ===========================================================================
// 8. INTERACTIVE EXPLORER
// ===========================================================================
var slider = document.getElementById('ratioSlider');
var ratioValEl = document.getElementById('ratioVal');
function interpolate(arr, ratio) {
  for (var i = 0; i < arr.length - 1; i++) {
    if (ratio >= arr[i].target_ratio && ratio <= arr[i+1].target_ratio) {
      var t = (ratio - arr[i].target_ratio) / (arr[i+1].target_ratio - arr[i].target_ratio);
      return arr[i].mean_retention + t * (arr[i+1].mean_retention - arr[i].mean_retention);
    }
  }
  return arr[arr.length-1].mean_retention;
}
function updateExplorer() {
  var r = parseInt(slider.value) / 100;
  ratioValEl.textContent = r.toFixed(2);
  var extRet = interpolate(PARETO.extractive, r);
  var absRet = interpolate(PARETO.abstractive, r);
  var latRet = interpolate(PARETO.latent, r);
  document.querySelector('#expExt .val').textContent = pct(extRet);
  document.querySelector('#expAbs .val').textContent = pct(absRet);
  document.querySelector('#expLat .val').textContent = pct(latRet);
  var savings = ((1 - r) * 100).toFixed(0) + '%';
  var used = Math.round(r * 6233);
  document.getElementById('tokenSavings').textContent = savings;
  document.getElementById('tokensUsed').textContent = used.toLocaleString();
}
slider.addEventListener('input', updateExplorer);
updateExplorer();

// ===========================================================================
// 9. POPULATE DATA TABLES (safe DOM methods)
// ===========================================================================
(function populatePareto() {
  var tbody = document.getElementById('paretoBody');
  var ratios = PARETO.extractive;
  for (var i = 0; i < ratios.length; i++) {
    var row = document.createElement('tr');
    var cells = [
      ratios[i].target_ratio.toFixed(2),
      pct(PARETO.extractive[i].mean_retention),
      pct(PARETO.abstractive[i].mean_retention),
      pct(PARETO.latent[i].mean_retention),
      PARETO.extractive[i].total_tokens.toLocaleString(),
      PARETO.abstractive[i].total_tokens.toLocaleString(),
      PARETO.latent[i].total_tokens.toLocaleString()
    ];
    for (var j = 0; j < cells.length; j++) {
      var td = document.createElement('td');
      td.textContent = cells[j];
      row.appendChild(td);
    }
    tbody.appendChild(row);
  }
})();

(function populateCompound() {
  var tbody = document.getElementById('compoundBody');
  var hs = [10,20,30,50,75,100];
  var rs = [0.2,0.4,0.6,0.8];
  for (var hi = 0; hi < hs.length; hi++) {
    for (var ri = 0; ri < rs.length; ri++) {
      var d = null;
      for (var k = 0; k < COMPOUNDING.length; k++) {
        if (COMPOUNDING[k].h === hs[hi] && COMPOUNDING[k].r === rs[ri]) { d = COMPOUNDING[k]; break; }
      }
      if (!d) continue;
      var row = document.createElement('tr');
      var cells = [String(d.h), String(d.r), pct(d.ext), pct(d.abs), pct(d.lat)];
      for (var j = 0; j < cells.length; j++) {
        var td = document.createElement('td');
        td.textContent = cells[j];
        row.appendChild(td);
      }
      tbody.appendChild(row);
    }
  }
})();

// ===========================================================================
// 10. ACTIVE NAV HIGHLIGHT
// ===========================================================================
var navLinks = document.querySelectorAll('nav a');
var sectionEls = document.querySelectorAll('section[id]');
var observer = new IntersectionObserver(function(entries) {
  entries.forEach(function(entry) {
    if (entry.isIntersecting) {
      for (var i = 0; i < navLinks.length; i++) {
        if (navLinks[i].getAttribute('href') === '#' + entry.target.id) {
          navLinks[i].classList.add('active');
        } else {
          navLinks[i].classList.remove('active');
        }
      }
    }
  });
}, { rootMargin: '-20% 0px -80% 0px' });
for (var s = 0; s < sectionEls.length; s++) observer.observe(sectionEls[s]);
</script>
</body>
</html>
