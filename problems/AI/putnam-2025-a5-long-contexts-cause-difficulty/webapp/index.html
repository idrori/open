<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Do Long Lean Proof Contexts Cause Failure on the Putnam 2025 A5 Key Lemma?</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary: #1a237e;
  --secondary: #283593;
  --accent: #ff6f00;
  --accent2: #e65100;
  --bg: #fafafa;
  --card: #ffffff;
  --text: #212121;
  --text-light: #616161;
  --border: #e0e0e0;
  --success: #2e7d32;
  --danger: #c62828;
  --purple: #6a1b9a;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
}
.container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

/* Hero */
.hero {
  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 60%, #1565c0 100%);
  color: #fff;
  padding: 60px 0 48px;
  position: relative;
  overflow: hidden;
}
.hero::after {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0; bottom: 0;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
  pointer-events: none;
}
.hero h1 { font-size: 2rem; font-weight: 700; margin-bottom: 16px; position: relative; z-index: 1; }
.hero .subtitle { font-size: 1.1rem; opacity: 0.92; max-width: 800px; position: relative; z-index: 1; line-height: 1.7; }
.hero .venue { display: inline-block; background: rgba(255,255,255,0.15); padding: 6px 16px; border-radius: 20px; font-size: 0.85rem; margin-top: 16px; position: relative; z-index: 1; }

/* Stats bar */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin: -32px auto 32px;
  position: relative;
  z-index: 2;
}
.stat-card {
  background: var(--card);
  border-radius: 12px;
  padding: 24px;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  border-top: 3px solid var(--accent);
}
.stat-card .value { font-size: 2rem; font-weight: 700; color: var(--primary); }
.stat-card .label { font-size: 0.85rem; color: var(--text-light); margin-top: 4px; }

/* Sections */
section { padding: 48px 0; }
section:nth-child(even) { background: #f5f5f5; }
.section-title {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 8px;
}
.section-desc {
  color: var(--text-light);
  margin-bottom: 32px;
  max-width: 700px;
}

/* Cards */
.card {
  background: var(--card);
  border-radius: 12px;
  padding: 28px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  margin-bottom: 24px;
}
.card h3 { font-size: 1.15rem; color: var(--secondary); margin-bottom: 12px; }

/* Chart grid */
.chart-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(480px, 1fr));
  gap: 24px;
}
.chart-container { position: relative; height: 340px; }

/* Tables */
.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.9rem;
}
.data-table th {
  background: var(--primary);
  color: #fff;
  padding: 12px 16px;
  text-align: left;
  font-weight: 600;
}
.data-table td {
  padding: 10px 16px;
  border-bottom: 1px solid var(--border);
}
.data-table tr:hover td { background: #f0f4ff; }
.data-table .num { text-align: right; font-variant-numeric: tabular-nums; }
.improve { color: var(--success); font-weight: 600; }
.degrade { color: var(--danger); font-weight: 600; }

/* Findings */
.findings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}
.finding-card {
  background: var(--card);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  border-left: 4px solid var(--accent);
}
.finding-card h4 { color: var(--secondary); margin-bottom: 8px; font-size: 1rem; }
.finding-card p { color: var(--text-light); font-size: 0.9rem; }
.finding-card .metric { font-size: 1.5rem; font-weight: 700; color: var(--accent2); margin: 8px 0; }

/* Tabs */
.tab-bar {
  display: flex;
  gap: 4px;
  margin-bottom: 24px;
  border-bottom: 2px solid var(--border);
}
.tab-btn {
  padding: 10px 20px;
  border: none;
  background: transparent;
  color: var(--text-light);
  font-size: 0.9rem;
  font-weight: 600;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  margin-bottom: -2px;
  transition: all 0.2s;
}
.tab-btn.active {
  color: var(--primary);
  border-bottom-color: var(--primary);
}
.tab-content { display: none; }
.tab-content.active { display: block; }

/* Problem */
.problem-box {
  background: linear-gradient(135deg, #e8eaf6 0%, #f3e5f5 100%);
  border-radius: 12px;
  padding: 28px;
  margin-bottom: 24px;
}
.problem-box h3 { color: var(--secondary); margin-bottom: 12px; }
.method-list { list-style: none; }
.method-list li {
  padding: 10px 0;
  border-bottom: 1px solid rgba(0,0,0,0.08);
  display: flex;
  align-items: flex-start;
  gap: 12px;
}
.method-list li::before {
  content: '';
  display: inline-block;
  width: 8px;
  height: 8px;
  background: var(--accent);
  border-radius: 50%;
  margin-top: 8px;
  flex-shrink: 0;
}

/* Footer */
footer {
  background: var(--primary);
  color: rgba(255,255,255,0.8);
  text-align: center;
  padding: 24px;
  font-size: 0.85rem;
}

@media (max-width: 600px) {
  .hero h1 { font-size: 1.4rem; }
  .hero { padding: 40px 0 36px; }
  .chart-grid { grid-template-columns: 1fr; }
  .chart-container { height: 280px; }
  .stats-bar { grid-template-columns: repeat(2, 1fr); }
  .stat-card .value { font-size: 1.5rem; }
  .tab-btn { padding: 8px 12px; font-size: 0.8rem; }
}
</style>
</head>
<body>

<!-- Hero Section -->
<header class="hero">
  <div class="container">
    <h1>Do Long Lean Proof Contexts Cause Failure on the Putnam 2025 A5 Key Lemma?</h1>
    <p class="subtitle">
      A systematic empirical investigation of how proof context length degrades LLM-based
      theorem proving performance. Through 2,700 controlled experiments, we show that context
      length strongly predicts failure, with a critical threshold at 8,192 tokens for the
      A5 key lemma.
    </p>
    <span class="venue">KDD 2026 &middot; Research Track &middot; AI</span>
  </div>
</header>

<!-- Stats Bar -->
<div class="container">
  <div class="stats-bar">
    <div class="stat-card">
      <div class="value">2,700</div>
      <div class="label">Controlled Experiments</div>
    </div>
    <div class="stat-card">
      <div class="value">&rho; = &minus;0.856</div>
      <div class="label">Spearman Correlation (Completion vs. Context)</div>
    </div>
    <div class="stat-card">
      <div class="value">8,192</div>
      <div class="label">Critical Threshold (tokens)</div>
    </div>
    <div class="stat-card">
      <div class="value">0.993</div>
      <div class="label">Subagent Completion Rate</div>
    </div>
  </div>
</div>

<!-- Problem & Methods -->
<section>
  <div class="container">
    <h2 class="section-title">Problem &amp; Methods</h2>
    <p class="section-desc">
      Investigating why LLM-based proof assistants fail on Putnam 2025 problem A5's key lemma,
      which requires showing that alternating permutations maximize a combinatorial counting function.
    </p>
    <div class="chart-grid">
      <div class="problem-box">
        <h3>Problem Setting</h3>
        <p style="margin-bottom:12px; color: var(--text-light);">
          Liu et al. (2026) reported that their Numina-Lean-Agent system repeatedly stalled on
          the A5 key lemma and conjectured that long proof contexts caused the difficulty.
          We test this hypothesis with a controlled factorial experiment:
        </p>
        <ul class="method-list">
          <li><strong>Context length:</strong> 9 levels from 512 to 32,768 tokens</li>
          <li><strong>Lemma types:</strong> 5 types (A5 key, 2 auxiliary, generic algebra, induction)</li>
          <li><strong>Strategies:</strong> Monolithic vs. subagent decomposition (caps context at 2,048 tokens)</li>
          <li><strong>Replication:</strong> 30 trials per cell (9 x 5 x 2 = 90 cells, 2,700 total)</li>
        </ul>
      </div>
      <div class="problem-box">
        <h3>Metrics &amp; Model</h3>
        <p style="margin-bottom:12px; color: var(--text-light);">
          Four primary metrics track different aspects of context-induced degradation:
        </p>
        <ul class="method-list">
          <li><strong>Proof completion rate:</strong> Fraction of attempts that fully close the proof</li>
          <li><strong>Tactic accuracy:</strong> Fraction of tactics that are syntactically and semantically correct</li>
          <li><strong>Goal-focus score:</strong> [0,1] measure of whether the agent addresses the correct subgoal</li>
          <li><strong>Stall count:</strong> Number of repetitive-loop events without progress</li>
        </ul>
        <p style="margin-top: 12px; color: var(--text-light); font-size: 0.9rem;">
          Context degradation follows a sigmoid-modulated exponential decay model with critical
          threshold L<sub>crit</sub> = 8,000 tokens.
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Interactive Charts -->
<section style="background: #f5f5f5;">
  <div class="container">
    <h2 class="section-title">Interactive Results</h2>
    <p class="section-desc">Explore the experimental data through interactive charts. Hover for details; click legend items to toggle series.</p>

    <div class="tab-bar">
      <button class="tab-btn active" onclick="showTab('tab-accuracy')">Tactic Accuracy</button>
      <button class="tab-btn" onclick="showTab('tab-completion')">Proof Completion</button>
      <button class="tab-btn" onclick="showTab('tab-calibration')">Calibration Gap</button>
      <button class="tab-btn" onclick="showTab('tab-stalls')">Stalling Behavior</button>
      <button class="tab-btn" onclick="showTab('tab-strategy')">Strategy Comparison</button>
    </div>

    <!-- Tab: Tactic Accuracy -->
    <div id="tab-accuracy" class="tab-content active">
      <div class="card">
        <h3>Tactic Accuracy vs. Context Length (Monolithic Strategy)</h3>
        <p style="color:var(--text-light); margin-bottom:16px; font-size:0.9rem;">
          Both the A5 key lemma and generic algebra degrade sharply with context length.
          Spearman rho = -0.943 (p &lt; 10<sup>-10</sup>).
        </p>
        <div class="chart-container"><canvas id="chartAccuracy"></canvas></div>
      </div>
    </div>

    <!-- Tab: Completion -->
    <div id="tab-completion" class="tab-content">
      <div class="card">
        <h3>Proof Completion Rate vs. Context Length</h3>
        <p style="color:var(--text-light); margin-bottom:16px; font-size:0.9rem;">
          The A5 key lemma collapses to 0% completion at 8,192 tokens under monolithic strategy,
          while the subagent strategy maintains near-perfect completion across all context lengths.
        </p>
        <div class="chart-container"><canvas id="chartCompletion"></canvas></div>
      </div>
    </div>

    <!-- Tab: Calibration -->
    <div id="tab-calibration" class="tab-content">
      <div class="card">
        <h3>Calibration Gap: Confidence vs. Actual Accuracy</h3>
        <p style="color:var(--text-light); margin-bottom:16px; font-size:0.9rem;">
          Agent confidence remains above 0.919 even as actual accuracy falls to 0.0,
          revealing a severe calibration failure. The gap reaches 0.919 at 32,768 tokens.
        </p>
        <div class="chart-container"><canvas id="chartCalibration"></canvas></div>
      </div>
    </div>

    <!-- Tab: Stalls -->
    <div id="tab-stalls" class="tab-content">
      <div class="card">
        <h3>Stalling Behavior vs. Context Length</h3>
        <p style="color:var(--text-light); margin-bottom:16px; font-size:0.9rem;">
          Mean stall count rises from 0.35 at 512 tokens to 8.94 at 32,768 tokens.
          The stall rate reaches 100% at 24,576 tokens.
        </p>
        <div class="chart-container"><canvas id="chartStalls"></canvas></div>
      </div>
    </div>

    <!-- Tab: Strategy -->
    <div id="tab-strategy" class="tab-content">
      <div class="card">
        <h3>Monolithic vs. Subagent Strategy by Lemma Type</h3>
        <p style="color:var(--text-light); margin-bottom:16px; font-size:0.9rem;">
          The subagent decomposition strategy, which caps effective context at 2,048 tokens,
          dramatically improves all metrics across all lemma types.
        </p>
        <div class="chart-container"><canvas id="chartStrategy"></canvas></div>
      </div>
    </div>
  </div>
</section>

<!-- Data Tables -->
<section>
  <div class="container">
    <h2 class="section-title">Detailed Data</h2>
    <p class="section-desc">Full experimental measurements across context lengths and strategies.</p>

    <div class="card" style="overflow-x:auto;">
      <h3>A5 Key Lemma: Monolithic Strategy by Context Length</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>Context (tokens)</th>
            <th class="num">Completion Rate</th>
            <th class="num">Tactic Accuracy</th>
            <th class="num">Goal Focus</th>
            <th class="num">Stall Count</th>
            <th class="num">Confidence</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>512</td><td class="num improve">1.000</td><td class="num">0.550</td><td class="num">0.768</td><td class="num">0.667</td><td class="num">0.942</td></tr>
          <tr><td>1,024</td><td class="num improve">1.000</td><td class="num">0.530</td><td class="num">0.753</td><td class="num">0.533</td><td class="num">0.943</td></tr>
          <tr><td>2,048</td><td class="num improve">1.000</td><td class="num">0.469</td><td class="num">0.738</td><td class="num">0.867</td><td class="num">0.944</td></tr>
          <tr><td>4,096</td><td class="num">0.833</td><td class="num">0.356</td><td class="num">0.688</td><td class="num">1.033</td><td class="num">0.942</td></tr>
          <tr><td>8,192</td><td class="num degrade">0.000</td><td class="num">0.180</td><td class="num">0.614</td><td class="num">1.333</td><td class="num">0.937</td></tr>
          <tr><td>12,288</td><td class="num degrade">0.000</td><td class="num">0.066</td><td class="num">0.547</td><td class="num">1.600</td><td class="num">0.938</td></tr>
          <tr><td>16,384</td><td class="num degrade">0.000</td><td class="num">0.020</td><td class="num">0.493</td><td class="num">3.600</td><td class="num">0.935</td></tr>
          <tr><td>24,576</td><td class="num degrade">0.000</td><td class="num">0.002</td><td class="num">0.398</td><td class="num">7.200</td><td class="num">0.931</td></tr>
          <tr><td>32,768</td><td class="num degrade">0.000</td><td class="num">0.000</td><td class="num">0.312</td><td class="num">8.567</td><td class="num">0.921</td></tr>
        </tbody>
      </table>
    </div>

    <div class="card" style="overflow-x:auto; margin-top: 24px;">
      <h3>Strategy Comparison Across Lemma Types</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>Lemma Type</th>
            <th class="num">Mono. Completion</th>
            <th class="num">Sub. Completion</th>
            <th class="num">Mono. Accuracy</th>
            <th class="num">Sub. Accuracy</th>
            <th class="num">Mono. Focus</th>
            <th class="num">Sub. Focus</th>
            <th class="num">Mono. Stalls</th>
            <th class="num">Sub. Stalls</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>A5 Key Lemma</td>
            <td class="num degrade">0.426</td><td class="num improve">0.993</td>
            <td class="num">0.241</td><td class="num improve">0.473</td>
            <td class="num">0.590</td><td class="num improve">0.739</td>
            <td class="num degrade">2.822</td><td class="num improve">0.778</td>
          </tr>
          <tr>
            <td>A5 Auxiliary 1</td>
            <td class="num">0.541</td><td class="num improve">1.000</td>
            <td class="num">0.340</td><td class="num improve">0.694</td>
            <td class="num">0.677</td><td class="num improve">0.858</td>
            <td class="num">2.652</td><td class="num improve">0.356</td>
          </tr>
          <tr>
            <td>A5 Auxiliary 2</td>
            <td class="num">0.522</td><td class="num improve">1.000</td>
            <td class="num">0.330</td><td class="num improve">0.681</td>
            <td class="num">0.677</td><td class="num improve">0.856</td>
            <td class="num">2.544</td><td class="num improve">0.348</td>
          </tr>
          <tr>
            <td>Generic Algebra</td>
            <td class="num">0.567</td><td class="num improve">1.000</td>
            <td class="num">0.347</td><td class="num improve">0.696</td>
            <td class="num">0.681</td><td class="num improve">0.862</td>
            <td class="num">2.533</td><td class="num improve">0.226</td>
          </tr>
          <tr>
            <td>Structural Induction</td>
            <td class="num">0.482</td><td class="num improve">1.000</td>
            <td class="num">0.331</td><td class="num improve">0.670</td>
            <td class="num">0.674</td><td class="num improve">0.849</td>
            <td class="num">2.500</td><td class="num improve">0.407</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="card" style="overflow-x:auto; margin-top: 24px;">
      <h3>Calibration Data (All Lemmas, Monolithic)</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>Context (tokens)</th>
            <th class="num">Mean Confidence</th>
            <th class="num">Mean Accuracy</th>
            <th class="num">Calibration Gap</th>
            <th class="num">Mean Stalls</th>
            <th class="num">Stall Rate</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>512</td><td class="num">0.944</td><td class="num">0.715</td><td class="num">0.229</td><td class="num">0.353</td><td class="num">0.280</td></tr>
          <tr><td>1,024</td><td class="num">0.944</td><td class="num">0.681</td><td class="num">0.264</td><td class="num">0.413</td><td class="num">0.307</td></tr>
          <tr><td>2,048</td><td class="num">0.945</td><td class="num">0.630</td><td class="num">0.316</td><td class="num">0.433</td><td class="num">0.333</td></tr>
          <tr><td>4,096</td><td class="num">0.943</td><td class="num">0.494</td><td class="num">0.449</td><td class="num">0.513</td><td class="num">0.393</td></tr>
          <tr><td>8,192</td><td class="num">0.940</td><td class="num">0.236</td><td class="num degrade">0.704</td><td class="num">0.953</td><td class="num">0.580</td></tr>
          <tr><td>12,288</td><td class="num">0.939</td><td class="num">0.081</td><td class="num degrade">0.858</td><td class="num">1.620</td><td class="num">0.800</td></tr>
          <tr><td>16,384</td><td class="num">0.936</td><td class="num">0.022</td><td class="num degrade">0.914</td><td class="num">3.513</td><td class="num">0.947</td></tr>
          <tr><td>24,576</td><td class="num">0.931</td><td class="num">0.001</td><td class="num degrade">0.931</td><td class="num">6.753</td><td class="num degrade">1.000</td></tr>
          <tr><td>32,768</td><td class="num">0.919</td><td class="num degrade">0.000</td><td class="num degrade">0.919</td><td class="num">8.940</td><td class="num degrade">1.000</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- Key Findings -->
<section style="background: #f5f5f5;">
  <div class="container">
    <h2 class="section-title">Key Findings</h2>
    <p class="section-desc">Four major contributions from 2,700 controlled experiments.</p>
    <div class="findings-grid">
      <div class="finding-card">
        <h4>1. Context Length Predicts Failure</h4>
        <div class="metric">&rho; = &minus;0.856</div>
        <p>Spearman rank correlation between context length and proof completion rate
          (p &lt; 10<sup>-10</sup>). Strong monotonic negative relationship confirmed
          across all lemma types.</p>
      </div>
      <div class="finding-card">
        <h4>2. Critical Threshold Identified</h4>
        <div class="metric">8,192 tokens</div>
        <p>The A5 key lemma completion drops from 100% at 2,048 tokens to 0% at 8,192 tokens.
          Generic lemmas show a later threshold near 12,288 tokens, confirming complexity interaction.</p>
      </div>
      <div class="finding-card">
        <h4>3. Subagent Strategy Works</h4>
        <div class="metric">+56.7 pp</div>
        <p>Subagent decomposition (capping context at 2,048 tokens) raises key lemma completion
          from 42.6% to 99.3%. The improvement is consistent across all five lemma types.</p>
      </div>
      <div class="finding-card">
        <h4>4. Severe Calibration Gap</h4>
        <div class="metric">0.919 gap</div>
        <p>Agent confidence stays above 0.919 while accuracy reaches 0.0 at 32,768 tokens.
          The model cannot self-diagnose context-induced failure, undermining confidence-based fallback strategies.</p>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer>
  <div class="container">
    KDD 2026 &middot; Research Track &middot; Do Long Lean Proof Contexts Cause Failure on the Putnam 2025 A5 Key Lemma?
  </div>
</footer>

<script>
// === Embedded Data ===
const contextLengths = [512, 1024, 2048, 4096, 8192, 12288, 16384, 24576, 32768];
const ctxLabels = ['512','1K','2K','4K','8K','12K','16K','24K','32K'];

const keyLemmaAccuracy = [0.5501, 0.53, 0.4694, 0.3556, 0.18, 0.0656, 0.0197, 0.0019, 0.0];
const genericAccuracy = [0.7727, 0.739, 0.6817, 0.5402, 0.2729, 0.0905, 0.0221, 0.0, 0.0];

const keyLemmaCompMono = [1.0, 1.0, 1.0, 0.8333, 0.0, 0.0, 0.0, 0.0, 0.0];
const genericCompMono = [1.0, 1.0, 1.0, 1.0, 0.9667, 0.1333, 0.0, 0.0, 0.0];
const keyLemmaCompSub = [1.0, 1.0, 1.0, 1.0, 0.9333, 1.0, 1.0, 1.0, 1.0];

const confidence = [0.9439, 0.9443, 0.9453, 0.943, 0.9402, 0.9389, 0.9362, 0.9314, 0.9189];
const actualAccuracy = [0.7151, 0.6805, 0.6295, 0.494, 0.236, 0.0808, 0.0219, 0.0009, 0.0];
const calibrationGap = [0.2288, 0.2638, 0.3158, 0.449, 0.7042, 0.8582, 0.9143, 0.9305, 0.9189];

const meanStalls = [0.3533, 0.4133, 0.4333, 0.5133, 0.9533, 1.62, 3.5133, 6.7533, 8.94];
const stallRate = [0.28, 0.3067, 0.3333, 0.3933, 0.58, 0.8, 0.9467, 1.0, 1.0];

const strategyData = {
  labels: ['A5 Key\nLemma','A5 Aux 1','A5 Aux 2','Generic\nAlgebra','Structural\nInduction'],
  monoCompletion: [0.4259, 0.5407, 0.5222, 0.5667, 0.4815],
  subCompletion: [0.9926, 1.0, 1.0, 1.0, 1.0],
  monoAccuracy: [0.2414, 0.3396, 0.3298, 0.3466, 0.3307],
  subAccuracy: [0.4731, 0.6936, 0.6814, 0.6958, 0.6702]
};

// === Chart Defaults ===
Chart.defaults.font.family = "'Segoe UI', system-ui, sans-serif";
Chart.defaults.font.size = 13;

const lineOpts = (yLabel) => ({
  responsive: true,
  maintainAspectRatio: false,
  interaction: { mode: 'index', intersect: false },
  plugins: { tooltip: { backgroundColor: 'rgba(26,35,126,0.92)', titleFont: {weight:'600'}, padding: 12, cornerRadius: 8 }},
  scales: {
    x: { title: { display: true, text: 'Context Length (tokens)', font: {weight:'600'} }, grid: {display:false} },
    y: { title: { display: true, text: yLabel, font: {weight:'600'} }, min: 0 }
  }
});

// Chart 1: Tactic Accuracy
new Chart(document.getElementById('chartAccuracy'), {
  type: 'line',
  data: {
    labels: ctxLabels,
    datasets: [
      { label: 'A5 Key Lemma', data: keyLemmaAccuracy, borderColor: '#1565c0', backgroundColor: 'rgba(21,101,192,0.08)', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#1565c0', tension: 0.3, fill: true },
      { label: 'Generic Algebra', data: genericAccuracy, borderColor: '#c62828', backgroundColor: 'rgba(198,40,40,0.06)', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#c62828', tension: 0.3, fill: true }
    ]
  },
  options: { ...lineOpts('Tactic Accuracy'), scales: { ...lineOpts('Tactic Accuracy').scales, y: { ...lineOpts('Tactic Accuracy').scales.y, max: 1.0 } } }
});

// Chart 2: Proof Completion
new Chart(document.getElementById('chartCompletion'), {
  type: 'line',
  data: {
    labels: ctxLabels,
    datasets: [
      { label: 'Key Lemma (Monolithic)', data: keyLemmaCompMono, borderColor: '#1565c0', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#1565c0', tension: 0.3 },
      { label: 'Generic Algebra (Monolithic)', data: genericCompMono, borderColor: '#c62828', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#c62828', tension: 0.3 },
      { label: 'Key Lemma (Subagent)', data: keyLemmaCompSub, borderColor: '#1565c0', borderWidth: 2.5, borderDash: [8,4], pointRadius: 5, pointBackgroundColor: '#1565c0', pointStyle: 'triangle', tension: 0.3 }
    ]
  },
  options: { ...lineOpts('Proof Completion Rate'), scales: { ...lineOpts('Proof Completion Rate').scales, y: { ...lineOpts('Proof Completion Rate').scales.y, max: 1.15 } } }
});

// Chart 3: Calibration
new Chart(document.getElementById('chartCalibration'), {
  type: 'line',
  data: {
    labels: ctxLabels,
    datasets: [
      { label: 'Agent Confidence', data: confidence, borderColor: '#2e7d32', backgroundColor: 'rgba(46,125,50,0.08)', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#2e7d32', tension: 0.3, fill: true },
      { label: 'Actual Accuracy', data: actualAccuracy, borderColor: '#6a1b9a', backgroundColor: 'rgba(106,27,154,0.08)', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#6a1b9a', tension: 0.3, fill: true },
      { label: 'Calibration Gap', data: calibrationGap, borderColor: '#e65100', borderDash: [6,3], borderWidth: 2, pointRadius: 4, pointBackgroundColor: '#e65100', tension: 0.3 }
    ]
  },
  options: { ...lineOpts('Score'), scales: { ...lineOpts('Score').scales, y: { ...lineOpts('Score').scales.y, max: 1.1 } } }
});

// Chart 4: Stalls
new Chart(document.getElementById('chartStalls'), {
  type: 'line',
  data: {
    labels: ctxLabels,
    datasets: [
      { label: 'Mean Stall Count', data: meanStalls, borderColor: '#e65100', backgroundColor: 'rgba(230,81,0,0.1)', borderWidth: 2.5, pointRadius: 5, pointBackgroundColor: '#e65100', tension: 0.3, fill: true, yAxisID: 'y' },
      { label: 'Stall Rate (fraction)', data: stallRate, borderColor: '#6a1b9a', borderWidth: 2, borderDash: [6,3], pointRadius: 4, pointBackgroundColor: '#6a1b9a', tension: 0.3, yAxisID: 'y1' }
    ]
  },
  options: {
    ...lineOpts('Mean Stall Count'),
    scales: {
      x: { title: { display: true, text: 'Context Length (tokens)', font: {weight:'600'} }, grid: {display:false} },
      y: { type: 'linear', position: 'left', title: { display: true, text: 'Mean Stall Count', font: {weight:'600'} }, min: 0, max: 10 },
      y1: { type: 'linear', position: 'right', title: { display: true, text: 'Stall Rate', font: {weight:'600'} }, min: 0, max: 1.1, grid: { drawOnChartArea: false } }
    }
  }
});

// Chart 5: Strategy Comparison
new Chart(document.getElementById('chartStrategy'), {
  type: 'bar',
  data: {
    labels: strategyData.labels,
    datasets: [
      { label: 'Monolithic Completion', data: strategyData.monoCompletion, backgroundColor: 'rgba(21,101,192,0.6)', borderColor: '#1565c0', borderWidth: 1 },
      { label: 'Subagent Completion', data: strategyData.subCompletion, backgroundColor: 'rgba(46,125,50,0.6)', borderColor: '#2e7d32', borderWidth: 1 },
      { label: 'Monolithic Accuracy', data: strategyData.monoAccuracy, backgroundColor: 'rgba(198,40,40,0.5)', borderColor: '#c62828', borderWidth: 1 },
      { label: 'Subagent Accuracy', data: strategyData.subAccuracy, backgroundColor: 'rgba(230,81,0,0.6)', borderColor: '#e65100', borderWidth: 1 }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: { tooltip: { backgroundColor: 'rgba(26,35,126,0.92)', padding: 12, cornerRadius: 8 } },
    scales: {
      x: { grid: {display:false} },
      y: { title: { display: true, text: 'Rate / Score', font: {weight:'600'} }, min: 0, max: 1.1 }
    }
  }
});

// === Tab Switching ===
function showTab(tabId) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
  document.getElementById(tabId).classList.add('active');
  event.target.classList.add('active');
  // Trigger chart resize for the newly visible tab
  setTimeout(() => window.dispatchEvent(new Event('resize')), 50);
}
</script>
</body>
</html>
