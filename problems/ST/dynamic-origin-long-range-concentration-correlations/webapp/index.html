<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Origin of Long-Range Concentration Correlations</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7"></script>
<style>
:root {
  --bg: #0f172a;
  --bg2: #1e293b;
  --bg3: #334155;
  --accent: #3b82f6;
  --accent2: #8b5cf6;
  --accent3: #06b6d4;
  --accent4: #f59e0b;
  --text: #e2e8f0;
  --text2: #94a3b8;
  --text3: #64748b;
  --success: #22c55e;
  --danger: #ef4444;
  --border: #475569;
  --card: #1e293b;
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth;scroll-padding-top:70px}
body{font-family:'Segoe UI',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.7}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}

nav{position:sticky;top:0;z-index:100;background:rgba(15,23,42,0.95);backdrop-filter:blur(12px);border-bottom:1px solid var(--border);padding:0}
.nav-inner{max-width:1280px;margin:0 auto;display:flex;align-items:center;gap:6px;padding:0 24px;overflow-x:auto;white-space:nowrap}
.nav-inner a{display:inline-block;padding:14px 14px;font-size:0.82rem;color:var(--text2);font-weight:500;letter-spacing:0.02em;border-bottom:2px solid transparent;transition:all .2s}
.nav-inner a:hover,.nav-inner a.active{color:var(--accent);text-decoration:none;border-bottom-color:var(--accent)}
.nav-brand{font-weight:700;color:var(--text)!important;font-size:0.9rem;margin-right:8px}

.hero{background:linear-gradient(135deg,#0f172a 0%,#1e1b4b 40%,#172554 100%);padding:80px 24px 60px;text-align:center;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(circle at 30% 50%,rgba(59,130,246,0.08) 0%,transparent 60%),radial-gradient(circle at 70% 40%,rgba(139,92,246,0.06) 0%,transparent 60%);pointer-events:none}
.hero-content{max-width:960px;margin:0 auto;position:relative}
.hero-badge{display:inline-block;background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);color:var(--accent);font-size:0.75rem;font-weight:600;padding:5px 14px;border-radius:20px;margin-bottom:20px;letter-spacing:0.05em;text-transform:uppercase}
.hero h1{font-size:clamp(1.6rem,4vw,2.6rem);font-weight:800;line-height:1.25;margin-bottom:16px;background:linear-gradient(135deg,#e2e8f0,#93c5fd);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{font-size:1.05rem;color:var(--text2);max-width:740px;margin:0 auto 28px;line-height:1.65}
.hero-meta{display:flex;justify-content:center;gap:28px;flex-wrap:wrap;font-size:0.82rem;color:var(--text3)}
.hero-meta span{display:flex;align-items:center;gap:6px}
.hero-meta .dot{width:6px;height:6px;border-radius:50%;display:inline-block}

.section{padding:60px 24px}
.section:nth-child(even){background:var(--bg2)}
.container{max-width:1200px;margin:0 auto}
.section-title{font-size:1.6rem;font-weight:700;margin-bottom:8px;color:var(--text)}
.section-subtitle{font-size:0.95rem;color:var(--text2);margin-bottom:32px;max-width:700px}

.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:28px;margin-bottom:24px}
.card h3{font-size:1.05rem;font-weight:700;margin-bottom:10px;color:var(--text)}
.card p{color:var(--text2);font-size:0.9rem}

.equation{background:rgba(59,130,246,0.06);border:1px solid rgba(59,130,246,0.15);border-radius:10px;padding:18px 24px;margin:16px 0;font-family:'Courier New',monospace;font-size:0.92rem;color:var(--accent3);overflow-x:auto;text-align:center;letter-spacing:0.02em}

.grid-2{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:24px}
.grid-3{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}
.grid-4{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}

.chart-container{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:24px}
.chart-container h3{font-size:1rem;font-weight:600;margin-bottom:4px}
.chart-container .chart-desc{font-size:0.82rem;color:var(--text3);margin-bottom:14px}
.chart-wrap{position:relative;height:380px}
.chart-wrap.tall{height:440px}
.chart-controls{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
.chart-controls button{background:var(--bg3);border:1px solid var(--border);color:var(--text2);padding:6px 14px;border-radius:6px;font-size:0.78rem;cursor:pointer;transition:all .15s}
.chart-controls button:hover{background:var(--accent);color:#fff;border-color:var(--accent)}
.chart-controls button.active{background:var(--accent);color:#fff;border-color:var(--accent)}

.stat-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:20px;text-align:center}
.stat-val{font-size:1.8rem;font-weight:800;margin-bottom:4px}
.stat-label{font-size:0.78rem;color:var(--text2);text-transform:uppercase;letter-spacing:0.05em}
.stat-sub{font-size:0.72rem;color:var(--text3);margin-top:4px}

.table-wrap{overflow-x:auto;border-radius:10px;border:1px solid var(--border)}
table{width:100%;border-collapse:collapse;font-size:0.85rem}
th{background:var(--bg3);color:var(--text);padding:12px 16px;text-align:left;font-weight:600;font-size:0.78rem;text-transform:uppercase;letter-spacing:0.04em;white-space:nowrap}
td{padding:10px 16px;border-top:1px solid var(--border);color:var(--text2)}
tr:hover td{background:rgba(59,130,246,0.04)}
.mono{font-family:'Courier New',monospace;font-size:0.82rem}

.finding{display:flex;gap:16px;margin-bottom:20px;padding:20px;background:var(--card);border:1px solid var(--border);border-radius:10px;border-left:3px solid var(--accent)}
.finding-num{flex-shrink:0;width:36px;height:36px;background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:0.9rem}
.finding h4{font-size:0.95rem;font-weight:700;margin-bottom:4px}
.finding p{font-size:0.85rem;color:var(--text2)}

.timeline{position:relative;padding-left:36px}
.timeline::before{content:'';position:absolute;left:14px;top:0;bottom:0;width:2px;background:linear-gradient(to bottom,var(--accent),var(--accent2),var(--accent3))}
.timeline-item{position:relative;margin-bottom:28px}
.timeline-item::before{content:'';position:absolute;left:-26px;top:4px;width:12px;height:12px;border-radius:50%;background:var(--accent);border:2px solid var(--bg)}
.timeline-item h4{font-size:0.9rem;font-weight:700;color:var(--accent);margin-bottom:4px}
.timeline-item p{font-size:0.85rem;color:var(--text2)}

.slider-group{display:flex;align-items:center;gap:12px;margin-bottom:12px}
.slider-group label{font-size:0.8rem;color:var(--text2);min-width:100px}
.slider-group input[type=range]{flex:1;accent-color:var(--accent);height:6px}
.slider-group .slider-val{font-family:'Courier New',monospace;font-size:0.82rem;color:var(--accent);min-width:70px;text-align:right}

footer{background:var(--bg);border-top:1px solid var(--border);padding:40px 24px;text-align:center;color:var(--text3);font-size:0.8rem}

@media(max-width:768px){
  .hero{padding:50px 16px 40px}
  .section{padding:40px 16px}
  .hero h1{font-size:1.5rem}
  .chart-wrap{height:300px}
  .grid-2,.grid-3,.grid-4{grid-template-columns:1fr}
  .nav-inner a{padding:12px 10px;font-size:0.75rem}
  .finding{flex-direction:column;gap:10px}
}
</style>
</head>
<body>

<nav>
<div class="nav-inner">
  <a href="#hero" class="nav-brand">FHD Correlations</a>
  <a href="#problem">Problem</a>
  <a href="#methods">Methods</a>
  <a href="#structure-factor">Structure Factor</a>
  <a href="#correlation-length">Correlation Length</a>
  <a href="#scaling">Scaling</a>
  <a href="#relaxation">Relaxation</a>
  <a href="#mechanism">Mechanism</a>
  <a href="#findings">Findings</a>
  <a href="#data">Data</a>
</div>
</nav>

<section class="hero" id="hero">
<div class="hero-content">
  
  <h1>Dynamic Origin of Long-Range Concentration Correlations in Nonequilibrium Diffusion</h1>
  <p class="hero-sub">A computational fluctuating hydrodynamics approach revealing how anomalous long-range correlations emerge hierarchically through mode-coupling between concentration and velocity fluctuations.</p>
  <div class="hero-meta">
    <span><span class="dot" style="background:var(--accent)"></span>Category: Statistical Mechanics</span>
    <span><span class="dot" style="background:var(--accent2)"></span>128 x 128 Lattice SPDE Simulation</span>
    <span><span class="dot" style="background:var(--success)"></span>S(q) ~ q<sup>-4</sup> Scaling Verified</span>
    <span><span class="dot" style="background:var(--accent4)"></span>Dynamical Scaling Collapse Confirmed</span>
  </div>
</div>
</section>

<section class="section" id="problem">
<div class="container">
  <h2 class="section-title">The Open Problem</h2>
  <p class="section-subtitle">An experimentally well-established phenomenon without a known dynamical explanation.</p>
  <div class="grid-2">
    <div class="card">
      <h3>Nonequilibrium Giant Fluctuations</h3>
      <p>When a macroscopic concentration gradient is imposed on a binary fluid mixture, anomalously large long-range correlations emerge in the concentration field. The structure factor diverges as S(q) ~ q<sup>-4</sup>, indicating power-law spatial correlations extending far beyond any molecular interaction range. While the steady-state properties are well understood, the <em>dynamical mechanism</em> by which these correlations emerge from an initially uncorrelated state remained an open problem.</p>
      <div class="equation">S_neq(q) = k_B T |grad c_0|^2 / (rho D nu (q^4 + q_c^4))</div>
    </div>
    <div class="card">
      <h3>Why Does This Matter?</h3>
      <p>Understanding the dynamical origin reveals the <em>mechanism</em> underlying the emergence of nonequilibrium order -- the process, not just the endpoint. It yields predictions for transient experiments where the gradient is suddenly imposed, and establishes the hierarchy of timescales governing the approach to the nonequilibrium steady state (NESS). This is item 5 in Maes' list of open problems in nonequilibrium statistical mechanics (arXiv:2601.16716, 2026).</p>
      <div class="equation">S_neq(q, t) = S_neq^ss(q) [1 - exp(-2 Gamma(q) t)]</div>
    </div>
  </div>

  <div class="grid-4" style="margin-top:24px">
    <div class="stat-card">
      <div class="stat-val" style="color:var(--accent)">q<sup>-4</sup></div>
      <div class="stat-label">Structure Factor Scaling</div>
      <div class="stat-sub">Nonequilibrium enhancement</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" style="color:var(--accent2)">sqrt(Dt)</div>
      <div class="stat-label">Correlation Length Growth</div>
      <div class="stat-sub">Diffusive spreading</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" style="color:var(--accent3)">Le=100</div>
      <div class="stat-label">Lewis Number</div>
      <div class="stat-sub">nu/D separation of scales</div>
    </div>
    <div class="stat-card">
      <div class="stat-val" style="color:var(--accent4)">5000</div>
      <div class="stat-label">Rayleigh Number</div>
      <div class="stat-sub">Below convective threshold</div>
    </div>
  </div>
</div>
</section>

<section class="section" id="methods">
<div class="container">
  <h2 class="section-title">Methods</h2>
  <p class="section-subtitle">Combined analytical and computational approach based on linearized fluctuating hydrodynamics.</p>
  <div class="grid-3">
    <div class="card" style="border-left:3px solid var(--accent)">
      <h3>Analytical Theory</h3>
      <p>Linearized FHD equations for concentration fluctuations coupled to velocity via the macroscopic gradient. Derive the transient structure factor as an exponential relaxation toward the NESS, with a q-dependent rate encoding the coupled dynamics.</p>
    </div>
    <div class="card" style="border-left:3px solid var(--accent2)">
      <h3>SPDE Simulation</h3>
      <p>Euler-Maruyama integration of the coupled concentration-velocity system in Fourier space on a 128x128 periodic lattice. 5000 time steps with adaptive dt ~ 9.27x10<sup>-4</sup>, covering ~0.33 tau_D of the relaxation.</p>
    </div>
    <div class="card" style="border-left:3px solid var(--accent3)">
      <h3>Correlation Analysis</h3>
      <p>Radially averaged power spectra, power-law fitting in log-log space, dynamical scaling collapse test, and real-space correlation function extraction via the Wiener-Khinchin theorem.</p>
    </div>
  </div>

  <h3 style="margin:28px 0 16px;font-size:1rem">Simulation Parameters</h3>
  <div class="table-wrap">
    <table>
      <thead><tr><th>Parameter</th><th>Symbol</th><th>Value</th><th>Description</th></tr></thead>
      <tbody id="paramsTable"></tbody>
    </table>
  </div>
</div>
</section>

<section class="section" id="structure-factor">
<div class="container">
  <h2 class="section-title">Transient Structure Factor S(q, t)</h2>
  <p class="section-subtitle">Watch the q<sup>-4</sup> nonequilibrium enhancement build up hierarchically from high-q to low-q modes.</p>

  <div class="chart-container">
    <h3>Structure Factor Evolution (Log-Log)</h3>
    <p class="chart-desc">Select time snapshots to see how S(q) evolves from flat equilibrium toward the q<sup>-4</sup> NESS envelope. High-q modes (short wavelengths) saturate first.</p>
    <div class="chart-controls" id="sq-controls"></div>
    <div class="chart-wrap tall"><canvas id="chartSQ"></canvas></div>
  </div>

  <div class="chart-container">
    <h3>Power-Law Exponent Evolution</h3>
    <p class="chart-desc">The fitted exponent alpha in S(q) ~ q^alpha evolves from ~0 (flat equilibrium) toward -4 (NESS). At the final simulation time (~0.33 tau_D), alpha ~ -1.96.</p>
    <div class="chart-wrap"><canvas id="chartExponent"></canvas></div>
  </div>
</div>
</section>

<section class="section" id="correlation-length">
<div class="container">
  <h2 class="section-title">Growing Correlation Length xi(t)</h2>
  <p class="section-subtitle">The characteristic spatial extent of concentration correlations grows diffusively as sqrt(Dt) at early times, saturating at 1/q_c.</p>

  <div class="grid-2">
    <div class="chart-container">
      <h3>Correlation Length vs. Time</h3>
      <p class="chart-desc">Comparison of numerical (FHD) and analytical predictions. The green dashed reference shows the sqrt(Dt) diffusive scaling.</p>
      <div class="chart-wrap"><canvas id="chartXi"></canvas></div>
    </div>
    <div>
      <div class="card" style="margin-bottom:16px">
        <h3>Analytical Formula</h3>
        <div class="equation">xi(t) = (1/q_c) sqrt(1 - exp(-q_c^2 D t))</div>
        <p style="margin-top:10px">At early times (Dt much less than 1/q_c^2): xi(t) ~ sqrt(Dt)<br>
        At late times: xi approaches 1/q_c = 0.119</p>
      </div>
      <div class="grid-2" style="gap:12px">
        <div class="stat-card">
          <div class="stat-val" style="color:var(--accent);font-size:1.3rem">0.023</div>
          <div class="stat-label">xi Numerical (Final)</div>
        </div>
        <div class="stat-card">
          <div class="stat-val" style="color:var(--danger);font-size:1.3rem">0.063</div>
          <div class="stat-label">xi Analytical (Final)</div>
        </div>
        <div class="stat-card">
          <div class="stat-val" style="color:var(--text3);font-size:1.3rem">0.119</div>
          <div class="stat-label">NESS Value 1/q_c</div>
        </div>
        <div class="stat-card">
          <div class="stat-val" style="color:var(--accent4);font-size:1.3rem">14.1 s</div>
          <div class="stat-label">tau_D = 1/(D q_c^2)</div>
        </div>
      </div>
    </div>
  </div>
</div>
</section>

<section class="section" id="scaling">
<div class="container">
  <h2 class="section-title">Dynamical Scaling Collapse</h2>
  <p class="section-subtitle">The normalized S_neq(q,t)/S_neq^ss(q) collapses onto a universal function of the scaling variable q^2 Dt.</p>

  <div class="grid-2">
    <div class="chart-container">
      <h3>Scaling Collapse: Simulation Data vs. Theory</h3>
      <p class="chart-desc">Each point is one (q, t) pair from the simulation. The red curve is the universal function f(x) = 1 - e^(-2x).</p>
      <div class="chart-wrap tall"><canvas id="chartScaling"></canvas></div>
    </div>
    <div>
      <div class="card">
        <h3>Universal Scaling Function</h3>
        <div class="equation">f(x) = 1 - e^(-2x), where x = q^2 D t</div>
        <p style="margin-top:10px">This dynamical scaling collapse is a key prediction. The data follow this universal function with an RMS deviation of <strong>0.27</strong>. Scatter is larger at small x (early times, small q) where stochastic fluctuations dominate.</p>
      </div>
      <div class="stat-card" style="margin-top:16px">
        <div class="stat-val" style="color:var(--accent4)">0.273</div>
        <div class="stat-label">RMS Deviation from Universal Curve</div>
        <div class="stat-sub">Scatter dominated by stochastic noise at small q^2 Dt</div>
      </div>
      <div class="card" style="margin-top:16px">
        <h3>Interactive Explorer</h3>
        <p>Use the slider to filter data points by minimum scaling variable value, showing how the collapse improves at larger q^2 Dt.</p>
        <div class="slider-group" style="margin-top:12px">
          <label>Min q^2 Dt:</label>
          <input type="range" id="scalingSlider" min="0" max="3" step="0.1" value="0">
          <span class="slider-val" id="scalingSliderVal">0.0</span>
        </div>
        <div style="font-size:0.8rem;color:var(--text3);margin-top:4px" id="scalingInfo">Showing all data points</div>
      </div>
    </div>
  </div>
</div>
</section>

<section class="section" id="relaxation">
<div class="container">
  <h2 class="section-title">Relaxation Rate Spectrum Gamma(q)</h2>
  <p class="section-subtitle">The q-dependent rate controlling how fast each wavevector mode approaches its NESS value.</p>

  <div class="grid-2">
    <div class="chart-container">
      <h3>Relaxation Rate vs. Wavevector</h3>
      <p class="chart-desc">At large q, Gamma ~ Dq^2 (purely diffusive). Near q_c, buoyancy coupling slows the relaxation.</p>
      <div class="chart-wrap"><canvas id="chartGamma"></canvas></div>
    </div>
    <div class="chart-container">
      <h3>Mode-by-Mode Buildup Curves</h3>
      <p class="chart-desc">S_neq(q,t)/S_neq^ss(q) for selected wavevectors. High-q modes saturate first (hierarchical buildup).</p>
      <div class="chart-controls" id="mode-controls"></div>
      <div class="chart-wrap"><canvas id="chartModes"></canvas></div>
    </div>
  </div>
</div>
</section>

<section class="section" id="mechanism">
<div class="container">
  <h2 class="section-title">The Dynamical Mechanism</h2>
  <p class="section-subtitle">How long-range concentration correlations emerge through mode-coupling.</p>

  <div class="grid-2">
    <div>
      <div class="timeline">
        <div class="timeline-item">
          <h4>Step 1: Gradient Imposition (t = 0)</h4>
          <p>The system starts at thermal equilibrium with short-range correlations only. A macroscopic concentration gradient is suddenly applied across the fluid layer.</p>
        </div>
        <div class="timeline-item">
          <h4>Step 2: Mode-Coupling Activation</h4>
          <p>The gradient couples concentration fluctuations to velocity fluctuations through the advective term. Each wavevector mode q begins developing nonequilibrium enhancement at rate Gamma(q).</p>
        </div>
        <div class="timeline-item">
          <h4>Step 3: Hierarchical Buildup (0 &lt; t &lt; tau_D)</h4>
          <p>Short-wavelength (large q) modes reach their NESS values first on diffusive timescales ~1/(Dq^2). The correlation length xi(t) ~ sqrt(Dt) grows as progressively longer-wavelength modes are populated.</p>
        </div>
        <div class="timeline-item">
          <h4>Step 4: NESS Approach (t toward infinity)</h4>
          <p>All modes saturate. The full q^-4 spectrum is established. The correlation length reaches its maximum value 1/q_c, set by the balance of buoyancy and diffusion.</p>
        </div>
      </div>
    </div>
    <div>
      <div class="card">
        <h3>The Core Mechanism</h3>
        <p>The fundamental mechanism is the time-dependent mode-coupling between concentration and velocity fluctuations, mediated by the macroscopic gradient. The long-range character of the correlations is <em>inherited</em> from the long-range nature of hydrodynamic interactions, encoded in the Stokes Green's function G(q) ~ 1/q^2 (the Oseen tensor).</p>
        <div class="equation">v_z(q) = G(q) [beta_s g delta_c(q) + f_z(q)]</div>
        <div class="equation">G(q) = 1 / (rho nu q^2) -- Stokes Green's function</div>
        <p style="margin-top:12px">The advective coupling (grad c_0) * v_z in the concentration equation transfers the 1/q^2 range of G(q) into the concentration fluctuations, producing the q^-4 enhancement in S(q). This transfer occurs progressively from fast (high-q) to slow (low-q) modes, creating the hierarchical buildup.</p>
      </div>
      <div class="card">
        <h3>Linearized FHD Equations</h3>
        <div class="equation">d(delta_c)/dt = -Dq^2 delta_c + (grad c_0) * v_z + xi_c</div>
        <div class="equation">v_z(q) = G(q) [beta_s g delta_c(q) + f_z(q)]</div>
        <p style="margin-top:8px;font-size:0.82rem;color:var(--text3)">where xi_c and f_z are stochastic noise terms satisfying fluctuation-dissipation relations.</p>
      </div>
    </div>
  </div>
</div>
</section>

<section class="section" id="findings">
<div class="container">
  <h2 class="section-title">Key Findings</h2>
  <p class="section-subtitle">Four main contributions from this combined analytical and computational study.</p>

  <div class="finding">
    <div class="finding-num">1</div>
    <div>
      <h4>Closed-Form Transient Structure Factor</h4>
      <p>S_neq(q, t) = S_neq^ss(q) [1 - exp(-2 Gamma(q) t)] provides the complete transient from equilibrium to NESS, governed by a q-dependent relaxation rate Gamma(q) encoding the coupled concentration-velocity dynamics.</p>
    </div>
  </div>

  <div class="finding">
    <div class="finding-num">2</div>
    <div>
      <h4>Hierarchical Buildup of Correlations</h4>
      <p>Short-wavelength modes equilibrate on diffusive timescales ~1/(Dq^2) before long-wavelength modes. This is confirmed by SPDE simulations showing the power-law exponent evolving from ~0 to -1.96 (toward -4.0 at NESS).</p>
    </div>
  </div>

  <div class="finding">
    <div class="finding-num">3</div>
    <div>
      <h4>Dynamical Scaling Collapse</h4>
      <p>The normalized structure factor S_neq(q,t)/S_neq^ss(q) collapses onto the universal function f(q^2 Dt) = 1 - exp(-2 q^2 Dt), verified by simulation with RMS deviation of 0.27.</p>
    </div>
  </div>

  <div class="finding">
    <div class="finding-num">4</div>
    <div>
      <h4>Mode-Coupling Mechanism Identified</h4>
      <p>The fundamental mechanism is the time-dependent mode-coupling between concentration and velocity fluctuations, mediated by the macroscopic gradient, which transfers the long-range character of hydrodynamic interactions (Oseen tensor G(q) ~ 1/q^2) into concentration correlations.</p>
    </div>
  </div>
</div>
</section>

<section class="section" id="data">
<div class="container">
  <h2 class="section-title">Simulation Data</h2>
  <p class="section-subtitle">Detailed numerical results from the SPDE simulation and analytical predictions.</p>

  <div class="grid-2">
    <div>
      <h3 style="font-size:1rem;margin-bottom:12px">Summary of Key Results</h3>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Quantity</th><th>Value</th><th>Expected</th></tr></thead>
          <tbody id="summaryTable"></tbody>
        </table>
      </div>
    </div>
    <div>
      <h3 style="font-size:1rem;margin-bottom:12px">Time Evolution Data</h3>
      <div class="table-wrap" style="max-height:400px;overflow-y:auto">
        <table>
          <thead><tr><th>t</th><th>xi_num</th><th>xi_ana</th><th>alpha</th></tr></thead>
          <tbody id="timeTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <h3 style="font-size:1rem;margin:28px 0 12px">Structure Factor S(q) at Selected Times</h3>
  <div class="table-wrap" style="max-height:400px;overflow-y:auto">
    <table>
      <thead><tr><th>q</th><th>t=0.001</th><th>t=0.65</th><th>t=1.30</th><th>t=1.95</th><th>t=2.60</th><th>t=3.25</th><th>t=3.90</th><th>t=4.64</th><th>S_ss(ana)</th></tr></thead>
      <tbody id="sqTable"></tbody>
    </table>
  </div>
</div>
</section>

<footer>
  <p>Dynamic Origin of Long-Range Concentration Correlations in Nonequilibrium Diffusion</p>
  <p style="margin-top:6px"> | Based on open problem from Maes, arXiv:2601.16716 (2026)</p>
  <p style="margin-top:6px">Computational Fluctuating Hydrodynamics Approach | 128x128 Lattice SPDE Simulation</p>
</footer>

<script>
// ===== EMBEDDED DATA =====
var DATA = {
  times: [0.000927,0.093653,0.186379,0.279105,0.371831,0.464557,0.557283,0.650009,0.742735,0.835461,0.928187,1.020913,1.113639,1.206365,1.299091,1.391817,1.484543,1.577269,1.669995,1.762721,1.855447,1.948173,2.040899,2.133625,2.226351,2.319077,2.411803,2.504529,2.597255,2.689981,2.782707,2.875433,2.968159,3.060885,3.153611,3.246337,3.339063,3.431789,3.524515,3.617241,3.709967,3.802693,3.895419,3.988145,4.080871,4.173597,4.266323,4.359049,4.451775,4.544501,4.6363],
  qBins: [6.2586,12.4927,18.7268,24.9609,31.195,37.4291,43.6632,49.8973,56.1314,62.3655,68.5996,74.8337,81.0678,87.3019,93.536,99.7701,106.0042,112.2383,118.4724,124.7065,130.9406,137.1747,143.4088,149.6429,155.877,162.1111,168.3452,174.5793,180.8134,187.0475,193.2816,199.5157,205.7498,211.9839,218.218,224.4521,230.6862,236.9203,243.1544,249.3885,255.6226,261.8567,268.0908,274.3249,280.559,286.793,293.0271,299.2612,305.4953,311.7294,317.9635,324.1976,330.4317,336.6658,342.8999,349.134,355.3681,361.6022,367.8363,374.0704,380.3045,386.5386,392.7727,399.0068],
  sqSnapshots: {
    0: [9.66135e-05,0.0001146714,9.5333e-05,0.0001048309,0.0001060041,9.14287e-05,0.0001232836,0.0001343325,0.0001279246,0.0001064899,0.0001177064,0.0001163211,9.95338e-05,0.0001072309,0.0001000232,0.0001132842,9.59815e-05,9.39921e-05,0.000102918,0.0001043908,9.53947e-05,0.0001130794,0.0001095051,0.0001058627,8.97617e-05,9.91883e-05,0.0001000276,0.0001072014,9.51575e-05,0.000100821,9.32142e-05,0.0001022365,0.0001097703,0.0001062692,8.86936e-05,9.80877e-05,9.78461e-05,9.42153e-05,9.4081e-05,9.32896e-05,9.14188e-05,9.70551e-05,8.08052e-05,9.88668e-05,8.02294e-05,9.49205e-05,8.91317e-05,9.25282e-05,0.0001010787,8.83693e-05,8.68214e-05,9.53262e-05,8.66273e-05,8.67304e-05,8.5835e-05,8.14525e-05,7.64193e-05,8.49055e-05,8.30162e-05,8.46035e-05,8.19651e-05,8.32171e-05,8.02489e-05,8.20978e-05],
    7: [0.0055322672,0.004333711,0.0032757027,0.0034200545,0.00231696,0.0020794844,0.0018556074,0.0011245038,0.0009700757,0.0008506278,0.000747541,0.0005556755,0.0004303343,0.0004307188,0.0003935844,0.0003735178,0.0002877523,0.0002608746,0.0002448734,0.0002210498,0.0002154656,0.0001669846,0.000140512,0.0001313843,0.0001262334,0.00012671,0.0001088863,0.0001115348,9.75255e-05,0.0001016655,9.25775e-05,8.15164e-05,7.74583e-05,7.36226e-05,6.66644e-05,6.20919e-05,6.31784e-05,5.96962e-05,5.81144e-05,5.12712e-05,5.09338e-05,5.30001e-05,3.94763e-05,4.5424e-05,4.37332e-05,4.01021e-05,4.05272e-05,3.66511e-05,3.95447e-05,3.45038e-05,3.37033e-05,3.75104e-05,3.09115e-05,3.19949e-05,3.06831e-05,2.7387e-05,2.86316e-05,2.39588e-05,2.6503e-05,2.75087e-05,2.32625e-05,2.39205e-05,2.21374e-05,2.11546e-05],
    14: [0.0104802153,0.0040908712,0.0049383018,0.0054567694,0.0028623358,0.0021541195,0.0017797302,0.0009752625,0.000945035,0.0007908645,0.0005385054,0.000544175,0.0004255422,0.0004215776,0.0003561063,0.0003365477,0.0002827008,0.000254511,0.0002670055,0.0002113941,0.0002090667,0.0001564573,0.000165512,0.0001493085,0.0001462979,0.0001289787,0.0001400916,0.000118316,9.8544e-05,9.06836e-05,8.82248e-05,9.20531e-05,8.13851e-05,6.88803e-05,7.82173e-05,6.79169e-05,5.98016e-05,5.90517e-05,5.64186e-05,4.8861e-05,5.19632e-05,4.94172e-05,4.44871e-05,4.53553e-05,4.2567e-05,4.18137e-05,4.00393e-05,3.54356e-05,3.41478e-05,3.5716e-05,3.31203e-05,3.42438e-05,2.8061e-05,2.73451e-05,2.7629e-05,2.77787e-05,2.59731e-05,2.5959e-05,2.76806e-05,2.65468e-05,2.65114e-05,2.36101e-05,2.21615e-05,2.13564e-05],
    21: [0.0151202526,0.0093298209,0.0046762234,0.0063519011,0.0032848676,0.0031474307,0.0014477503,0.0016299426,0.0010837519,0.000820848,0.000602408,0.0005975165,0.000473331,0.0003695218,0.0003809438,0.0003470655,0.0003475939,0.0002532916,0.0002204846,0.0002335322,0.000170334,0.0001808377,0.0001871302,0.0001359457,0.000136027,0.0001312839,0.0001254334,9.50198e-05,8.57119e-05,9.35455e-05,7.49871e-05,8.42623e-05,7.24044e-05,8.44666e-05,6.3677e-05,6.76127e-05,6.10467e-05,5.80672e-05,5.74311e-05,5.66707e-05,5.20497e-05,5.0938e-05,5.38464e-05,4.37748e-05,4.53113e-05,4.18192e-05,4.0226e-05,3.95698e-05,3.62493e-05,4.01436e-05,3.69933e-05,3.54055e-05,3.00435e-05,2.78603e-05,2.82035e-05,2.60293e-05,2.44461e-05,2.63094e-05,2.65399e-05,2.67192e-05,2.6039e-05,2.6112e-05,2.57023e-05,2.22936e-05],
    28: [0.0160574993,0.0121938312,0.0055059624,0.0046394082,0.0034732959,0.0025268386,0.0014651669,0.0011771112,0.0012973581,0.0009457866,0.000941599,0.0006210968,0.0005314852,0.000365013,0.0003834731,0.0003714579,0.0002193826,0.0002239226,0.0002798435,0.0002208886,0.0001971304,0.0001798533,0.0001786743,0.0001606652,0.0001329004,0.0001203637,0.0001210974,0.0001211612,0.0001068553,9.59406e-05,8.68787e-05,8.5896e-05,7.32732e-05,7.16383e-05,6.77088e-05,7.43764e-05,6.56307e-05,5.44889e-05,5.93295e-05,5.00201e-05,5.37659e-05,4.91558e-05,4.74577e-05,4.4317e-05,4.16912e-05,3.82332e-05,4.28454e-05,3.80138e-05,3.59381e-05,3.41114e-05,3.50137e-05,3.00095e-05,3.17744e-05,2.81089e-05,2.99324e-05,2.68787e-05,2.79889e-05,2.45511e-05,2.64133e-05,2.66589e-05,2.46783e-05,2.35123e-05,2.20357e-05,2.19377e-05],
    35: [0.0106394976,0.0148455301,0.0071219837,0.0040459784,0.0026985834,0.0026887066,0.0011920607,0.0010814078,0.0010900252,0.0009697654,0.000718342,0.0006158759,0.0004859002,0.0004838344,0.000390531,0.0003280254,0.0002883592,0.0002273757,0.0002753003,0.0002031698,0.0001911697,0.0001952102,0.0001411377,0.000124737,0.0001504361,0.0001377325,0.0001016174,0.0001083181,0.0001066397,9.14604e-05,0.000102752,9.13313e-05,7.46047e-05,7.15189e-05,7.05134e-05,6.71391e-05,6.34298e-05,6.37332e-05,5.97786e-05,5.84191e-05,4.86863e-05,4.88945e-05,4.60753e-05,4.60463e-05,4.36355e-05,3.92985e-05,3.99913e-05,3.92117e-05,3.94889e-05,3.5497e-05,3.30498e-05,2.99492e-05,3.08975e-05,3.11884e-05,2.96683e-05,3.11049e-05,2.91662e-05,2.66001e-05,2.36811e-05,2.26164e-05,2.51494e-05,2.55394e-05,2.16796e-05,2.35012e-05],
    42: [0.0157391526,0.0180656942,0.0069152788,0.0035657976,0.0037058442,0.0016339359,0.0015320094,0.0013459198,0.0009680825,0.0008521031,0.0007221598,0.0005046292,0.0004628121,0.0004230753,0.0003631173,0.000313494,0.0003514727,0.0002701785,0.0002076964,0.0001699355,0.0001532997,0.0001802632,0.0001533559,0.000140957,0.0001263728,0.0001234387,0.0001048583,0.0001013665,0.0001122431,9.52927e-05,9.21137e-05,8.14489e-05,8.13149e-05,7.87429e-05,6.25568e-05,6.28491e-05,6.57526e-05,6.26064e-05,5.33244e-05,5.19414e-05,5.07014e-05,4.52809e-05,4.81714e-05,4.25832e-05,4.58565e-05,4.40146e-05,4.13534e-05,3.75914e-05,3.47888e-05,3.80832e-05,3.58834e-05,3.2805e-05,3.07578e-05,2.99796e-05,3.08084e-05,2.76174e-05,2.68054e-05,2.5743e-05,2.51638e-05,2.65008e-05,2.37591e-05,2.30614e-05,2.35368e-05,2.14105e-05],
    50: [0.0205518352,0.0183722537,0.0087856316,0.0044433489,0.0039638433,0.0021775252,0.0015710009,0.0013197511,0.001067772,0.000802679,0.0006935556,0.000497839,0.0005716999,0.0005277557,0.0003289051,0.0003059851,0.0002931694,0.0002815045,0.0001997443,0.0002082331,0.0001728171,0.0001957673,0.000167609,0.0001485492,0.0001392666,0.0001196314,0.0001173221,0.0001002904,0.0001116265,0.000104972,9.73244e-05,8.43615e-05,7.28026e-05,7.272e-05,7.81793e-05,6.24988e-05,6.43206e-05,6.09917e-05,5.30618e-05,5.36144e-05,4.98812e-05,5.35312e-05,5.03146e-05,4.39996e-05,4.02148e-05,4.33982e-05,4.21048e-05,3.67797e-05,3.46139e-05,3.42523e-05,3.30752e-05,3.20335e-05,3.04351e-05,3.16031e-05,2.87161e-05,2.76857e-05,2.86084e-05,2.35393e-05,2.71279e-05,2.4819e-05,2.4857e-05,2.31926e-05,2.50359e-05,2.26028e-05]
  },
  xiNum: [0.00181034,0.00893197,0.01112555,0.01257854,0.013678,0.01456461,0.01530722,0.01594521,0.01650344,0.01699865,0.01744274,0.01784447,0.01821051,0.01854603,0.01885517,0.01914125,0.01940703,0.01965477,0.01988639,0.02010353,0.02030758,0.02049973,0.02068105,0.02085245,0.02101473,0.02116861,0.02131472,0.02145365,0.02158589,0.0217119,0.0218321,0.02194688,0.02205656,0.02216146,0.02226187,0.02235806,0.02245026,0.02253869,0.02262356,0.02270507,0.02278338,0.02285866,0.02293106,0.02300073,0.0230678,0.02313239,0.02319461,0.02325459,0.02331241,0.02336818,0.02342145],
  xiAna: [0.00096293,0.00966146,0.01360722,0.01662435,0.01915687,0.02137779,0.02337618,0.02520511,0.02689922,0.02848267,0.02997304,0.03138367,0.03272492,0.03400506,0.03523081,0.03640771,0.03754039,0.03863281,0.03968832,0.04070984,0.04169992,0.04266077,0.04359439,0.04450251,0.0453867,0.04624839,0.04708882,0.04790918,0.04871049,0.04949371,0.05025974,0.05100937,0.05174335,0.05246236,0.05316705,0.053858,0.05453577,0.05520087,0.05585378,0.05649495,0.05712481,0.05774375,0.05835214,0.05895034,0.05953868,0.06011747,0.06068701,0.06124759,0.06179947,0.06234291,0.06287283],
  exponent: [-0.042358,-0.995765,-1.316562,-1.497014,-1.637621,-1.65433,-1.762566,-1.759433,-1.758965,-1.745684,-1.770973,-1.807293,-1.821163,-1.836988,-1.845193,-1.914601,-1.909207,-1.922702,-1.930595,-1.943317,-1.949555,-1.95868,-1.949336,-1.936927,-1.948413,-1.886711,-1.927428,-1.941895,-1.905226,-1.849435,-1.823659,-1.862967,-1.868874,-1.869316,-1.917603,-1.88992,-1.884253,-1.901444,-1.912065,-1.927283,-1.930611,-1.89213,-1.902485,-1.91505,-1.922457,-1.927008,-1.948603,-1.928288,-1.943216,-1.973035,-1.958413],
  sSsAna: [0.0038259437,0.0008515744,0.000195333,6.35826e-05,2.6261e-05,1.27056e-05,6.8688e-06,4.0298e-06,2.5171e-06,1.652e-06,1.1286e-06,7.97e-07,5.788e-07,4.303e-07,3.266e-07,2.523e-07,1.98e-07,1.575e-07,1.269e-07,1.034e-07,8.5e-08,7.06e-08,5.91e-08,4.99e-08,4.23e-08,3.62e-08,3.11e-08,2.69e-08,2.34e-08,2.04e-08,1.79e-08,1.58e-08,1.4e-08,1.24e-08,1.1e-08,9.9e-09,8.8e-09,7.9e-09,7.2e-09,6.5e-09,5.9e-09,5.3e-09,4.8e-09,4.4e-09,4e-09,3.7e-09,3.4e-09,3.1e-09,2.9e-09,2.6e-09,2.4e-09,2.3e-09,2.1e-09,1.9e-09,1.8e-09,1.7e-09,1.6e-09,1.5e-09,1.4e-09,1.3e-09,1.2e-09,1.1e-09,1.1e-09,1e-09],
  params: {D:0.001,nu:0.1,grad_c0:5.0,beta_s:0.01,g:10.0,kBT:1e-4,rho:1.0,L:1.0,Le:100,Ra:5000,q_c:8.409,NESS_xi:0.119,tau_D:14.1}
};

// ===== CHART DEFAULTS =====
Chart.defaults.color = '#94a3b8';
Chart.defaults.borderColor = 'rgba(71,85,105,0.3)';
Chart.defaults.font.family = "'Segoe UI',system-ui,sans-serif";
Chart.defaults.font.size = 11;
Chart.defaults.plugins.legend.labels.usePointStyle = true;
Chart.defaults.plugins.legend.labels.pointStyleWidth = 8;

var COLORS = ['#3b82f6','#8b5cf6','#06b6d4','#22c55e','#f59e0b','#ef4444','#ec4899','#f97316'];

// ===== SAFE DOM HELPERS =====
function createCell(text, isMono) {
  var td = document.createElement('td');
  td.textContent = text;
  if (isMono) td.className = 'mono';
  return td;
}

function createRow(cells) {
  var tr = document.createElement('tr');
  cells.forEach(function(c) { tr.appendChild(c); });
  return tr;
}

// ===== 1. STRUCTURE FACTOR CHART =====
var sqIndices = [0, 7, 14, 21, 28, 35, 42, 50];
var sqLabels = ['t=0.001','t=0.65','t=1.30','t=1.95','t=2.60','t=3.25','t=3.90','t=4.64'];
var sqVisible = [false,false,false,false,true,true,true,true];
var chartSQ = null;

function buildSQChart() {
  var ctx = document.getElementById('chartSQ').getContext('2d');
  var datasets = [];
  sqIndices.forEach(function(si, i) {
    var pts = [];
    var sq = DATA.sqSnapshots[si];
    DATA.qBins.forEach(function(q, j) {
      if (q > 0 && sq[j] > 0) pts.push({x: q, y: sq[j]});
    });
    datasets.push({
      label: sqLabels[i],
      data: pts,
      borderColor: COLORS[i],
      backgroundColor: COLORS[i] + '20',
      borderWidth: 2,
      pointRadius: 0,
      hidden: !sqVisible[i],
      tension: 0.3,
      showLine: true
    });
  });

  var nessPts = [];
  DATA.qBins.forEach(function(q, j) {
    if (DATA.sSsAna[j] > 0) nessPts.push({x: q, y: DATA.sSsAna[j]});
  });
  datasets.push({
    label: 'NESS (analytical)',
    data: nessPts,
    borderColor: '#e2e8f0',
    borderWidth: 2,
    borderDash: [8, 4],
    pointRadius: 0,
    tension: 0.3,
    showLine: true
  });

  var refPts = [];
  for (var lq = Math.log10(8); lq <= Math.log10(300); lq += 0.05) {
    var q = Math.pow(10, lq);
    refPts.push({x: q, y: 5e4 * Math.pow(q, -4)});
  }
  datasets.push({
    label: 'q^-4 reference',
    data: refPts,
    borderColor: '#ef444480',
    borderWidth: 1.5,
    borderDash: [4, 4],
    pointRadius: 0,
    showLine: true
  });

  chartSQ = new Chart(ctx, {
    type: 'scatter',
    data: { datasets: datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'nearest', intersect: false },
      scales: {
        x: { type: 'logarithmic', title: { display: true, text: 'Wavevector q' }, min: 5, max: 500 },
        y: { type: 'logarithmic', title: { display: true, text: 'S(q, t)' }, min: 1e-5, max: 0.05 }
      },
      plugins: {
        legend: { position: 'top', labels: { padding: 10, font: { size: 10 } } },
        tooltip: {
          callbacks: {
            label: function(c) { return c.dataset.label + ': q=' + c.parsed.x.toFixed(1) + ', S=' + c.parsed.y.toExponential(2); }
          }
        }
      }
    }
  });
}

// SQ controls
(function() {
  var sqCtrl = document.getElementById('sq-controls');
  sqLabels.forEach(function(label, i) {
    var btn = document.createElement('button');
    btn.textContent = label;
    btn.className = sqVisible[i] ? 'active' : '';
    btn.addEventListener('click', function() {
      sqVisible[i] = !sqVisible[i];
      btn.className = sqVisible[i] ? 'active' : '';
      chartSQ.data.datasets[i].hidden = !sqVisible[i];
      chartSQ.update();
    });
    sqCtrl.appendChild(btn);
  });
  var btnAll = document.createElement('button');
  btnAll.textContent = 'Show All';
  btnAll.addEventListener('click', function() {
    sqVisible = sqVisible.map(function() { return true; });
    var buttons = sqCtrl.querySelectorAll('button');
    for (var k = 0; k < buttons.length - 1; k++) buttons[k].className = 'active';
    sqIndices.forEach(function(_, i) { chartSQ.data.datasets[i].hidden = false; });
    chartSQ.update();
  });
  sqCtrl.appendChild(btnAll);
})();

// ===== 2. EXPONENT CHART =====
function buildExponentChart() {
  var ctx = document.getElementById('chartExponent').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: DATA.times.map(function(t) { return t.toFixed(2); }),
      datasets: [
        {
          label: 'Fitted exponent alpha',
          data: DATA.exponent,
          borderColor: '#3b82f6',
          backgroundColor: '#3b82f620',
          fill: true,
          borderWidth: 2,
          pointRadius: 2,
          tension: 0.3
        },
        {
          label: 'Expected NESS (alpha = -4)',
          data: DATA.times.map(function() { return -4; }),
          borderColor: '#ef4444',
          borderWidth: 1.5,
          borderDash: [8, 4],
          pointRadius: 0
        },
        {
          label: 'Final measured (alpha = -1.96)',
          data: DATA.times.map(function() { return -1.958; }),
          borderColor: '#f59e0b',
          borderWidth: 1,
          borderDash: [4, 4],
          pointRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { title: { display: true, text: 'Time t' }, ticks: { maxTicksLimit: 10 } },
        y: { title: { display: true, text: 'Exponent alpha' }, min: -4.5, max: 0.5 }
      },
      plugins: { legend: { position: 'top' } }
    }
  });
}

// ===== 3. CORRELATION LENGTH CHART =====
function buildXiChart() {
  var ctx = document.getElementById('chartXi').getContext('2d');
  var sqrtDt = DATA.times.map(function(t) { return Math.sqrt(DATA.params.D * t); });
  new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [
        {
          label: 'Numerical (FHD)',
          data: DATA.times.map(function(t, i) { return {x: t, y: DATA.xiNum[i]}; }),
          borderColor: '#3b82f6',
          backgroundColor: '#3b82f640',
          showLine: true,
          borderWidth: 2,
          pointRadius: 2,
          tension: 0.3
        },
        {
          label: 'Analytical prediction',
          data: DATA.times.map(function(t, i) { return {x: t, y: DATA.xiAna[i]}; }),
          borderColor: '#ef4444',
          showLine: true,
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.3
        },
        {
          label: 'sqrt(Dt) reference',
          data: DATA.times.map(function(t, i) { return {x: t, y: sqrtDt[i]}; }),
          borderColor: '#22c55e',
          showLine: true,
          borderWidth: 1.5,
          borderDash: [6, 4],
          pointRadius: 0,
          tension: 0.3
        },
        {
          label: 'NESS: 1/q_c = 0.119',
          data: [{x: DATA.times[0], y: 0.119}, {x: DATA.times[50], y: 0.119}],
          borderColor: '#94a3b8',
          showLine: true,
          borderWidth: 1,
          borderDash: [4, 4],
          pointRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { type: 'logarithmic', title: { display: true, text: 'Time t' }, min: 0.0005, max: 10 },
        y: { type: 'logarithmic', title: { display: true, text: 'Correlation length xi(t)' }, min: 0.0005, max: 0.2 }
      },
      plugins: { legend: { position: 'top' } }
    }
  });
}

// ===== 4. DYNAMICAL SCALING CHART =====
var chartScaling = null;
var allScalingData = [];

function computeScalingData() {
  var S_ss = DATA.sqSnapshots[50];
  allScalingData = [];
  var snapKeys = [0,7,14,21,28,35,42,50];
  var snapTimes = [0.000927,0.650009,1.299091,1.948173,2.597255,3.246337,3.895419,4.6363];
  snapKeys.forEach(function(sk, si) {
    var sq = DATA.sqSnapshots[sk];
    for (var iq = 0; iq < DATA.qBins.length; iq++) {
      if (S_ss[iq] > 0 && DATA.qBins[iq] > 0) {
        var x = DATA.qBins[iq] * DATA.qBins[iq] * DATA.params.D * snapTimes[si];
        var y = sq[iq] / S_ss[iq];
        if (y > 0 && y < 2.5 && x > 0) {
          allScalingData.push({x: x, y: y});
        }
      }
    }
  });
}

function buildScalingChart(minX) {
  var ctx = document.getElementById('chartScaling').getContext('2d');
  var filtered = allScalingData.filter(function(p) { return p.x >= minX; });

  var curvePts = [];
  for (var lx = -3; lx <= 3; lx += 0.05) {
    var x = Math.pow(10, lx);
    curvePts.push({x: x, y: 1 - Math.exp(-2 * x)});
  }

  if (chartScaling) chartScaling.destroy();
  chartScaling = new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [
        {
          label: 'Simulation data',
          data: filtered,
          backgroundColor: '#3b82f640',
          borderColor: '#3b82f6',
          pointRadius: 2.5,
          pointHoverRadius: 5
        },
        {
          label: 'f(x) = 1 - exp(-2x)',
          data: curvePts,
          borderColor: '#ef4444',
          showLine: true,
          borderWidth: 2.5,
          pointRadius: 0,
          tension: 0.3
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { type: 'logarithmic', title: { display: true, text: 'Scaling variable q^2 D t' }, min: Math.max(1e-3, minX | 1e-3), max: 1000 },
        y: { title: { display: true, text: 'S_neq(q,t) / S_neq_ss(q)' }, min: -0.1, max: 1.8 }
      },
      plugins: { legend: { position: 'top' } }
    }
  });

  document.getElementById('scalingInfo').textContent = 'Showing ' + filtered.length + ' data points (min q^2 Dt = ' + minX.toFixed(1) + ')';
}

document.getElementById('scalingSlider').addEventListener('input', function() {
  var val = parseFloat(this.value);
  document.getElementById('scalingSliderVal').textContent = val.toFixed(1);
  buildScalingChart(val);
});

// ===== 5. RELAXATION RATE CHART =====
function buildGammaChart() {
  var ctx = document.getElementById('chartGamma').getContext('2d');
  var D = DATA.params.D;
  var nu = DATA.params.nu;
  var beta_g = DATA.params.beta_s * DATA.params.g * DATA.params.grad_c0;

  var gammaPts = [];
  var dq2Pts = [];
  for (var lq = Math.log10(1); lq <= Math.log10(400); lq += 0.03) {
    var q = Math.pow(10, lq);
    var sumR = (D + nu) * q * q / 2;
    var diffSq = Math.pow((nu - D) * q * q / 2, 2);
    var disc = diffSq + beta_g;
    var gamma = Math.max(sumR - Math.sqrt(Math.max(disc, 0)), 1e-30);
    var dq2 = D * q * q;
    if (gamma > 1e-20) gammaPts.push({x: q, y: gamma});
    dq2Pts.push({x: q, y: dq2});
  }

  new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [
        {
          label: 'Gamma(q) - coupled system',
          data: gammaPts,
          borderColor: '#3b82f6',
          showLine: true,
          borderWidth: 2.5,
          pointRadius: 0,
          tension: 0.3
        },
        {
          label: 'Dq^2 (pure diffusion)',
          data: dq2Pts,
          borderColor: '#22c55e',
          showLine: true,
          borderWidth: 1.5,
          borderDash: [6, 4],
          pointRadius: 0,
          tension: 0.3
        },
        {
          label: 'q_c = 8.41',
          data: [{x: 8.41, y: 0.001}, {x: 8.41, y: 200}],
          borderColor: '#f59e0b80',
          showLine: true,
          borderWidth: 1.5,
          borderDash: [4, 4],
          pointRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { type: 'logarithmic', title: { display: true, text: 'Wavevector q' }, min: 1, max: 500 },
        y: { type: 'logarithmic', title: { display: true, text: 'Relaxation rate Gamma(q)' }, min: 0.01, max: 200 }
      },
      plugins: { legend: { position: 'top' } }
    }
  });
}

// ===== 6. MODE BUILDUP CHART =====
var chartModes = null;
var modeQVals = [1, 3, 5, 10, 20, 40];
var modeVisible = [true, true, true, true, true, true];

function buildModesChart() {
  var ctx = document.getElementById('chartModes').getContext('2d');
  var S_ss = DATA.sqSnapshots[50];
  var snapKeys = [0,7,14,21,28,35,42,50];
  var snapTimes = [0.000927,0.650009,1.299091,1.948173,2.597255,3.246337,3.895419,4.6363];

  var datasets = modeQVals.map(function(qIdx, mi) {
    var pts = snapKeys.map(function(sk, si) {
      var ratio = S_ss[qIdx] > 0 ? DATA.sqSnapshots[sk][qIdx] / S_ss[qIdx] : 0;
      return {x: snapTimes[si], y: Math.min(ratio, 2)};
    });
    return {
      label: 'q = ' + DATA.qBins[qIdx].toFixed(0),
      data: pts,
      borderColor: COLORS[mi],
      showLine: true,
      borderWidth: 2,
      pointRadius: 4,
      tension: 0.3,
      hidden: !modeVisible[mi]
    };
  });

  if (chartModes) chartModes.destroy();
  chartModes = new Chart(ctx, {
    type: 'scatter',
    data: { datasets: datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { title: { display: true, text: 'Time t' }, min: 0, max: 5 },
        y: { title: { display: true, text: 'S(q,t) / S_ss(q)' }, min: 0, max: 2 }
      },
      plugins: { legend: { position: 'top' } }
    }
  });
}

// Mode controls
(function() {
  var modeCtrl = document.getElementById('mode-controls');
  modeQVals.forEach(function(qIdx, i) {
    var btn = document.createElement('button');
    btn.textContent = 'q=' + DATA.qBins[qIdx].toFixed(0);
    btn.className = modeVisible[i] ? 'active' : '';
    btn.addEventListener('click', function() {
      modeVisible[i] = !modeVisible[i];
      btn.className = modeVisible[i] ? 'active' : '';
      chartModes.data.datasets[i].hidden = !modeVisible[i];
      chartModes.update();
    });
    modeCtrl.appendChild(btn);
  });
})();

// ===== TABLES (safe DOM methods) =====
function buildParamsTable() {
  var tbody = document.getElementById('paramsTable');
  var rows = [
    ['Diffusion coefficient', 'D', '10^-3', 'Mass diffusivity'],
    ['Kinematic viscosity', 'nu', '10^-1', 'Momentum diffusivity'],
    ['Concentration gradient', 'grad c_0', '5.0', 'Imposed macroscopic gradient'],
    ['Solutal expansion', 'beta_s', '0.01', 'Density-concentration coupling'],
    ['Gravity', 'g', '10.0', 'Gravitational acceleration'],
    ['Thermal energy', 'k_B T', '10^-4', 'Noise amplitude scale'],
    ['Density', 'rho', '1.0', 'Mean fluid density'],
    ['Grid size', 'N', '128 x 128', 'Periodic lattice'],
    ['Gravity cutoff', 'q_c', '8.41', 'Long-wavelength stabilization'],
    ['Lewis number', 'Le', '100', 'nu/D ratio'],
    ['Rayleigh number', 'Ra_s', '5000', 'Below convective onset']
  ];
  rows.forEach(function(r) {
    var tr = createRow([createCell(r[0], false), createCell(r[1], true), createCell(r[2], true), createCell(r[3], false)]);
    tbody.appendChild(tr);
  });
}

function buildSummaryTable() {
  var tbody = document.getElementById('summaryTable');
  var rows = [
    ['Gravitational cutoff q_c', '8.41', '--'],
    ['NESS correlation length 1/q_c', '0.119', '--'],
    ['Diffusive time tau_D', '14.1 s', '--'],
    ['Final power-law exponent alpha', '-1.96', '-4.0'],
    ['R^2 of power-law fit', '0.994', '--'],
    ['xi(t_final) numerical', '0.023', '--'],
    ['xi(t_final) analytical', '0.063', '--'],
    ['Scaling collapse RMS', '0.27', '0.0']
  ];
  rows.forEach(function(r) {
    var tr = createRow([createCell(r[0], false), createCell(r[1], true), createCell(r[2], true)]);
    tbody.appendChild(tr);
  });
}

function buildTimeTable() {
  var tbody = document.getElementById('timeTable');
  for (var i = 0; i < DATA.times.length; i += 5) {
    var tr = createRow([
      createCell(DATA.times[i].toFixed(3), true),
      createCell(DATA.xiNum[i].toFixed(6), true),
      createCell(DATA.xiAna[i].toFixed(6), true),
      createCell(DATA.exponent[i].toFixed(4), true)
    ]);
    tbody.appendChild(tr);
  }
}

function buildSQTable() {
  var tbody = document.getElementById('sqTable');
  var snapKeys = [0,7,14,21,28,35,42,50];
  for (var iq = 0; iq < DATA.qBins.length; iq += 4) {
    var cells = [createCell(DATA.qBins[iq].toFixed(1), true)];
    snapKeys.forEach(function(sk) {
      cells.push(createCell(DATA.sqSnapshots[sk][iq].toExponential(2), true));
    });
    cells.push(createCell(DATA.sSsAna[iq].toExponential(2), true));
    var tr = createRow(cells);
    tbody.appendChild(tr);
  }
}

// ===== NAV ACTIVE STATE =====
function updateNav() {
  var sections = document.querySelectorAll('.section, .hero');
  var navLinks = document.querySelectorAll('.nav-inner a:not(.nav-brand)');
  var current = '';
  sections.forEach(function(s) {
    var top = s.offsetTop - 80;
    if (window.scrollY >= top) current = s.id;
  });
  navLinks.forEach(function(a) {
    if (a.getAttribute('href') === '#' + current) {
      a.classList.add('active');
    } else {
      a.classList.remove('active');
    }
  });
}
window.addEventListener('scroll', updateNav);

// ===== INIT =====
computeScalingData();
buildSQChart();
buildExponentChart();
buildXiChart();
buildScalingChart(0);
buildGammaChart();
buildModesChart();
buildParamsTable();
buildSummaryTable();
buildTimeTable();
buildSQTable();
updateNav();
</script>
</body>
</html>
