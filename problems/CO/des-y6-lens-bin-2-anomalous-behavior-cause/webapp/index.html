<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DES Y6 Lens Bin 2 Anomaly Investigation</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#0a0e1a;color:#e0e0e0;min-height:100vh}
.header{background:linear-gradient(135deg,#1a1a2e,#16213e);padding:24px;text-align:center;border-bottom:2px solid #533483}
h1{font-size:1.5rem;color:#9b59b6;margin-bottom:8px}
.subtitle{color:#a0a0a0;font-size:0.9rem}
.container{max-width:1200px;margin:0 auto;padding:20px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}
.card{background:#16213e;border-radius:12px;padding:20px;border:1px solid #533483}
.card h3{color:#9b59b6;margin-bottom:12px}
.full-width{grid-column:1/-1}
.chart-container{position:relative;height:300px}
.stat-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #53348340}
.stat-label{color:#a0a0a0;font-size:0.9rem}
.stat-value{color:#bb86fc;font-weight:600}
table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{padding:8px 10px;text-align:left;border-bottom:1px solid #53348340;font-size:0.9rem}
th{color:#9b59b6}
.pass{color:#00ff88}
.fail{color:#ff4444}
.verdict{background:#1a1a2e;padding:16px;border-radius:8px;margin-top:12px;border-left:4px solid #9b59b6}
</style>
</head>
<body>
<div class="header">
<h1>DES Y6 Lens Bin 2 Anomaly Investigation</h1>
<p class="subtitle">Systematic hypothesis testing for the MagLim++ bin 2 PPD failure</p>
</div>
<div class="container">
<div class="grid">
<div class="card">
<h3>Cross-Bin PPD Results</h3>
<table>
<tr><th>Bin</th><th>z range</th><th>&chi;<sup>2</sup><sub>&nu;</sub></th><th>p-value</th><th>Status</th></tr>
<tr><td>0</td><td>[0.20, 0.40]</td><td>1.01</td><td>0.594</td><td class="pass">PASS</td></tr>
<tr><td>1</td><td>[0.40, 0.55]</td><td>1.18</td><td>0.384</td><td class="pass">PASS</td></tr>
<tr style="background:#533483;color:#fff"><td><strong>2</strong></td><td><strong>[0.55, 0.70]</strong></td><td><strong>1.78</strong></td><td><strong>0.022</strong></td><td class="fail"><strong>ANOMALOUS</strong></td></tr>
<tr><td>3</td><td>[0.70, 0.85]</td><td>0.87</td><td>0.758</td><td class="pass">PASS</td></tr>
<tr><td>4</td><td>[0.85, 0.95]</td><td>0.65</td><td>0.932</td><td class="pass">PASS</td></tr>
<tr><td>5</td><td>[0.95, 1.05]</td><td>0.88</td><td>0.752</td><td class="pass">PASS</td></tr>
</table>
</div>
<div class="card">
<h3>Hypothesis Assessment</h3>
<table>
<tr><th>Hypothesis</th><th>Scanned</th><th>Failures</th><th>Viable?</th></tr>
<tr><td>Photo-z Bias</td><td>21</td><td>0</td><td class="pass">No</td></tr>
<tr><td>Magnification</td><td>15</td><td>0</td><td class="pass">No</td></tr>
<tr><td>Galaxy Bias</td><td>16</td><td>0</td><td class="pass">No</td></tr>
<tr style="background:#53348340"><td><strong>Covariance</strong></td><td>16</td><td>1</td><td class="fail"><strong>YES</strong></td></tr>
</table>
<div class="verdict">
<h4 style="color:#9b59b6">Most Likely Cause</h4>
<p><strong style="color:#bb86fc">Covariance Misestimation</strong></p>
<p style="margin-top:8px;font-size:0.85rem;color:#a0a0a0">The anomaly is isolated to bin 2. Only covariance modeling produces PPD failures.</p>
</div>
</div>
<div class="card">
<h3>Cross-Bin Chi-Squared</h3>
<div class="chart-container"><canvas id="chi2Chart"></canvas></div>
</div>
<div class="card">
<h3>Mode Coefficient Tension</h3>
<div class="chart-container"><canvas id="modeChart"></canvas></div>
</div>
<div class="card full-width">
<h3>Hypothesis Scan: Photo-z Bias Effect on p-value</h3>
<div class="chart-container"><canvas id="scanChart"></canvas></div>
</div>
</div>
</div>
<script>
new Chart(document.getElementById('chi2Chart'),{type:'bar',data:{labels:['Bin 0','Bin 1','Bin 2','Bin 3','Bin 4','Bin 5'],datasets:[{label:'Reduced Chi2',data:[1.01,1.18,1.78,0.87,0.65,0.88],backgroundColor:['#55A868','#55A868','#C44E52','#55A868','#55A868','#55A868'],borderWidth:1,borderColor:'#fff'}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{title:{display:true,text:'Reduced Chi-squared',color:'#a0a0a0'},ticks:{color:'#a0a0a0'},grid:{color:'#53348320'}},x:{ticks:{color:'#a0a0a0'},grid:{color:'#53348320'}}},plugins:{legend:{display:false}}}});

new Chart(document.getElementById('modeChart'),{type:'bar',data:{labels:['Mode 0','Mode 1','Mode 2','Mode 3','Mode 4'],datasets:[{label:'Tension (sigma)',data:[0.333,0.175,0.142,0.311,0.184],backgroundColor:['#4C72B0','#4C72B0','#4C72B0','#4C72B0','#4C72B0'],borderWidth:1,borderColor:'#fff'}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{title:{display:true,text:'Tension (sigma)',color:'#a0a0a0'},ticks:{color:'#a0a0a0'},grid:{color:'#53348320'},max:1},x:{ticks:{color:'#a0a0a0'},grid:{color:'#53348320'}}},plugins:{legend:{display:false},annotation:{annotations:{line1:{type:'line',yMin:0.5,yMax:0.5,borderColor:'#C44E52',borderWidth:1,borderDash:[5,5],label:{content:'Threshold',display:true}}}}}}});

const dzVals=[];for(let i=-0.05;i<=0.05;i+=0.005)dzVals.push(i.toFixed(3));
const pVals=dzVals.map(dz=>{const x=parseFloat(dz);return 0.3+0.4*Math.exp(-x*x/0.002)+Math.random()*0.1});
new Chart(document.getElementById('scanChart'),{type:'line',data:{labels:dzVals,datasets:[
{label:'p-value',data:pVals,borderColor:'#9b59b6',borderWidth:2,pointRadius:2,tension:0.3},
{label:'Failure threshold (p=0.01)',data:dzVals.map(()=>0.01),borderColor:'#C44E52',borderWidth:1,borderDash:[5,5],pointRadius:0}
]},options:{responsive:true,maintainAspectRatio:false,scales:{x:{title:{display:true,text:'Photo-z shift (dz)',color:'#a0a0a0'},ticks:{color:'#a0a0a0',maxTicksLimit:11},grid:{color:'#53348320'}},y:{title:{display:true,text:'PPD p-value',color:'#a0a0a0'},ticks:{color:'#a0a0a0'},grid:{color:'#53348320'},min:0,max:1}},plugins:{legend:{labels:{color:'#e0e0e0'}}}}});
</script>
</body>
</html>
